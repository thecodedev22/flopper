(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();const $c=!1;var Cs=Array.isArray,Wd=Array.prototype.indexOf,fa=Array.from,ns=Object.defineProperty,Yn=Object.getOwnPropertyDescriptor,qc=Object.getOwnPropertyDescriptors,Qd=Object.prototype,Jd=Array.prototype,da=Object.getPrototypeOf,al=Object.isExtensible;const Zn=()=>{};function Xd(n){return n()}function rs(n){for(var t=0;t<n.length;t++)n[t]()}function Yd(){var n,t,e=new Promise((r,i)=>{n=r,t=i});return{promise:e,resolve:n,reject:t}}const he=2,pa=4,ks=8,gr=16,$e=32,xn=64,zc=128,ge=256,is=512,Bt=1024,me=2048,qe=4096,we=8192,Nn=16384,ga=32768,ma=65536,ul=1<<17,Zd=1<<18,fi=1<<19,Gc=1<<20,Oo=1<<21,_a=1<<22,bn=1<<23,An=Symbol("$state"),tp=Symbol("legacy props"),ep=Symbol(""),ya=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function np(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Hc(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function rp(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function ip(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function sp(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function op(n){throw new Error("https://svelte.dev/e/effect_orphan")}function ap(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function up(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function lp(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function cp(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const hp=1,fp=2,dp=16,pp=2,gp=4,mp=8,_p=1,yp=2,Ft=Symbol(),vp="http://www.w3.org/1999/xhtml";let wp=!1;function Kc(n){return n===this.v}function Wc(n,t){return n!=n?t==t:n!==t||n!==null&&typeof n=="object"||typeof n=="function"}function Qc(n){return!Wc(n,this.v)}let mr=!1,Ep=!1;function Tp(){mr=!0}let St=null;function ss(n){St=n}function hn(n,t=!1,e){St={p:St,c:null,e:null,s:n,x:null,l:mr&&!t?{s:null,u:null,$:[]}:null}}function fn(n){var t=St,e=t.e;if(e!==null){t.e=null;for(var r of e)hh(r)}return St=t.p,{}}function di(){return!mr||St!==null&&St.l===null}const bp=new WeakMap;function Ap(n){var t=ft;if(t===null)return dt.f|=bn,n;if((t.f&ga)===0){if((t.f&zc)===0)throw!t.parent&&n instanceof Error&&Jc(n),n;t.b.error(n)}else va(n,t)}function va(n,t){for(;t!==null;){if((t.f&zc)!==0)try{t.b.error(n);return}catch(e){n=e}t=t.parent}throw n instanceof Error&&Jc(n),n}function Jc(n){const t=bp.get(n);t&&(ns(n,"message",{value:t.message}),ns(n,"stack",{value:t.stack}))}let Xr=[],Mo=[];function Xc(){var n=Xr;Xr=[],rs(n)}function Ip(){var n=Mo;Mo=[],rs(n)}function Yc(n){Xr.length===0&&queueMicrotask(Xc),Xr.push(n)}function Sp(){Xr.length>0&&Xc(),Mo.length>0&&Ip()}function Rp(){for(var n=ft.b;n!==null&&!n.has_pending_snippet();)n=n.parent;return n===null&&np(),n}function wa(n){var t=he|me,e=dt!==null&&(dt.f&he)!==0?dt:null;return ft===null||e!==null&&(e.f&ge)!==0?t|=ge:ft.f|=fi,{ctx:St,deps:null,effects:null,equals:Kc,f:t,fn:n,reactions:null,rv:0,v:Ft,wv:0,parent:e??ft,ac:null}}function Cp(n,t){let e=ft;e===null&&rp();var r=e.b,i=void 0,s=Yr(Ft),a=null,u=!dt;return $p(()=>{try{var c=n();a&&Promise.resolve(c).catch(()=>{})}catch(I){c=Promise.reject(I)}var l=()=>c;i=a?.then(l,l)??Promise.resolve(c),a=i;var h=It,p=r.pending;u&&(r.update_pending_count(1),p||h.increment());const _=(I,g=void 0)=>{a=null,p||h.activate(),g?g!==ya&&(s.f|=bn,as(s,g)):((s.f&bn)!==0&&(s.f^=bn),as(s,I)),u&&(r.update_pending_count(-1),p||h.decrement()),eh()};if(i.then(_,I=>_(null,I||"unknown")),h)return()=>{queueMicrotask(()=>h.neuter())}}),new Promise(c=>{function l(h){function p(){h===i?c(s):l(i)}h.then(p,p)}l(i)})}function Ea(n){const t=wa(n);return t.equals=Qc,t}function Zc(n){var t=n.effects;if(t!==null){n.effects=null;for(var e=0;e<t.length;e+=1)Le(t[e])}}function kp(n){for(var t=n.parent;t!==null;){if((t.f&he)===0)return t;t=t.parent}return null}function Ta(n){var t,e=ft;rn(kp(n));try{Zc(n),t=Eh(n)}finally{rn(e)}return t}function th(n){var t=Ta(n);if(n.equals(t)||(n.v=t,n.wv=vh()),!On){var e=(Qe||(n.f&ge)!==0)&&n.deps!==null?qe:Bt;ee(n,e)}}function Pp(n,t,e){const r=di()?wa:Ea;if(t.length===0){e(n.map(r));return}var i=It,s=ft,a=Dp(),u=Rp();Promise.all(t.map(c=>Cp(c))).then(c=>{i?.activate(),a();try{e([...n.map(r),...c])}catch(l){(s.f&Nn)===0&&va(l,s)}i?.deactivate(),eh()}).catch(c=>{u.error(c)})}function Dp(){var n=ft,t=dt,e=St,r=It;return function(){rn(n),Pe(t),ss(e),r?.activate()}}function eh(){rn(null),Pe(null),ss(null)}const mo=new Set;let It=null,Hi=null,ll=new Set,os=[];function nh(){const n=os.shift();os.length>0&&queueMicrotask(nh),n()}let Cn=[],Ps=null,Lo=!1,Ki=!1;class sr{current=new Map;#u=new Map;#i=new Set;#t=0;#l=null;#c=!1;#n=[];#s=[];#r=[];#e=[];#o=[];#h=[];#f=[];skipped_effects=new Set;process(t){Cn=[],Hi=null;for(const i of t)this.#p(i);if(this.#n.length===0&&this.#t===0){this.#d();var e=this.#r,r=this.#e;this.#r=[],this.#e=[],this.#o=[],Hi=It,It=null,cl(e),cl(r),It===null?It=this:mo.delete(this),this.#l?.resolve()}else this.#a(this.#r),this.#a(this.#e),this.#a(this.#o);for(const i of this.#n)Sn(i);for(const i of this.#s)Sn(i);this.#n=[],this.#s=[]}#p(t){t.f^=Bt;for(var e=t.first;e!==null;){var r=e.f,i=(r&($e|xn))!==0,s=i&&(r&Bt)!==0,a=s||(r&we)!==0||this.skipped_effects.has(e);if(!a&&e.fn!==null){if(i)e.f^=Bt;else if((r&pa)!==0)this.#e.push(e);else if((r&Bt)===0)if((r&_a)!==0){var u=e.b?.pending?this.#s:this.#n;u.push(e)}else gi(e)&&((e.f&gr)!==0&&this.#o.push(e),Sn(e));var c=e.first;if(c!==null){e=c;continue}}var l=e.parent;for(e=e.next;e===null&&l!==null;)e=l.next,l=l.parent}}#a(t){for(const e of t)((e.f&me)!==0?this.#h:this.#f).push(e),ee(e,Bt);t.length=0}capture(t,e){this.#u.has(t)||this.#u.set(t,e),this.current.set(t,t.v)}activate(){It=this}deactivate(){It=null,Hi=null;for(const t of ll)if(ll.delete(t),t(),It!==null)break}neuter(){this.#c=!0}flush(){Cn.length>0?rh():this.#d(),It===this&&(this.#t===0&&mo.delete(this),this.deactivate())}#d(){if(!this.#c)for(const t of this.#i)t();this.#i.clear()}increment(){this.#t+=1}decrement(){if(this.#t-=1,this.#t===0){for(const t of this.#h)ee(t,me),or(t);for(const t of this.#f)ee(t,qe),or(t);this.#r=[],this.#e=[],this.flush()}else this.deactivate()}add_callback(t){this.#i.add(t)}settled(){return(this.#l??=Yd()).promise}static ensure(){if(It===null){const t=It=new sr;mo.add(It),Ki||sr.enqueue(()=>{It===t&&t.flush()})}return It}static enqueue(t){os.length===0&&queueMicrotask(nh),os.unshift(t)}}function Vp(n){var t=Ki;Ki=!0;try{for(var e;;){if(Sp(),Cn.length===0&&(It?.flush(),Cn.length===0))return Ps=null,e;rh()}}finally{Ki=t}}function rh(){var n=er;Lo=!0;try{var t=0;for(pl(!0);Cn.length>0;){var e=sr.ensure();if(t++>1e3){var r,i;xp()}e.process(Cn),Xe.clear()}}finally{Lo=!1,pl(n),Ps=null}}function xp(){try{ap()}catch(n){va(n,Ps)}}let wn=null;function cl(n){var t=n.length;if(t!==0){for(var e=0;e<t;){var r=n[e++];if((r.f&(Nn|we))===0&&gi(r)&&(wn=[],Sn(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?gh(r):r.fn=null),wn?.length>0)){Xe.clear();for(const i of wn)Sn(i);wn=[]}}wn=null}}function or(n){for(var t=Ps=n;t.parent!==null;){t=t.parent;var e=t.f;if(Lo&&t===ft&&(e&gr)!==0)return;if((e&(xn|$e))!==0){if((e&Bt)===0)return;t.f^=Bt}}Cn.push(t)}const Xe=new Map;function Yr(n,t){var e={f:0,v:n,reactions:null,equals:Kc,rv:0,wv:0};return e}function We(n,t){const e=Yr(n);return Gp(e),e}function yt(n,t=!1,e=!0){const r=Yr(n);return t||(r.equals=Qc),mr&&e&&St!==null&&St.l!==null&&(St.l.s??=[]).push(r),r}function hl(n,t){return Z(n,oe(()=>z(n))),t}function Z(n,t,e=!1){dt!==null&&(!Ie||(dt.f&ul)!==0)&&di()&&(dt.f&(he|gr|_a|ul))!==0&&!Me?.includes(n)&&cp();let r=e?Xn(t):t;return as(n,r)}function as(n,t){if(!n.equals(t)){var e=n.v;On?Xe.set(n,t):Xe.set(n,e),n.v=t;var r=sr.ensure();r.capture(n,e),(n.f&he)!==0&&((n.f&me)!==0&&Ta(n),ee(n,(n.f&ge)===0?Bt:qe)),n.wv=vh(),ih(n,me),di()&&ft!==null&&(ft.f&Bt)!==0&&(ft.f&($e|xn))===0&&(de===null?Hp([n]):de.push(n))}return t}function _o(n){Z(n,n.v+1)}function ih(n,t){var e=n.reactions;if(e!==null)for(var r=di(),i=e.length,s=0;s<i;s++){var a=e[s],u=a.f;if(!(!r&&a===ft)){var c=(u&me)===0;c&&ee(a,t),(u&he)!==0?ih(a,qe):c&&((u&gr)!==0&&wn!==null&&wn.push(a),or(a))}}}function Xn(n){if(typeof n!="object"||n===null||An in n)return n;const t=da(n);if(t!==Qd&&t!==Jd)return n;var e=new Map,r=Cs(n),i=We(0),s=In,a=u=>{if(In===s)return u();var c=dt,l=In;Pe(null),ml(s);var h=u();return Pe(c),ml(l),h};return r&&e.set("length",We(n.length)),new Proxy(n,{defineProperty(u,c,l){(!("value"in l)||l.configurable===!1||l.enumerable===!1||l.writable===!1)&&up();var h=e.get(c);return h===void 0?h=a(()=>{var p=We(l.value);return e.set(c,p),p}):Z(h,l.value,!0),!0},deleteProperty(u,c){var l=e.get(c);if(l===void 0){if(c in u){const h=a(()=>We(Ft));e.set(c,h),_o(i)}}else Z(l,Ft),_o(i);return!0},get(u,c,l){if(c===An)return n;var h=e.get(c),p=c in u;if(h===void 0&&(!p||Yn(u,c)?.writable)&&(h=a(()=>{var I=Xn(p?u[c]:Ft),g=We(I);return g}),e.set(c,h)),h!==void 0){var _=z(h);return _===Ft?void 0:_}return Reflect.get(u,c,l)},getOwnPropertyDescriptor(u,c){var l=Reflect.getOwnPropertyDescriptor(u,c);if(l&&"value"in l){var h=e.get(c);h&&(l.value=z(h))}else if(l===void 0){var p=e.get(c),_=p?.v;if(p!==void 0&&_!==Ft)return{enumerable:!0,configurable:!0,value:_,writable:!0}}return l},has(u,c){if(c===An)return!0;var l=e.get(c),h=l!==void 0&&l.v!==Ft||Reflect.has(u,c);if(l!==void 0||ft!==null&&(!h||Yn(u,c)?.writable)){l===void 0&&(l=a(()=>{var _=h?Xn(u[c]):Ft,I=We(_);return I}),e.set(c,l));var p=z(l);if(p===Ft)return!1}return h},set(u,c,l,h){var p=e.get(c),_=c in u;if(r&&c==="length")for(var I=l;I<p.v;I+=1){var g=e.get(I+"");g!==void 0?Z(g,Ft):I in u&&(g=a(()=>We(Ft)),e.set(I+"",g))}if(p===void 0)(!_||Yn(u,c)?.writable)&&(p=a(()=>We(void 0)),Z(p,Xn(l)),e.set(c,p));else{_=p.v!==Ft;var S=a(()=>Xn(l));Z(p,S)}var b=Reflect.getOwnPropertyDescriptor(u,c);if(b?.set&&b.set.call(h,l),!_){if(r&&typeof c=="string"){var k=e.get("length"),y=Number(c);Number.isInteger(y)&&y>=k.v&&Z(k,y+1)}_o(i)}return!0},ownKeys(u){z(i);var c=Reflect.ownKeys(u).filter(p=>{var _=e.get(p);return _===void 0||_.v!==Ft});for(var[l,h]of e)h.v!==Ft&&!(l in u)&&c.push(l);return c},setPrototypeOf(){lp()}})}var fl,sh,oh,ah;function Np(){if(fl===void 0){fl=window,sh=/Firefox/.test(navigator.userAgent);var n=Element.prototype,t=Node.prototype,e=Text.prototype;oh=Yn(t,"firstChild").get,ah=Yn(t,"nextSibling").get,al(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),al(e)&&(e.__t=void 0)}}function pi(n=""){return document.createTextNode(n)}function us(n){return oh.call(n)}function Ds(n){return ah.call(n)}function X(n,t){return us(n)}function Zr(n,t){{var e=us(n);return e instanceof Comment&&e.data===""?Ds(e):e}}function it(n,t=1,e=!1){let r=n;for(;t--;)r=Ds(r);return r}function Op(n){n.textContent=""}function uh(){return!1}let dl=!1;function Mp(){dl||(dl=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const t of n.target.elements)t.__on_r?.()})},{capture:!0}))}function Vs(n){var t=dt,e=ft;Pe(null),rn(null);try{return n()}finally{Pe(t),rn(e)}}function Lp(n,t,e,r=e){n.addEventListener(t,()=>Vs(e));const i=n.__on_r;i?n.__on_r=()=>{i(),r(!0)}:n.__on_r=()=>r(!0),Mp()}function lh(n){ft===null&&dt===null&&op(),dt!==null&&(dt.f&ge)!==0&&ft===null&&sp(),On&&ip()}function jp(n,t){var e=t.last;e===null?t.last=t.first=n:(e.next=n,n.prev=e,t.last=n)}function xe(n,t,e,r=!0){var i=ft;i!==null&&(i.f&we)!==0&&(n|=we);var s={ctx:St,deps:null,nodes_start:null,nodes_end:null,f:n|me,first:null,fn:t,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(e)try{Sn(s),s.f|=ga}catch(c){throw Le(s),c}else t!==null&&or(s);if(r){var a=s;if(e&&a.deps===null&&a.teardown===null&&a.nodes_start===null&&a.first===a.last&&(a.f&fi)===0&&(a=a.first),a!==null&&(a.parent=i,i!==null&&jp(a,i),dt!==null&&(dt.f&he)!==0&&(n&xn)===0)){var u=dt;(u.effects??=[]).push(a)}}return s}function ch(n){const t=xe(ks,null,!1);return ee(t,Bt),t.teardown=n,t}function jo(n){lh();var t=ft.f,e=!dt&&(t&$e)!==0&&(t&ga)===0;if(e){var r=St;(r.e??=[]).push(n)}else return hh(n)}function hh(n){return xe(pa|Gc,n,!1)}function Fp(n){return lh(),xe(ks|Gc,n,!0)}function Up(n){sr.ensure();const t=xe(xn|fi,n,!0);return(e={})=>new Promise(r=>{e.outro?Aa(t,()=>{Le(t),r(void 0)}):(Le(t),r(void 0))})}function Bp(n){return xe(pa,n,!1)}function tr(n,t){var e=St,r={effect:null,ran:!1,deps:n};e.l.$.push(r),r.effect=xs(()=>{n(),!r.ran&&(r.ran=!0,oe(t))})}function ba(){var n=St;xs(()=>{for(var t of n.l.$){t.deps();var e=t.effect;(e.f&Bt)!==0&&ee(e,qe),gi(e)&&Sn(e),t.ran=!1}})}function $p(n){return xe(_a|fi,n,!0)}function xs(n,t=0){return xe(ks|t,n,!0)}function ve(n,t=[],e=[]){Pp(t,e,r=>{xe(ks,()=>n(...r.map(z)),!0)})}function fh(n,t=0){var e=xe(gr|t,n,!0);return e}function ti(n,t=!0){return xe($e|fi,n,!0,t)}function dh(n){var t=n.teardown;if(t!==null){const e=On,r=dt;gl(!0),Pe(null);try{t.call(null)}finally{gl(e),Pe(r)}}}function ph(n,t=!1){var e=n.first;for(n.first=n.last=null;e!==null;){const i=e.ac;i!==null&&Vs(()=>{i.abort(ya)});var r=e.next;(e.f&xn)!==0?e.parent=null:Le(e,t),e=r}}function qp(n){for(var t=n.first;t!==null;){var e=t.next;(t.f&$e)===0&&Le(t),t=e}}function Le(n,t=!0){var e=!1;(t||(n.f&Zd)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(zp(n.nodes_start,n.nodes_end),e=!0),ph(n,t&&!e),ls(n,0),ee(n,Nn);var r=n.transitions;if(r!==null)for(const s of r)s.stop();dh(n);var i=n.parent;i!==null&&i.first!==null&&gh(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function zp(n,t){for(;n!==null;){var e=n===t?null:Ds(n);n.remove(),n=e}}function gh(n){var t=n.parent,e=n.prev,r=n.next;e!==null&&(e.next=r),r!==null&&(r.prev=e),t!==null&&(t.first===n&&(t.first=r),t.last===n&&(t.last=e))}function Aa(n,t){var e=[];Ia(n,e,!0),mh(e,()=>{Le(n),t&&t()})}function mh(n,t){var e=n.length;if(e>0){var r=()=>--e||t();for(var i of n)i.out(r)}else t()}function Ia(n,t,e){if((n.f&we)===0){if(n.f^=we,n.transitions!==null)for(const a of n.transitions)(a.is_global||e)&&t.push(a);for(var r=n.first;r!==null;){var i=r.next,s=(r.f&ma)!==0||(r.f&$e)!==0;Ia(r,t,s?e:!1),r=i}}}function Sa(n){_h(n,!0)}function _h(n,t){if((n.f&we)!==0){n.f^=we,(n.f&Bt)===0&&(ee(n,me),or(n));for(var e=n.first;e!==null;){var r=e.next,i=(e.f&ma)!==0||(e.f&$e)!==0;_h(e,i?t:!1),e=r}if(n.transitions!==null)for(const s of n.transitions)(s.is_global||t)&&s.in()}}let er=!1;function pl(n){er=n}let On=!1;function gl(n){On=n}let dt=null,Ie=!1;function Pe(n){dt=n}let ft=null;function rn(n){ft=n}let Me=null;function Gp(n){dt!==null&&(Me===null?Me=[n]:Me.push(n))}let te=null,ue=0,de=null;function Hp(n){de=n}let yh=1,ei=0,In=ei;function ml(n){In=n}let Qe=!1;function vh(){return++yh}function gi(n){var t=n.f;if((t&me)!==0)return!0;if((t&qe)!==0){var e=n.deps,r=(t&ge)!==0;if(e!==null){var i,s,a=(t&is)!==0,u=r&&ft!==null&&!Qe,c=e.length;if((a||u)&&(ft===null||(ft.f&Nn)===0)){var l=n,h=l.parent;for(i=0;i<c;i++)s=e[i],(a||!s?.reactions?.includes(l))&&(s.reactions??=[]).push(l);a&&(l.f^=is),u&&h!==null&&(h.f&ge)===0&&(l.f^=ge)}for(i=0;i<c;i++)if(s=e[i],gi(s)&&th(s),s.wv>n.wv)return!0}(!r||ft!==null&&!Qe)&&ee(n,Bt)}return!1}function wh(n,t,e=!0){var r=n.reactions;if(r!==null&&!Me?.includes(n))for(var i=0;i<r.length;i++){var s=r[i];(s.f&he)!==0?wh(s,t,!1):t===s&&(e?ee(s,me):(s.f&Bt)!==0&&ee(s,qe),or(s))}}function Eh(n){var t=te,e=ue,r=de,i=dt,s=Qe,a=Me,u=St,c=Ie,l=In,h=n.f;te=null,ue=0,de=null,Qe=(h&ge)!==0&&(Ie||!er||dt===null),dt=(h&($e|xn))===0?n:null,Me=null,ss(n.ctx),Ie=!1,In=++ei,n.ac!==null&&(Vs(()=>{n.ac.abort(ya)}),n.ac=null);try{n.f|=Oo;var p=n.fn,_=p(),I=n.deps;if(te!==null){var g;if(ls(n,ue),I!==null&&ue>0)for(I.length=ue+te.length,g=0;g<te.length;g++)I[ue+g]=te[g];else n.deps=I=te;if(!Qe||(h&he)!==0&&n.reactions!==null)for(g=ue;g<I.length;g++)(I[g].reactions??=[]).push(n)}else I!==null&&ue<I.length&&(ls(n,ue),I.length=ue);if(di()&&de!==null&&!Ie&&I!==null&&(n.f&(he|qe|me))===0)for(g=0;g<de.length;g++)wh(de[g],n);return i!==null&&i!==n&&(ei++,de!==null&&(r===null?r=de:r.push(...de))),(n.f&bn)!==0&&(n.f^=bn),_}catch(S){return Ap(S)}finally{n.f^=Oo,te=t,ue=e,de=r,dt=i,Qe=s,Me=a,ss(u),Ie=c,In=l}}function Kp(n,t){let e=t.reactions;if(e!==null){var r=Wd.call(e,n);if(r!==-1){var i=e.length-1;i===0?e=t.reactions=null:(e[r]=e[i],e.pop())}}e===null&&(t.f&he)!==0&&(te===null||!te.includes(t))&&(ee(t,qe),(t.f&(ge|is))===0&&(t.f^=is),Zc(t),ls(t,0))}function ls(n,t){var e=n.deps;if(e!==null)for(var r=t;r<e.length;r++)Kp(n,e[r])}function Sn(n){var t=n.f;if((t&Nn)===0){ee(n,Bt);var e=ft,r=er;ft=n,er=!0;try{(t&gr)!==0?qp(n):ph(n),dh(n);var i=Eh(n);n.teardown=typeof i=="function"?i:null,n.wv=yh;var s;$c&&Ep&&(n.f&me)!==0&&n.deps}finally{er=r,ft=e}}}async function Wp(){await Promise.resolve(),Vp()}function z(n){var t=n.f,e=(t&he)!==0;if(dt!==null&&!Ie){var r=ft!==null&&(ft.f&Nn)!==0;if(!r&&!Me?.includes(n)){var i=dt.deps;if((dt.f&Oo)!==0)n.rv<ei&&(n.rv=ei,te===null&&i!==null&&i[ue]===n?ue++:te===null?te=[n]:(!Qe||!te.includes(n))&&te.push(n));else{(dt.deps??=[]).push(n);var s=n.reactions;s===null?n.reactions=[dt]:s.includes(dt)||s.push(dt)}}}else if(e&&n.deps===null&&n.effects===null){var a=n,u=a.parent;u!==null&&(u.f&ge)===0&&(a.f^=ge)}if(On){if(Xe.has(n))return Xe.get(n);if(e){a=n;var c=a.v;return((a.f&Bt)===0&&a.reactions!==null||Th(a))&&(c=Ta(a)),Xe.set(a,c),c}}else e&&(a=n,gi(a)&&th(a));if((n.f&bn)!==0)throw n.v;return n.v}function Th(n){if(n.v===Ft)return!0;if(n.deps===null)return!1;for(const t of n.deps)if(Xe.has(t)||(t.f&he)!==0&&Th(t))return!0;return!1}function oe(n){var t=Ie;try{return Ie=!0,n()}finally{Ie=t}}const Qp=-7169;function ee(n,t){n.f=n.f&Qp|t}function bh(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(An in n)Fo(n);else if(!Array.isArray(n))for(let t in n){const e=n[t];typeof e=="object"&&e&&An in e&&Fo(e)}}}function Fo(n,t=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!t.has(n)){t.add(n),n instanceof Date&&n.getTime();for(let r in n)try{Fo(n[r],t)}catch{}const e=da(n);if(e!==Object.prototype&&e!==Array.prototype&&e!==Map.prototype&&e!==Set.prototype&&e!==Date.prototype){const r=qc(e);for(let i in r){const s=r[i].get;if(s)try{s.call(n)}catch{}}}}}const Jp=["touchstart","touchmove"];function Xp(n){return Jp.includes(n)}const Yp=new Set,_l=new Set;function Zp(n,t,e,r={}){function i(s){if(r.capture||Ur.call(t,s),!s.cancelBubble)return Vs(()=>e?.call(this,s))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Yc(()=>{t.addEventListener(n,i,r)}):t.addEventListener(n,i,r),i}function Nt(n,t,e,r,i){var s={capture:r,passive:i},a=Zp(n,t,e,s);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&ch(()=>{t.removeEventListener(n,a,s)})}let yl=null;function Ur(n){var t=this,e=t.ownerDocument,r=n.type,i=n.composedPath?.()||[],s=i[0]||n.target;yl=n;var a=0,u=yl===n&&n.__root;if(u){var c=i.indexOf(u);if(c!==-1&&(t===document||t===window)){n.__root=t;return}var l=i.indexOf(t);if(l===-1)return;c<=l&&(a=c)}if(s=i[a]||n.target,s!==t){ns(n,"currentTarget",{configurable:!0,get(){return s||e}});var h=dt,p=ft;Pe(null),rn(null);try{for(var _,I=[];s!==null;){var g=s.assignedSlot||s.parentNode||s.host||null;try{var S=s["__"+r];if(S!=null&&(!s.disabled||n.target===s))if(Cs(S)){var[b,...k]=S;b.apply(s,[n,...k])}else S.call(s,n)}catch(y){_?I.push(y):_=y}if(n.cancelBubble||g===t||g===null)break;s=g}if(_){for(let y of I)queueMicrotask(()=>{throw y});throw _}}finally{n.__root=t,delete n.currentTarget,Pe(h),rn(p)}}}function tg(n){var t=document.createElement("template");return t.innerHTML=n.replaceAll("<!>","<!---->"),t.content}function cs(n,t){var e=ft;e.nodes_start===null&&(e.nodes_start=n,e.nodes_end=t)}function Ct(n,t){var e=(t&_p)!==0,r=(t&yp)!==0,i,s=!n.startsWith("<!>");return()=>{i===void 0&&(i=tg(s?n:"<!>"+n),e||(i=us(i)));var a=r||sh?document.importNode(i,!0):i.cloneNode(!0);if(e){var u=us(a),c=a.lastChild;cs(u,c)}else cs(a,a);return a}}function eg(n=""){{var t=pi(n+"");return cs(t,t),t}}function Uo(){var n=document.createDocumentFragment(),t=document.createComment(""),e=pi();return n.append(t,e),cs(t,e),n}function Et(n,t){n!==null&&n.before(t)}function le(n,t){var e=t==null?"":typeof t=="object"?t+"":t;e!==(n.__t??=n.nodeValue)&&(n.__t=e,n.nodeValue=e+"")}function ng(n,t){return rg(n,t)}const Gn=new Map;function rg(n,{target:t,anchor:e,props:r={},events:i,context:s,intro:a=!0}){Np();var u=new Set,c=p=>{for(var _=0;_<p.length;_++){var I=p[_];if(!u.has(I)){u.add(I);var g=Xp(I);t.addEventListener(I,Ur,{passive:g});var S=Gn.get(I);S===void 0?(document.addEventListener(I,Ur,{passive:g}),Gn.set(I,1)):Gn.set(I,S+1)}}};c(fa(Yp)),_l.add(c);var l=void 0,h=Up(()=>{var p=e??t.appendChild(pi());return ti(()=>{if(s){hn({});var _=St;_.c=s}i&&(r.$$events=i),l=n(p,r)||{},s&&fn()}),()=>{for(var _ of u){t.removeEventListener(_,Ur);var I=Gn.get(_);--I===0?(document.removeEventListener(_,Ur),Gn.delete(_)):Gn.set(_,I)}_l.delete(c),p!==e&&p.parentNode?.removeChild(p)}});return ig.set(l,h),l}let ig=new WeakMap;function ie(n,t,e=!1){var r=n,i=null,s=null,a=Ft,u=e?ma:0,c=!1;const l=(I,g=!0)=>{c=!0,_(g,I)};var h=null;function p(){h!==null&&(h.lastChild.remove(),r.before(h),h=null);var I=a?i:s,g=a?s:i;I&&Sa(I),g&&Aa(g,()=>{a?s=null:i=null})}const _=(I,g)=>{if(a!==(a=I)){var S=uh(),b=r;if(S&&(h=document.createDocumentFragment(),h.append(b=pi())),a?i??=g&&ti(()=>g(b)):s??=g&&ti(()=>g(b)),S){var k=It,y=a?i:s,m=a?s:i;y&&k.skipped_effects.delete(y),m&&k.skipped_effects.add(m),k.add_callback(p)}else p()}};fh(()=>{c=!1,t(l),c||_(null,null)},u)}function sg(n,t){return t}function og(n,t,e){for(var r=n.items,i=[],s=t.length,a=0;a<s;a++)Ia(t[a].e,i,!0);var u=s>0&&i.length===0&&e!==null;if(u){var c=e.parentNode;Op(c),c.append(e),r.clear(),be(n,t[0].prev,t[s-1].next)}mh(i,()=>{for(var l=0;l<s;l++){var h=t[l];u||(r.delete(h.k),be(n,h.prev,h.next)),Le(h.e,!u)}})}function Ah(n,t,e,r,i,s=null){var a=n,u={flags:t,items:new Map,first:null},c=null,l=!1,h=new Map,p=Ea(()=>{var S=e();return Cs(S)?S:S==null?[]:fa(S)}),_,I;function g(){ag(I,_,u,h,a,i,t,r,e),s!==null&&(_.length===0?c?Sa(c):c=ti(()=>s(a)):c!==null&&Aa(c,()=>{c=null}))}fh(()=>{I??=ft,_=z(p);var S=_.length;if(!(l&&S===0)){l=S===0;var b,k,y,m;if(uh()){var R=new Set,C=It;for(k=0;k<S;k+=1){y=_[k],m=r(y,k);var x=u.items.get(m)??h.get(m);x?Ih(x,y,k):(b=Sh(null,u,null,null,y,m,k,i,t,e,!0),h.set(m,b)),R.add(m)}for(const[T,w]of u.items)R.has(T)||C.skipped_effects.add(w.e);C.add_callback(g)}else g();z(p)}})}function ag(n,t,e,r,i,s,a,u,c){var l=t.length,h=e.items,p=e.first,_=p,I,g=null,S=[],b=[],k,y,m,R;for(R=0;R<l;R+=1){if(k=t[R],y=u(k,R),m=h.get(y),m===void 0){var C=r.get(y);if(C!==void 0){r.delete(y),h.set(y,C);var x=g?g.next:_;be(e,g,C),be(e,C,x),yo(C,x,i),g=C}else{var T=_?_.e.nodes_start:i;g=Sh(T,e,g,g===null?e.first:g.next,k,y,R,s,a,c)}h.set(y,g),S=[],b=[],_=g.next;continue}if(Ih(m,k,R),(m.e.f&we)!==0&&Sa(m.e),m!==_){if(I!==void 0&&I.has(m)){if(S.length<b.length){var w=b[0],A;g=w.prev;var V=S[0],P=S[S.length-1];for(A=0;A<S.length;A+=1)yo(S[A],w,i);for(A=0;A<b.length;A+=1)I.delete(b[A]);be(e,V.prev,P.next),be(e,g,V),be(e,P,w),_=w,g=P,R-=1,S=[],b=[]}else I.delete(m),yo(m,_,i),be(e,m.prev,m.next),be(e,m,g===null?e.first:g.next),be(e,g,m),g=m;continue}for(S=[],b=[];_!==null&&_.k!==y;)(_.e.f&we)===0&&(I??=new Set).add(_),b.push(_),_=_.next;if(_===null)continue;m=_}S.push(m),g=m,_=m.next}if(_!==null||I!==void 0){for(var E=I===void 0?[]:fa(I);_!==null;)(_.e.f&we)===0&&E.push(_),_=_.next;var d=E.length;if(d>0){var N=null;og(e,E,N)}}n.first=e.first&&e.first.e,n.last=g&&g.e;for(var O of r.values())Le(O.e);r.clear()}function Ih(n,t,e,r){as(n.v,t),n.i=e}function Sh(n,t,e,r,i,s,a,u,c,l,h){var p=(c&hp)!==0,_=(c&dp)===0,I=p?_?yt(i,!1,!1):Yr(i):i,g=(c&fp)===0?a:Yr(a),S={i:g,v:I,k:s,a:null,e:null,prev:e,next:r};try{if(n===null){var b=document.createDocumentFragment();b.append(n=pi())}return S.e=ti(()=>u(n,I,g,l),wp),S.e.prev=e&&e.e,S.e.next=r&&r.e,e===null?h||(t.first=S):(e.next=S,e.e.next=S.e),r!==null&&(r.prev=S,r.e.prev=S.e),S}finally{}}function yo(n,t,e){for(var r=n.next?n.next.e.nodes_start:e,i=t?t.e.nodes_start:e,s=n.e.nodes_start;s!==null&&s!==r;){var a=Ds(s);i.before(s),s=a}}function be(n,t,e){t===null?n.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}const vl=[...` 	
\r\f \v\uFEFF`];function ug(n,t,e){var r=n==null?"":""+n;if(t&&(r=r?r+" "+t:t),e){for(var i in e)if(e[i])r=r?r+" "+i:i;else if(r.length)for(var s=i.length,a=0;(a=r.indexOf(i,a))>=0;){var u=a+s;(a===0||vl.includes(r[a-1]))&&(u===r.length||vl.includes(r[u]))?r=(a===0?"":r.substring(0,a))+r.substring(u+1):a=u}}return r===""?null:r}function Gr(n,t,e,r,i,s){var a=n.__className;if(a!==e||a===void 0){var u=ug(e,r,s);u==null?n.removeAttribute("class"):n.className=u,n.__className=e}else if(s&&i!==s)for(var c in s){var l=!!s[c];(i==null||l!==!!i[c])&&n.classList.toggle(c,l)}return s}const lg=Symbol("is custom element"),cg=Symbol("is html");function hg(n,t){var e=Rh(n);e.value===(e.value=t??void 0)||n.value===t&&(t!==0||n.nodeName!=="PROGRESS")||(n.value=t??"")}function ni(n,t,e,r){var i=Rh(n);i[t]!==(i[t]=e)&&(t==="loading"&&(n[ep]=e),e==null?n.removeAttribute(t):typeof e!="string"&&fg(n).includes(t)?n[t]=e:n.setAttribute(t,e))}function Rh(n){return n.__attributes??={[lg]:n.nodeName.includes("-"),[cg]:n.namespaceURI===vp}}var wl=new Map;function fg(n){var t=n.getAttribute("is")||n.nodeName,e=wl.get(t);if(e)return e;wl.set(t,e=[]);for(var r,i=n,s=Element.prototype;s!==i;){r=qc(i);for(var a in r)r[a].set&&e.push(a);i=da(i)}return e}function ri(n,t,e=t){var r=new WeakSet;Lp(n,"input",async i=>{var s=i?n.defaultValue:n.value;if(s=vo(n)?wo(s):s,e(s),It!==null&&r.add(It),await Wp(),s!==(s=t())){var a=n.selectionStart,u=n.selectionEnd;n.value=s??"",u!==null&&(n.selectionStart=a,n.selectionEnd=Math.min(u,n.value.length))}}),oe(t)==null&&n.value&&(e(vo(n)?wo(n.value):n.value),It!==null&&r.add(It)),xs(()=>{var i=t();if(n===document.activeElement){var s=Hi??It;if(r.has(s))return}vo(n)&&i===wo(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function vo(n){var t=n.type;return t==="number"||t==="range"}function wo(n){return n===""?null:+n}function El(n,t){return n===t||n?.[An]===t}function hs(n={},t,e,r){return Bp(()=>{var i,s;return xs(()=>{i=s,s=[],oe(()=>{n!==e(...s)&&(t(n,...s),i&&El(e(...i),n)&&t(null,...i))})}),()=>{Yc(()=>{s&&El(e(...s),n)&&t(null,...s)})}}),n}function Ch(n){return function(...t){var e=t[0];return e.preventDefault(),n?.apply(this,t)}}function Mn(n=!1){const t=St,e=t.l.u;if(!e)return;let r=()=>bh(t.s);if(n){let i=0,s={};const a=wa(()=>{let u=!1;const c=t.s;for(const l in c)c[l]!==s[l]&&(s[l]=c[l],u=!0);return u&&i++,i});r=()=>z(a)}e.b.length&&Fp(()=>{Tl(t,r),rs(e.b)}),jo(()=>{const i=oe(()=>e.m.map(Xd));return()=>{for(const s of i)typeof s=="function"&&s()}}),e.a.length&&jo(()=>{Tl(t,r),rs(e.a)})}function Tl(n,t){if(n.l.s)for(const e of n.l.s)z(e);t()}function kh(n,t,e){if(n==null)return t(void 0),Zn;const r=oe(()=>n.subscribe(t,e));return r.unsubscribe?()=>r.unsubscribe():r}const Hn=[];function Ra(n,t=Zn){let e=null;const r=new Set;function i(u){if(Wc(n,u)&&(n=u,e)){const c=!Hn.length;for(const l of r)l[1](),Hn.push(l,n);if(c){for(let l=0;l<Hn.length;l+=2)Hn[l][0](Hn[l+1]);Hn.length=0}}}function s(u){i(u(n))}function a(u,c=Zn){const l=[u,c];return r.add(l),r.size===1&&(e=t(i,s)||Zn),u(n),()=>{r.delete(l),r.size===0&&e&&(e(),e=null)}}return{set:i,update:s,subscribe:a}}function dg(n){let t;return kh(n,e=>t=e)(),t}let Ui=!1,Bo=Symbol();function ar(n,t,e){const r=e[t]??={store:null,source:yt(void 0),unsubscribe:Zn};if(r.store!==n&&!(Bo in e))if(r.unsubscribe(),r.store=n??null,n==null)r.source.v=void 0,r.unsubscribe=Zn;else{var i=!0;r.unsubscribe=kh(n,s=>{i?r.source.v=s:Z(r.source,s)}),i=!1}return n&&Bo in e?dg(n):z(r.source)}function mi(){const n={};function t(){ch(()=>{for(var e in n)n[e].unsubscribe();ns(n,Bo,{enumerable:!1,value:!0})})}return[n,t]}function pg(n){var t=Ui;try{return Ui=!1,[n(),Ui]}finally{Ui=t}}function bl(n,t,e,r){var i=!mr||(e&pp)!==0,s=(e&mp)!==0,a=r,u=!0,c=()=>(u&&(u=!1,a=r),a),l;{var h=An in n||tp in n;l=Yn(n,t)?.set??(h&&t in n?y=>n[t]=y:void 0)}var p,_=!1;[p,_]=pg(()=>n[t]);var I;if(i?I=()=>{var y=n[t];return y===void 0?c():(u=!0,y)}:I=()=>{var y=n[t];return y!==void 0&&(a=void 0),y===void 0?a:y},i&&(e&gp)===0)return I;if(l){var g=n.$$legacy;return(function(y,m){return arguments.length>0?((!i||!m||g||_)&&l(m?I():y),y):I()})}var S=!1,b=Ea(()=>(S=!1,I()));z(b);var k=ft;return(function(y,m){if(arguments.length>0){const R=m?z(b):i&&s?Xn(y):y;return Z(b,R),S=!0,a!==void 0&&(a=R),y}return On&&S||(k.f&Nn)!==0?b.v:z(b)})}function gg(n){St===null&&Hc(),mr&&St.l!==null?yg(St).m.push(n):jo(()=>{const t=oe(n);if(typeof t=="function")return t})}function mg(n,t,{bubbles:e=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:t,bubbles:e,cancelable:r})}function _g(){const n=St;return n===null&&Hc(),(t,e,r)=>{const i=n.s.$$events?.[t];if(i){const s=Cs(i)?i.slice():[i],a=mg(t,e,r);for(const u of s)u.call(n.x,a);return!a.defaultPrevented}return!0}}function yg(n){var t=n.l;return t.u??={a:[],b:[],m:[]}}const vg="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(vg);Tp();var En=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ca(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Ph(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Wi={exports:{}};Wi.exports;var Al;function ka(){return Al||(Al=1,(function(n){(function(){function t(r,i){return i?Ph(r):r.slice?t[s(r)]:function(a,u){r(a={exports:{}}),t[s(u)]=a.exports};function s(a){return a.split("/").slice(-1).toString().replace(".js","")}}var e=n;t(function(r){String.random=function(s,a){var u="";for(s=s||24,a=a||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";s-- >0;)u+=a.charAt(Math.floor(Math.random()*a.length));return u},String.match=function(s,a){var u,c;return typeof s!="string"?!1:(typeof a=="string"&&(a={"=":a}),a=a||{},u=a["="]||a["*"]||a[">"]||a["<"],s===u?!0:c!==a["="]?!1:(u=a["*"]||a[">"],s.slice(0,(u||"").length)===u?!0:c!==a["*"]?!1:c!==a[">"]&&c!==a["<"]?s>=a[">"]&&s<=a["<"]:c!==a[">"]&&s>=a[">"]||c!==a["<"]&&s<=a["<"]))},String.hash=function(s,a){if(typeof s=="string"){if(a=a||0,!s.length)return a;for(var u=0,c=s.length,l;u<c;++u)l=s.charCodeAt(u),a=(a<<5)-a+l,a|=0;return a}};var i=Object.prototype.hasOwnProperty;Object.plain=function(s){return s?s instanceof Object&&s.constructor===Object||Object.prototype.toString.call(s).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(s,a){for(var u in s)if(i.call(s,u)&&(!a||a.indexOf(u)==-1))return!1;return!0},Object.keys=Object.keys||function(s){var a=[];for(var u in s)i.call(s,u)&&a.push(u);return a},(function(){var s,a=setTimeout,u=0,c=0,l=typeof setImmediate!=""+s&&setImmediate||(function(p,_){return typeof MessageChannel==""+s?a:((p=new MessageChannel).port1.onmessage=function(I){I.data==""&&_()},function(I){_=I,p.port2.postMessage("")})})(),h=a.check=a.check||typeof performance!=""+s&&performance||{now:function(){return+new Date}};a.hold=a.hold||9,a.poll=a.poll||function(p){if(a.hold>=h.now()-u&&c++<3333){p();return}l(function(){u=h.now(),p()},c=0)}})(),(function(){var s=setTimeout,a=s.turn=s.turn||function(_){u.push(_)==1&&c(p)},u=a.s=[],c=s.poll,l=0,h,p=function(){(h=u[l++])&&h(),(l==u.length||l==99)&&(u=a.s=u.slice(l),l=0),u.length&&c(p)}})(),(function(){var s,a=setTimeout,u=a.turn;(a.each=a.each||function(c,l,h,p){p=p||9,(function _(I,g,S){if(g=(I=(c||[]).splice(0,p)).length){for(var b=0;b<g&&s===(S=l(I[b]));b++);if(s===S){u(_);return}}h&&h(S)})()})()})()})(t,"./shim"),t(function(r){r.exports=function i(h,a,u){if(!h)return{to:i};var c,l=typeof a=="function",h=(this.tag||(this.tag={}))[h]||l&&(this.tag[h]={tag:h,to:i._={next:function(_){var I;(I=this.to)&&I.next(_)}}});if(l){var p={off:i.off||(i.off=function(){if(this.next===i._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=i._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:i._,next:a,the:h,on:this,as:u};return(p.back=h.last||h).to=p,h.last=p}return(h=h.to)&&c!==a&&h.next(a),h}})(t,"./onto"),t(function(r){r.exports=function(i){return i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"&&i!=1/0&&i!=-1/0&&i===i||!!i&&typeof i["#"]=="string"&&Object.keys(i).length===1&&i["#"]}})(t,"./valid"),t(function(r){t("./shim");function i(){var h=+new Date;return c<h?(a=0,c=h+i.drift):c=h+(a+=1)/u+i.drift}i.drift=0;var s=-1/0,a=0,u=999,c=s,l;i.is=function(h,p,_){var I=p&&h&&h._&&h._[">"]||_;if(I)return typeof(I=I[p])=="number"?I:s},i.ify=function(h,p,_,I,g){(h=h||{})._=h._||{},g&&(h._["#"]=g);var S=h._[">"]||(h._[">"]={});return l!==p&&p!=="_"&&(typeof _=="number"&&(S[p]=_),l!==I&&(h[p]=I)),h},r.exports=i})(t,"./state"),t(function(r){t("./shim");function i(s){var a={s:{}},u=a.s;s=s||{max:999,age:1e3*9},a.check=function(l){return u[l]?c(l):!1};var c=a.track=function(l){var h=u[l]||(u[l]={});return h.was=a.now=+new Date,a.to||(a.to=setTimeout(a.drop,s.age+9)),c.ed&&c.ed(l),h};return a.drop=function(l){a.to=null,a.now=+new Date;var h=Object.keys(u);console.STAT&&console.STAT(a.now,+new Date-a.now,"dup drop keys"),setTimeout.each(h,function(p){var _=u[p];_&&(l||s.age)>a.now-_.was||delete u[p]},0,99)},a}r.exports=i})(t,"./dup"),t(function(r){t("./onto"),r.exports=function(a,u){if(this.on){var c=(this.opt||{}).lack||9e3;if(typeof a!="function"){if(!a)return;var h=a["#"]||a,l=(this.tag||"")[h];return l?(u&&(l=this.on(h,u),clearTimeout(l.err),l.err=setTimeout(function(){l.off()},c)),!0):void 0}var h=u&&u["#"]||i(9);if(!a)return h;var p=this.on(h,a,u);return p.err=p.err||setTimeout(function(){p.off(),p.next({err:"Error: No ACK yet.",lack:!0})},c),h}};var i=String.random||function(){return Math.random().toString(36).slice(2)}})(t,"./ask"),t(function(r){function i(g){return g instanceof i?(this._={$:this}).$:this instanceof i?i.create(this._={$:this,opt:g}):new i(g)}i.is=function(g){return g instanceof i||g&&g._&&g===g._.$||!1},i.version=.202,i.chain=i.prototype,i.chain.toJSON=function(){},t("./shim"),i.valid=t("./valid"),i.state=t("./state"),i.on=t("./onto"),i.dup=t("./dup"),i.ask=t("./ask"),(function(){i.create=function(d){d.root=d.root||d,d.graph=d.graph||{},d.on=d.on||i.on,d.ask=d.ask||i.ask,d.dup=d.dup||i.dup();var N=d.$.opt(d.opt);return d.once||(d.on("in",g,d),d.on("out",g,d),d.on("put",k,d),i.on("create",d),d.on("create",d)),d.once=1,N};function g(d){if(d){if(d.out===g){this.to.next(d);return}var N=this,O=N.as,U=O.at||O,F=U.$,L=U.dup,$,G=d.DBG;if(($=d["#"])||($=d["#"]=a(9)),!L.check($)){if(L.track($),$=d._,d._=typeof $=="function"?$:function(){},d.$&&d.$===(d.$._||"").$||(d.$=F),d["@"]&&!d.put&&m(d),!U.ask(d["@"],d))if(G&&(G.u=+new Date),d.put){S(d);return}else d.get&&i.on.get(d,F);G&&(G.uc=+new Date),N.to.next(d),G&&(G.ua=+new Date),!(d.nts||d.NTS)&&(d.out=g,U.on("out",d),G&&(G.ue=+new Date))}}}function S(d){if(d){var N=d._||"",O=N.root=((N.$=d.$||"")._||"").root;if(d["@"]&&N.faith&&!N.miss){d.out=g,O.on("out",d);return}N.latch=O.hatch,N.match=O.hatch=[];var U=d.put,F=N.DBG=d.DBG,L=+new Date;if(P=P||L,!(U["#"]&&U["."])){F&&(F.p=L),N["#"]=d["#"],N.msg=d,N.all=0,N.stun=1;var $=Object.keys(U);console.STAT&&console.STAT(L,((F||N).pk=+new Date)-L,"put sort");var G=0,Y,Q,J,lt,_t,nt,rt;(function vt(ne){if(Y!=G){if(Y=G,!(J=$[G])){console.STAT&&console.STAT(L,((F||N).pd=+new Date)-L,"put"),y(N);return}(lt=U[J])?(rt=lt._)?J!==rt["#"]?nt=C+x(J)+"soul not same.":(_t=rt[">"])||(nt=C+x(J)+"no state."):nt=C+x(J)+"no meta.":nt=C+x(J)+"no node.",Q=Object.keys(lt||{})}if(nt){d.err=N.err=nt,y(N);return}var fe=0,Jt;for(ne=ne||0;ne++<9&&(Jt=Q[fe++]);)if(Jt!=="_"){var _e=lt[Jt],ze=_t[Jt];if(p===ze){nt=C+x(Jt)+"on"+x(J)+"no state.";break}if(!c(_e)){nt=C+x(Jt)+"on"+x(J)+"bad "+typeof _e+x(_e);break}b(_e,Jt,J,ze,d),++V}if((Q=Q.slice(fe)).length){u(vt);return}++G,Q=null,vt(ne)})()}}}i.on.put=S;function b(d,N,O,U,F){var L=F._||"",$=L.root,G=$.graph,Y,Q=G[O]||_,J=l(Q,N,1),lt=Q[N],_t=L.DBG;(Y=console.STAT)&&(!G[O]||!lt)&&(Y.has=(Y.has||0)+1);var nt=A();if(U>nt){setTimeout(function(){b(d,N,O,U,F)},(Y=U-nt)>w?w:Y),console.STAT&&console.STAT((_t||L).Hf=+new Date,Y,"future");return}if(!(U<J)&&!(!L.faith&&U===J&&(d===lt||T(d)<=T(lt))&&!L.miss)){L.stun++;var rt=F["#"]+L.all++,vt={toString:function(){return rt},_:L};vt.toJSON=vt.toString,$.dup.track(vt)["#"]=F["#"],_t&&(_t.ph=_t.ph||+new Date),$.on("put",{"#":vt,"@":F["@"],put:{"#":O,".":N,":":d,">":U},ok:F.ok,_:L})}}function k(d){var N;(N=(d._||"").DBG)&&(N.pa=+new Date,N.pm=N.pm||+new Date);var O=this,U=O.as,F=U.graph,L=d._,$=d.put,G=$["#"],Y=$["."],Q=$[":"],J=$[">"];d["#"];var lt;(lt=L.msg)&&(lt=lt.put)&&(lt=lt[G])&&h(lt,Y,J,Q,G),F[G]=h(F[G],Y,J,Q,G),(lt=(U.next||"")[G])&&lt.on("in",d),y(L),O.to.next(d)}function y(d,N){var O;if(!d.stop&&!(!d.err&&0<--d.stun)&&(d.stop=1,!!(O=d.root))){var U=d.match;U.end=1,U===O.hatch&&(!(U=d.latch)||U.end?delete O.hatch:O.hatch=U),d.hatch&&d.hatch(),setTimeout.each(d.match,function(F){F&&F()}),!(!(N=d.msg)||d.err||N.err)&&(N.out=g,d.root.on("out",N),E())}}function m(d){var N=d["@"]||"",O;if(!(O=N._)){var U=(U=d.$)&&(U=U._)&&(U=U.root)&&(U=U.dup);if(!(U=U.check(N)))return;d["@"]=U["#"]||d["@"];return}O.acks=(O.acks||0)+1,(O.err=d.err)&&(d["@"]=O["#"],y(O)),O.ok=d.ok||O.ok,!O.stop&&!O.crack&&(O.crack=O.match&&O.match.push(function(){R(O)})),R(O)}function R(d){!d||!d.root||d.stun||d.acks!==d.all||d.root.on("in",{"@":d["#"],err:d.err,ok:d.err?p:d.ok||{"":1}})}var C="Error: Invalid graph!",x=function(d){return" '"+(""+d).slice(0,9)+"...' "},T=JSON.stringify,w=2147483647,A=i.state,V=0,P,E=function(){V>999&&V/-(P-(P=+new Date))>1&&(i.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),E=function(){V=0})}})(),(function(){i.on.get=function(S,b){var k=b._,y=S.get,m=y["#"],R=k.graph[m],C=y["."],x=k.next||(k.next={}),T=x[m],w=S._||{},A=w.DBG=S.DBG;if(A&&(A.g=+new Date),!R)return k.on("get",S);if(C){if((typeof C!="string"||p===R[C])&&!((T||"").next||"")[C]){k.on("get",S);return}R=h({},C,l(R,C),R[C],m)}R&&g(S,R),k.on("get",S)};function g(S,b){var k=+new Date,y=S._||{},m=y.DBG=S.DBG,R=S["#"],C=a(9),x=Object.keys(b||"").sort(),T=((b||"")._||"")["#"];x.length;var w=S.$._.root,A=b===w.graph[T];console.STAT&&console.STAT(k,((m||y).gk=+new Date)-k,"got keys"),b&&(function V(){k=+new Date;for(var P=0,E,d={},N;P<9&&(E=x[P++]);)h(d,E,l(b,E),b[E],T);x=x.slice(P),(N={})[T]=d,d=N;var O;A&&(O=function(){},O.ram=O.faith=!0),N=x.length,console.STAT&&console.STAT(k,-(k-(k=+new Date)),"got copied some"),m&&(m.ga=+new Date),w.on("in",{"@":R,"#":C,put:d,"%":N?C=a(9):p,$:w.$,_:O,DBG:m,FOO:1}),console.STAT&&console.STAT(k,+new Date-k,"got in"),N&&setTimeout.turn(V)})(),b||w.on("in",{"@":S["#"]})}i.on.get.ack=g})(),(function(){i.chain.opt=function(g){g=g||{};var S=this,b=S._,k=g.peers||g;return Object.plain(g)||(g={}),Object.plain(b.opt)||(b.opt=g),typeof k=="string"&&(k=[k]),Object.plain(b.opt.peers)||(b.opt.peers={}),k instanceof Array&&(g.peers={},k.forEach(function(y){var m={};m.id=m.url=y,g.peers[y]=b.opt.peers[y]=b.opt.peers[y]||m})),s(g,function y(m){var R=this[m];if(this&&this.hasOwnProperty(m)||typeof R=="string"||Object.empty(R)){this[m]=R;return}R&&R.constructor!==Object&&!(R instanceof Array)||s(R,y)}),b.opt.from=g,i.on("opt",b),b.opt.uuid=b.opt.uuid||function(m){return i.state().toString(36).replace(".","")+String.random(m||12)},S}})();var s=function(g,S){Object.keys(g).forEach(S,g)},a=String.random,u=setTimeout.turn,c=i.valid,l=i.state.is,h=i.state.ify,p,_={},I;i.log=function(){return!i.log.off&&I.log.apply(I,arguments),[].slice.call(arguments).join(" ")},i.log.once=function(g,S,b){return(b=i.log.once)[g]=b[g]||0,b[g]++||i.log(S)},typeof window<"u"&&((window.GUN=window.Gun=i).window=window);try{typeof e<"u"&&(e.exports=i)}catch{}r.exports=i,(i.window||{}).console=(i.window||{}).console||{log:function(){}},(I=console).only=function(g,S){return I.only.i&&g===I.only.i&&I.only.i++&&(I.log.apply(I,arguments)||S)},i.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(t,"./root"),t(function(r){var i=t("./root");i.chain.back=function(u,c){var l;if(u=u||1,u===-1||u===1/0)return this._.root.$;if(u===1)return(this._.back||this._).$;var h=this,p=h._;if(typeof u=="string"&&(u=u.split(".")),u instanceof Array){var _=0,I=u.length,l=p;for(_;_<I;_++)l=(l||s)[u[_]];return a!==l?c?h:l:(l=p.back)?l.$.back(u,c):void 0}if(typeof u=="function"){for(var g,l={back:p};(l=l.back)&&a===(g=u(l,c)););return g}return typeof u=="number"?(p.back||p).$.back(u-1):this};var s={},a})(t,"./back"),t(function(r){var i=t("./root");i.chain.chain=function(y){var m=this,R=m._,C=new(y||m).constructor(m),x=C._,T;return x.root=T=R.root,x.id=++T.once,x.back=m._,x.on=i.on,x.on("in",i.on.in,x),x.on("out",i.on.out,x),C};function s(y){var m,R=this.as,C=R.back,x=R.root,T;if(y.$||(y.$=R.$),this.to.next(y),R.err){R.on("in",{put:R.put=p,$:R.$});return}if(m=y.get){if(x.pass&&(x.pass[R.id]=R),R.lex&&Object.keys(R.lex).forEach(function(w){T[w]=R.lex[w]},T=y.get=y.get||{}),m["#"]||R.soul){if(m["#"]=m["#"]||R.soul,y["#"]||(y["#"]=_(9)),C=x.$.get(m["#"])._,m=m["."]){if(g(C.put,m)&&(T=C.ask&&C.ask[m],(C.ask||(C.ask={}))[m]=C.$.get(m)._,C.on("in",{get:m,put:{"#":C.soul,".":m,":":C.put[m],">":b(x.graph[C.soul],m)}}),T))return}else{if(T=C.ask&&C.ask[""],(C.ask||(C.ask={}))[""]=C,p!==C.put&&(C.on("in",C),T))return;y.$=C.$}return x.ask(l,y),x.on("in",y)}if(m["."])return R.get?(y={get:{".":R.get},$:R.$},(C.ask||(C.ask={}))[R.get]=y.$._,C.on("out",y)):(y={get:R.lex?y.get:{},$:R.$},C.on("out",y));if((R.ask||(R.ask={}))[""]=R,R.get)return m["."]=R.get,(C.ask||(C.ask={}))[R.get]=y.$._,C.on("out",y)}return C.on("out",y)}i.on.out=s;function a(y,m){m=m||this.as;var R=m.root,C=y.$||(y.$=m.$),x=(C||"")._||h,T=y.put||"",w=T["#"],A=T["."],V=p!==T["="]?T["="]:T[":"],P=T[">"]||-1/0,E;if(p!==y.put&&(p===T["#"]||p===T["."]||p===T[":"]&&p===T["="]||p===T[">"])){if(!I(T)){if(!(w=((T||"")._||"")["#"])){console.log("chain not yet supported for",T,"...",y,m);return}return C=m.root.$.get(w),setTimeout.each(Object.keys(T).sort(),function(d){d=="_"||p===(P=b(T,d))||m.on("in",{$:C,put:{"#":w,".":d,"=":T[d],">":P},VIA:y})})}m.on("in",{$:x.back.$,put:{"#":w=x.back.soul,".":A=x.has||x.get,"=":T,">":b(x.back.put,A)},via:y});return}(y.seen||"")[m.id]||((y.seen||(y.seen=function(){}))[m.id]=m,m!==x&&(Object.keys(y).forEach(function(d){T[d]=y[d]},T={}),T.get=m.get||T.get,!m.soul&&!m.has?T.$$$=T.$$$||m.$:x.soul&&(T.$=m.$,T.$$=T.$$||x.$),y=T),c(y,m),(m.soul||y.$$)&&P>=b(R.graph[w],A)&&((T=R.$.get(w)._).put=k(T.put,A,P,V,w)),!x.soul&&P>=b(R.graph[w],A)&&(E=(R.$.get(w)._.next||"")[A])&&(E.put=V,typeof(T=I(V))=="string"&&(E.put=R.$.get(T)._.put||V)),this.to&&this.to.next(y),m.any&&setTimeout.each(Object.keys(m.any),function(d){(d=m.any[d])&&d(y)},0,99),m.echo&&setTimeout.each(Object.keys(m.echo),function(d){(d=m.echo[d])&&d.on("in",y)},0,99),((y.$$||"")._||x).soul&&(E=m.next)&&(E=E[A])&&(T={},Object.keys(y).forEach(function(d){T[d]=y[d]}),T.$=(y.$$||y.$).get(T.get=A),delete T.$$,delete T.$$$,E.on("in",T)),u(y,m))}i.on.in=a;function u(y,m){if(m=m||this.as||y.$._,!(y.$$&&this!==i.on)&&!(!y.put||m.soul)){var R=y.put||"",C=R["="]||R[":"],A,x=m.root,T=x.$.get(R["#"]).get(R["."])._;if(typeof(C=I(C))!="string"){this===i.on&&((T.echo||(T.echo={}))[m.id]=m);return}if(!((T.echo||(T.echo={}))[m.id]&&!(x.pass||"")[m.id])){if(A=x.pass){if(A[C+m.id])return;A[C+m.id]=1}(T.echo||(T.echo={}))[m.id]=m,m.has&&(m.link=C);var w=x.$.get(T.link=C)._;(w.echo||(w.echo={}))[T.id]=T;var A=m.ask||"";(A[""]||m.lex)&&w.on("out",{get:{"#":C}}),setTimeout.each(Object.keys(A),function(V,P){!V||!(P=A[V])||P.on("out",{get:{"#":C,".":V}})},0,99)}}}i.on.link=u;function c(y,m){var R=y.put||"",C=p!==R["="]?R["="]:R[":"],x=m.root,T,w;if(p===C){if(m.soul&&p!==m.put||(w=(y.$$||y.$||"")._||"",y["@"]&&(p!==w.put||p!==m.put)))return;(T=m.link||y.linked)&&delete(x.$.get(T)._.echo||"")[m.id],m.has&&(m.link=null),m.put=p,setTimeout.each(Object.keys(m.next||""),function(A,V){(V=m.next[A])&&(T&&delete(x.$.get(T).get(A)._.echo||"")[V.id],V.on("in",{get:A,put:p,$:V.$}))},0,99);return}m.soul||y.$$||(T=I(C),w=y.$._||"",!((T===w.link||m.has&&!w.link)&&!((x.pass||"")[m.id]&&typeof T!="string"))&&(delete(w.echo||"")[m.id],c({get:m.get,put:p,$:y.$,linked:y.linked=y.linked||w.link},m)))}i.on.unlink=c;function l(y,m){var R=this.as,C=R.$._;C.root;var x=R.get||"",T=(y.put||"")[x["#"]]||"";if(!y.put||typeof x["."]=="string"&&p===T[x["."]]){if(p!==C.put||!C.soul&&!C.has)return;C.ack=(C.ack||0)+1,C.on("in",{get:C.get,put:C.put=p,$:C.$,"@":y["@"]});return}(y._||{}).miss=1,i.on.put(y)}var h={},p,_=String.random,I=i.valid,g=function(y,m){return y&&Object.prototype.hasOwnProperty.call(y,m)},S=i.state,b=S.is,k=S.ify})(t,"./chain"),t(function(r){var i=t("./root");i.chain.get=function(p,_,I){var g,S;if(typeof p=="string"){if(p.length==0)return(g=this.chain())._.err={err:i.log("0 length key!",p)},_&&_.call(g,g._.err),g;var b=this,k=b._,y=k.next||c;(g=y[p])||(g=p&&s(p,b)),g=g&&g.$}else if(typeof p=="function"){let A=function(V,P,E){if(!A.stun&&!((L=R.pass)&&!L[C])){var d=V.$._,N=(V.$$||"")._,O=(N||d).put,U=!d.has&&!d.soul,F={},L;if((U||h===O)&&(O=h===((L=V.put)||"")["="]?h===(L||"")[":"]?L:L[":"]:L["="]),typeof(L=i.valid(O))=="string"&&(O=h===(L=R.$.get(L)._.put)?m.not?h:O:L),!(m.not&&h===O)){if(h===m.stun){if((L=R.stun)&&L.on&&(k.$.back(function($){if(L.on(""+$.id,F={}),(F.run||0)<A.id)return F}),!F.run&&L.on(""+d.id,F={}),!F.run&&N&&L.on(""+N.id,F={}),A.id>F.run&&((!F.stun||F.stun.end)&&(F.stun=L.on("stun"),F.stun=F.stun&&F.stun.last),F.stun&&!F.stun.end))){(F.stun.add||(F.stun.add={}))[C]=function(){A(V,P,1)};return}if(h===O&&(E=0),(L=R.hatch)&&!L.end&&h===m.hatch&&!E){if(x[d.$._.id])return;x[d.$._.id]=1,L.push(function(){A(V,P,1)});return}x={}}if(R.pass){if(R.pass[C+d.id])return;R.pass[C+d.id]=1}if(m.on){m.ok.call(d.$,O,d.get,V,P||A);return}if(m.v2020){m.ok(V,P||A);return}Object.keys(V).forEach(function($){L[$]=V[$]},L={}),V=L,V.put=O,m.ok.call(m.as,V,P||A)}}};var T=A;if(_===!0)return a(this,p,_,I),this;g=this;var k=g._,m=_||{},R=k.root,C;m.at=k,m.ok=p;var x={};return A.at=k,(k.any||(k.any={}))[C=String.random(7)]=A,A.off=function(){A.stun=1,k.any&&delete k.any[C]},A.rid=u,A.id=m.run||++R.once,S=R.pass,(R.pass={})[C]=1,m.out=m.out||{get:{}},k.on("out",m.out),R.pass=S,g}else{if(typeof p=="number")return this.get(""+p,_,I);if(typeof(S=l(p))=="string")return this.get(S,_,I);(S=this.get.next)&&(g=S(this,p))}return g?(_&&typeof _=="function"&&g.get(_,I),g):((g=this.chain())._.err={err:i.log("Invalid get request!",p)},_&&_.call(g,g._.err),g)};function s(p,_){var I=_._,g=I.next,S=_.chain(),b=S._;return g||(g=I.next={}),g[b.get=p]=b,_===I.root.$?b.soul=p:(I.soul||I.has)&&(b.has=p),b}function a(p,_,I,g){var S=p._,b=0,k;return(k=S.soul||S.link)?_(k,g,S):S.jam?S.jam.push([_,g]):(S.jam=[[_,g]],p.get(function(m,R){if(!(h===m.put&&!S.root.opt.super&&(k=Object.keys(S.root.opt.peers).length)&&++b<=k)){R.rid(m);var C=(C=m.$)&&C._||{},x=0,T;for(k=S.jam,delete S.jam;T=k[x++];){var w=T[0];T=T[1],w&&w(C.link||C.soul||i.valid(m.put)||((m.put||{})._||{})["#"],T,m,R)}}},{out:{get:{".":!0}}}),p)}function u(p){var _=this.at||this.on;if(!p||_.soul||_.has)return this.off();if(p=(p=(p=p.$||p)._||p).id){_.map;var I;if((I=this.seen||(this.seen={}))[p])return!0;I[p]=!0}}var c={},l=i.valid,h})(t,"./get"),t(function(r){var i=t("./root");i.chain.put=function(g,S,b){var k=this,y=k._,m=y.root;b=b||{},b.root=y.root,b.run||(b.run=m.once),s(b,y.id),b.ack=b.ack||S,b.via=b.via||k,b.data=b.data||g,b.soul||(b.soul=y.soul||typeof S=="string"&&S);var R=b.state=b.state||i.state();return typeof g=="function"?(g(function(C){b.data=C,k.put(l,l,b)}),k):b.soul?(b.$=m.$.get(b.soul),b.todo=[{it:b.data,ref:b.$}],b.turn=b.turn||p,b.ran=b.ran||a,(function C(){var x=b.todo,T=x.pop(),w=T.it;T.ref&&T.ref._.id;var A,V,P,E,d;if(s(b,T.ref),(E=T.todo)&&(V=E.pop(),w=w[V],E.length&&x.push(T)),V&&(x.path||(x.path=[])).push(V),!(A=_(w))&&!(d=i.is(w))){if(!Object.plain(w)){a.err(b,"Invalid data: "+c(w)+" at "+(b.via.back(function(L){L.get&&E.push(L.get)},E=[])||E.join("."))+"."+(x.path||[]).join("."));return}for(var N=b.seen||(b.seen=[]),O=N.length;O--;)if(w===(E=N[O]).it){A=w=E.link;break}}if(V&&A)T.node=I(T.node,V,R,w);else{let L=function($,G){var Y=P.link["#"];G&&(G.off(),G.rid($));var Q=Y||$.soul||(E=($.$$||$.$)._||"").soul||E.link||((E=E.put||"")._||"")["#"]||E["#"]||((E=$.put||"")&&$.$$?E["#"]:(E["="]||E[":"]||"")["#"]);if(!Y&&s(b,$.$),!Q&&!T.link["#"]){(T.wait||(T.wait=[])).push(function(){L($,G)});return}Q||(Q=[],($.$$||$.$).back(function(J){if(E=J.soul||J.link)return Q.push(E);Q.push(J.get)}),Q=Q.reverse().join("/")),P.link["#"]=Q,!d&&(((b.graph||(b.graph={}))[Q]=P.node||(P.node={_:{}}))._["#"]=Q),delete b.wait[U],P.wait&&setTimeout.each(P.wait,function(J){J&&J()}),b.ran(b)};var F=L;if(!b.seen){a.err(b,"Data at root of graph must be a node (an object).");return}b.seen.push(P={it:w,link:{},todo:d?[]:Object.keys(w).sort().reverse(),path:(x.path||[]).slice(),up:T}),T.node=I(T.node,V,R,P.link),!d&&P.todo.length&&x.push(P);var U=b.seen.length;(b.wait||(b.wait={}))[U]="",E=(P.ref=d?w:V?T.ref.get(V):T.ref)._,(E=w&&(w._||"")["#"]||E.soul||E.link)?L({soul:E}):P.ref.get(L,{run:b.run,v2020:1,out:{get:{".":" "}}})}if(!x.length)return b.ran(b);b.turn(C)})(),k):(u(b),k)};function s(g,S){if(S){S=(S._||"").id||S;var b=g.root.stun||(g.root.stun={on:i.on}),k={},y;g.stun||(g.stun=b.on("stun",function(){})),(y=b.on(""+S))&&y.the.last.next(k),!(k.run>=g.run)&&b.on(""+S,function(m){if(g.stun.end){this.off(),this.to.next(m);return}m.run=m.run||g.run,m.stun=m.stun||g.stun})}}function a(g){if(g.err){a.end(g.stun,g.root);return}if(!(g.todo.length||g.end||!Object.empty(g.wait))){g.end=1;var S=g.$.back(-1)._,b=S.root,k=S.ask(function(C){b.on("ack",C),C.err&&!C.lack&&i.log(C),++y>(g.acks||0)&&this.off(),g.ack&&g.ack(C,this)},g.opt),y=0,m=g.stun,R;(R=function(){m&&(a.end(m,b),setTimeout.each(Object.keys(m=m.add||""),function(C){(C=m[C])&&C()}))}).hatch=R,g.ack&&!g.ok&&(g.ok=g.acks||9),g.via._.on("out",{put:g.out=g.graph,ok:g.ok&&{"@":g.ok+1},opt:g.opt,"#":k,_:R})}}a.end=function(g,S){g.end=h,g.the.to===g&&g===g.the.last&&delete S.stun,g.off()},a.err=function(g,S){(g.ack||h).call(g,g.out={err:g.err=i.log(S)}),g.ran(g)};function u(g){var S=g.via._,b;g.via=g.via.back(function(k){if(k.soul||!k.get)return k.$;b=g.data,(g.data={})[k.get]=b}),(!g.via||!g.via._.soul)&&(g.via=S.root.$.get(((g.data||"")._||"")["#"]||S.$.back("opt.uuid")())),g.via.put(g.data,g.ack,g)}function c(g,S){return g&&(S=g.constructor)&&S.name||typeof g}var l,h=function(){},p=setTimeout.turn,_=i.valid,I=i.state.ify})(t,"./put"),t(function(r){var i=t("./root");t("./chain"),t("./back"),t("./put"),t("./get"),r.exports=i})(t,"./index"),t(function(r){var i=t("./index");i.chain.on=function(u,c,l,h){var p=this,_=p._;_.root;var I;if(typeof u=="string")return c?(I=_.on(u,c,l||_,h),l&&l.$&&(l.subs||(l.subs=[])).push(I),p):_.on(u);var g=c;return(g=g===!0?{change:!0}:g||{}).not=1,g.on=1,p.get(u,g),p},i.chain.once=function(u,c){if(c=c||{},!u)return s(this);var l=this,h=l._,p=h.root;h.put;var _=String.random(7),I;return l.get(function(g,S,b,k){var y=this,m=y._,R=m.one||(m.one={});if(k.stun||R[_]==="")return;if((I=i.valid(g))===!0){C();return}if(typeof I=="string")return;clearTimeout((h.one||"")[_]),clearTimeout(R[_]),R[_]=setTimeout(C,c.wait||99);function C(x){if(!m.has&&!m.soul&&(m={put:g,get:S}),a===(I=m.put)&&(I=((b.$$||"")._||"").put),typeof i.valid(I)=="string"&&(I=p.$.get(I)._.put,I===a&&!x)){R[_]=setTimeout(function(){C(1)},c.wait||99);return}k.stun||R[_]!==""&&(R[_]="",(h.soul||h.has)&&k.off(),u.call(y,I,m.get),clearTimeout(R[_]))}},{on:1}),l};function s(u,c,l){return i.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(l=u.chain())._.nix=u.once(function(h,p){l._.on("in",this._)}),l._.lex=u._.lex,l}i.chain.off=function(){var u=this,c=u._,l,h=c.back;if(h)return c.ack=0,(l=h.next)&&l[c.get]&&delete l[c.get],(l=h.any)&&(delete h.any,h.any={}),(l=h.ask)&&delete l[c.get],(l=h.put)&&delete l[c.get],(l=c.soul)&&delete h.root.graph[l],(l=c.map)&&Object.keys(l).forEach(function(p,_){_=l[p],_.link&&h.root.$.get(_.link).off()}),(l=c.next)&&Object.keys(l).forEach(function(p,_){_=l[p],_.$.off()}),c.on("off",{}),u};var a})(t,"./on"),t(function(r){var i=t("./index"),s=i.chain.get.next;i.chain.get.next=function(l,h){var p;return Object.plain(h)?(p=((p=h["#"])||"")["="]||p)?l.get(p):((p=l.chain()._).lex=h,l.on("in",function(_){String.match(_.get||(_.put||"")["."],h["."]||h["#"]||h)&&p.on("in",_),this.to.next(_)}),p.$):(s||u)(l,h)},i.chain.map=function(l,h,p){var _=this,I=_._,g,S;return Object.plain(l)&&(g=l["."]?l:{".":l},l=c),l?(i.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),S=_.chain(),_.map().on(function(b,k,y,m){var R=(l||u).call(this,b,k,y,m);if(c!==R){if(b===R)return S._.on("in",y);if(i.is(R))return S._.on("in",R._);var C={};Object.keys(y.put).forEach(function(x){C[x]=y.put[x]},C),C["="]=R,S._.on("in",{get:k,put:C})}}),S):((S=I.each)||((I.each=S=_.chain())._.lex=g||S._.lex||I.lex,S._.nix=_.back("nix"),_.on("in",a,S._)),S)};function a(l){this.to.next(l);var h=this.as,p=l.$,_=p._,I=l.put,g;!_.soul&&!l.$$||(g=h.lex)&&!String.match(l.get||(I||"")["."],g["."]||g["#"]||g)||i.on.link(l,h)}var u=function(){},c})(t,"./map"),t(function(r){var i=t("./index");i.chain.set=function(s,a,u){var c=this,l=c.back(-1),h,p;return a=a||function(){},u=u||{},u.item=u.item||s,(h=((s||"")._||"")["#"])&&((s={})["#"]=h),typeof(p=i.valid(s))=="string"?c.get(h=p).put(s,a,u):i.is(s)?(c.put(function(_){s.get(function(I,g,S){if(!I)return a.call(c,{err:i.log('Only a node can be linked! Not "'+S.put+'"!')});(p={})[I]={"#":I},_(p)},!0)}),s):(Object.plain(s)&&(s=l.get(h=c.back("opt.uuid")()).put(s)),c.get(h||l.back("opt.uuid")(7)).put(s,a,u))}})(t,"./set"),t(function(r){t("./shim");var i=function(){},s=JSON.parseAsync||function(l,h,p){var _,I=+new Date;try{h(_,JSON.parse(l,p),a.sucks(+new Date-I))}catch(g){h(g)}},a=JSON.stringifyAsync||function(l,h,p,_){var I,g=+new Date;try{h(I,JSON.stringify(l,p,_),a.sucks(+new Date-g))}catch(S){h(S)}};a.sucks=function(l){l>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),a.sucks=i)};function u(l){var h=function(){},p=l.opt||{};p.log=p.log||console.log,p.gap=p.gap||p.wait||0,p.max=p.max||(p.memory?p.memory*999*999:3e8)*.3,p.pack=p.pack||p.max*.01*.01,p.puff=p.puff||9;var _=setTimeout.turn||setTimeout,I=l.dup,g=I.check,S=I.track,b=h.hear=function(m,R){if(m){if(p.max<=m.length)return h.say({dam:"!",err:"Message too big!"},R);h===this&&(b.d+=m.length||0,++b.c);var C=R.SH=+new Date,x=m[0],T;if(x==="["){s(m,function(w,A){if(w||!A)return h.say({dam:"!",err:"DAM JSON parse error."},R);console.STAT&&console.STAT(+new Date,A.length,"# on hear batch");var V=p.puff;(function P(){for(var E=+new Date,d=0,N;d<V&&(N=A[d++]);)h.hear(N,R);A=A.slice(d),console.STAT&&console.STAT(E,+new Date-E,"hear loop"),k(R),A.length&&_(P,0)})()}),m="";return}if(x==="{"||(m["#"]||Object.plain(m))&&(T=m)){if(T)return b.one(T,R,C);s(m,function(w,A){if(w||!A)return h.say({dam:"!",err:"DAM JSON parse error."},R);b.one(A,R,C)});return}}};b.one=function(m,R,P){var x,T,w,A,V;if(m.DBG&&(m.DBG=V={DBG:m.DBG}),V&&(V.h=P),V&&(V.hp=+new Date),(x=m["#"])||(x=m["#"]=String.random(9)),!(w=g(x))&&(T=m["##"],!(T&&(w=m["@"]||m.get&&x)&&I.check(A=w+T)))){if((m._=function(){}).via=h.leap=R,(w=m["><"])&&typeof w=="string"&&w.slice(0,99).split(",").forEach(function(E){this[E]=1},m._.yo={}),w=m.dam){(w=h.hear[w])&&w(m,R,l),S(x);return}(w=m.ok)&&(m._.near=w["/"]);var P=+new Date;V&&(V.is=P),R.SI=x,S.ed=function(E){x===E&&(S.ed=0,(E=I.s[x])&&(E.via=R,m.get&&(E.it=m)))},l.on("in",h.last=m),V&&(V.hd=+new Date),console.STAT&&console.STAT(P,+new Date-P,m.get?"msg get":m.put?"msg put":"msg"),S(x),A&&S(A),h.leap=h.last=null}},b.c=b.d=0,(function(){var m=0,R;h.hash=function(T,w){var A,V,P,E=+new Date;a(T.put,function d(N,O){var U=(V||(V=P=O||"")).slice(0,32768);if(A=String.hash(U,A),V=V.slice(32768),V){_(d,0);return}console.STAT&&console.STAT(E,+new Date-E,"say json+hash"),T._.$put=P,T["##"]=A,h.say(T,w),delete T._.$put},C)};function C(T,w){var A;return w instanceof Object?(Object.keys(w).sort().forEach(x,{to:A={},on:w}),A):w}function x(T){this.to[T]=this.on[T]}h.say=function(T,w){var A;if((A=this)&&(A=A.to)&&A.next&&A.next(T),!T)return!1;var V,P,E,d=T["@"],N=T._||(T._=function(){}),O=T.DBG,U=+new Date;if(N.y=N.y||U,w||O&&(O.y=U),(V=T["#"])||(V=T["#"]=String.random(9)),!R&&S(V),!(P=T["##"])&&c!==T.put&&!N.via&&d){h.hash(T,w);return}if(!w&&d&&(w=(A=I.s[d])&&(A.via||(A=A.it)&&(A=A._)&&A.via)||(A=h.last)&&d===A["#"]&&h.leap),!w&&d)return I.s[d]?void 0:(console.STAT&&console.STAT(+new Date,++m,"total no peer to ack to"),!1);if(d&&!T.put&&!P&&((I.s[d]||"").it||"")["##"])return!1;if(!w&&h.way)return h.way(T);if(O&&(O.yh=+new Date),!(E=N.raw)){h.raw(T,w);return}if(O&&(O.yr=+new Date),!w||!w.id){if(!Object.plain(w||p.peers))return!1;var U=+new Date;p.puff;var F=p.peers,L=Object.keys(w||p.peers||{});console.STAT&&console.STAT(U,+new Date-U,"peer keys"),(function Y(){var Q=+new Date;R=1;var J=N.raw;N.raw=E;for(var lt=0,_t;lt<9&&(_t=(L||"")[lt++]);)(_t=F[_t]||(w||"")[_t])&&h.say(T,_t);N.raw=J,R=0,L=L.slice(lt),console.STAT&&console.STAT(Q,+new Date-Q,"say loop"),L.length&&(_(Y,0),d&&S(d))})();return}if(!w.wire&&h.wire&&h.wire(w),V!==w.last){if(w.last=V,w===N.via||(A=N.yo)&&(A[w.url]||A[w.pid]||A[w.id]))return!1;if(console.STAT&&console.STAT(U,((O||N).yp=+new Date)-(N.y||U),"say prep"),!R&&d&&S(d),w.batch){if(w.tail=(A=w.tail||0)+E.length,w.tail<=p.pack){w.batch+=(A?",":"")+E;return}k(w)}w.batch="[";var $=+new Date;setTimeout(function(){console.STAT&&console.STAT($,+new Date-$,"0ms TO"),k(w)},p.gap),y(E,w),console.STAT&&d===w.SI&&console.STAT(U,+new Date-w.SH,"say ack")}},h.say.c=h.say.d=0,h.raw=function(T,w){if(!T)return"";var A=T._||{},V,P;if(P=A.raw)return P;if(typeof T=="string")return T;var E=T["##"],d=T["@"];if(E&&d){if(!A.via&&g(d+E))return!1;if(P=(I.s[d]||"").it){if(E===P["##"])return!1;P["##"]||(P["##"]=E)}}if(!T.dam&&!T["@"]){var N=0,O=[];P=p.peers;for(var U in P){var F=P[U];if(O.push(F.url||F.pid||F.id),++N>6)break}N>1&&(T["><"]=O.join())}if(T.put&&(P=T.ok)&&(T.ok={"@":(P["@"]||1)-1,"/":P["/"]==T._.near?h.near:P["/"]}),V=A.$put){P={},Object.keys(T).forEach(function($){P[$]=T[$]}),P.put=":])([:",a(P,function($,G){if(!$){var Y=+new Date;P=G.indexOf('"put":":])([:"'),L(c,G=G.slice(0,P+6)+V+G.slice(P+14)),console.STAT&&console.STAT(Y,+new Date-Y,"say slice")}});return}a(T,L);function L($,G){$||(A.raw=G,h.say(T,w))}}})();function k(m){var R=m.batch,C=typeof R=="string";if(C&&(R+="]"),m.batch=m.tail=null,!!R&&!(C?3>R.length:!R.length)){if(!C)try{R=R.length===1?R[0]:JSON.stringify(R)}catch(x){return p.log("DAM JSON stringify error",x)}R&&y(R,m)}}function y(m,R){try{var C=R.wire;R.say?R.say(m):C.send&&C.send(m),h.say.d+=m.length||0,++h.say.c}catch{(R.queue=R.queue||[]).push(m)}}return h.near=0,h.hi=function(m){var R=m.wire,C;if(!R){h.wire(m.length&&{url:m,id:m}||m);return}m.id?p.peers[m.url||m.id]=m:(C=m.id=m.id||m.url||String.random(9),h.say({dam:"?",pid:l.opt.pid},p.peers[C]=m),delete I.s[m.last]),m.met||(h.near++,m.met=+new Date,l.on("hi",m)),C=m.queue,m.queue=[],setTimeout.each(C||[],function(x){y(x,m)},0,9)},h.bye=function(m){m.met&&--h.near,delete m.met,l.on("bye",m);var R=+new Date;R=R-(m.met||R),h.bye.time=((h.bye.time||R)+R)/2},h.hear["!"]=function(m,R){p.log("Error:",m.err)},h.hear["?"]=function(m,R){m.pid&&(R.pid||(R.pid=m.pid),m["@"])||(h.say({dam:"?",pid:p.pid,"@":m["#"]},R),delete I.s[R.last])},h.hear.mob=function(m,R){if(m.peers){var C=Object.keys(m.peers),x=C[Math.random()*C.length>>0];x&&(h.bye(R),h.hi(x))}},l.on("create",function(m){m.opt.pid=m.opt.pid||String.random(9),this.to.next(m),m.on("out",h.say)}),l.on("bye",function(m,R){m=p.peers[m.id||m]||m,this.to.next(m),m.bye?m.bye():(R=m.wire)&&R.close&&R.close(),delete p.peers[m.id],m.wire=null}),l.on("bye",function(m,R){this.to.next(m),(R=console.STAT)&&(R.peers=h.near),(R=m.url)&&setTimeout(function(){},p.lack||9e3)}),l.on("hi",function(m,R){if(this.to.next(m),(R=console.STAT)&&(R.peers=h.near),!p.super){var C=Object.keys(l.next||"");C.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(C,function(x){var T=l.next[x];if(p.super||(T.ask||"")[""]){h.say({get:{"#":x}},m);return}setTimeout.each(Object.keys(T.ask||""),function(w){w&&h.say({"##":String.hash((l.graph[x]||"")[w]),get:{"#":x,".":w}},m)})})}}),h}var c;try{r.exports=u}catch{}})(t,"./mesh"),t(function(r){var i=t("./index");i.Mesh=t("./mesh"),i.on("opt",function(a){if(this.to.next(a),a.once)return;var u=a.opt;if(u.WebSocket===!1)return;var c=i.window||{},l=u.WebSocket||c.WebSocket||c.webkitWebSocket||c.mozWebSocket;if(!l)return;u.WebSocket=l;var h=u.mesh=u.mesh||i.Mesh(a);h.wire||u.wire,h.wire=u.wire=p;function p(S){try{if(!S||!S.url)return k&&k(S);var b=S.url.replace(/^http/,"ws"),k=S.wire=new u.WebSocket(b);return k.onclose=function(){I(S),u.mesh.bye(S)},k.onerror=function(y){I(S)},k.onopen=function(){u.mesh.hi(S)},k.onmessage=function(y){y&&u.mesh.hear(y.data||y,S)},k}catch{u.mesh.bye(S)}}setTimeout(function(){!u.super&&a.on("out",{dam:"hi"})},1);var _=2*999;function I(S){clearTimeout(S.defer),u.peers[S.url]&&(g&&S.retry<=0||(S.retry=(S.retry||u.retry+1||60)-(-S.tried+(S.tried=+new Date)<_*4?1:0),S.defer=setTimeout(function b(){if(g&&g.hidden)return setTimeout(b,_);p(S)},_)))}var g=""+s!=typeof document&&document});var s})(t,"./websocket"),t(function(r){if(!(typeof Gun>"u")){var i=function(){},s;try{s=(Gun.window||i).localStorage}catch{}s||(Gun.log("Warning: No localStorage exists to persist data to!"),s={setItem:function(u,c){this[u]=c},removeItem:function(u){delete this[u]},getItem:function(u){return this[u]}});var a=JSON.stringifyAsync||function(u,c,l,h){var p;try{c(p,JSON.stringify(u,l,h))}catch(_){c(_)}};Gun.on("create",function u(c){this.to.next(c);var l=c.opt;c.graph;var h=[],p,_,I,g;if(l.localStorage===!1)return;l.prefix=l.file||"gun/";try{p=u[l.prefix]=u[l.prefix]||JSON.parse(I=s.getItem(l.prefix))||{}}catch{p=u[l.prefix]={}}I=(I||"").length,c.on("get",function(b){this.to.next(b);var k=b.get,y,m,R,C;!k||!(y=k["#"])||(m=p[y]||C,m&&(R=k["."])&&!Object.plain(R)&&(m=Gun.state.ify({},R,Gun.state.is(m,R),m[R],y)),Gun.on.get.ack(b,m))}),c.on("put",function(b){this.to.next(b);var k=b.put,y=k["#"],m=k["."],R=b["#"],C=b.ok||"";if((c.next||"")[y]){if(p[y]=Gun.state.ify(p[y],m,k[">"],k[":"],y),g&&I>4999880){c.on("in",{"@":R,err:"localStorage max!"});return}!b["@"]&&(!b._.via||Math.random()<C["@"]/C["/"])&&h.push(R),!_&&(_=setTimeout(S,9+I/333))}});function S(){if(!h.length&&((setTimeout.turn||"").s||"").length){setTimeout(S,99);return}var b=h;clearTimeout(_),_=!1,h=[],a(p,function(k,y){try{!k&&s.setItem(l.prefix,y)}catch(m){k=g=m||"localStorage failure"}k&&(Gun.log(k+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),c.on("localStorage:error",{err:k,get:l.prefix,put:p})),I=y.length,setTimeout.each(b,function(m){c.on("in",{"@":m,err:k,ok:0})},0,99)})}})}})(t,"./localStorage")})(),(function(){var P;if(""+P!=typeof Gun){var t=function(E){console.warn("Warning! Deprecated internal utility will break in next version:",E)},e=Gun;e.fn=e.fn||{is:function(E){return t("fn"),!!E&&typeof E=="function"}},e.bi=e.bi||{is:function(E){return t("bi"),E instanceof Boolean||typeof E=="boolean"}},e.num=e.num||{is:function(E){return t("num"),!r(E)&&(E-parseFloat(E)+1>=0||E===1/0||E===-1/0)}},e.text=e.text||{is:function(E){return t("text"),typeof E=="string"}},e.text.ify=e.text.ify||function(E){return t("text.ify"),e.text.is(E)?E:typeof JSON<"u"?JSON.stringify(E):E&&E.toString?E.toString():E},e.text.random=e.text.random||function(E,d){t("text.random");var N="";for(E=E||24,d=d||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";E>0;)N+=d.charAt(Math.floor(Math.random()*d.length)),E--;return N},e.text.match=e.text.match||function(E,d){var N,O;return t("text.match"),typeof E!="string"?!1:(typeof d=="string"&&(d={"=":d}),d=d||{},N=d["="]||d["*"]||d[">"]||d["<"],E===N?!0:O!==d["="]?!1:(N=d["*"]||d[">"]||d["<"],E.slice(0,(N||"").length)===N?!0:O!==d["*"]?!1:O!==d[">"]&&O!==d["<"]?E>=d[">"]&&E<=d["<"]:O!==d[">"]&&E>=d[">"]||O!==d["<"]&&E<=d["<"]))},e.text.hash=e.text.hash||function(E,d){if(t("text.hash"),typeof E=="string"){if(d=d||0,!E.length)return d;for(var N=0,O=E.length,U;N<O;++N)U=E.charCodeAt(N),d=(d<<5)-d+U,d|=0;return d}},e.list=e.list||{is:function(E){return t("list"),E instanceof Array}},e.list.slit=e.list.slit||Array.prototype.slice,e.list.sort=e.list.sort||function(E){return t("list.sort"),function(d,N){return!d||!N?0:(d=d[E],N=N[E],d<N?-1:d>N?1:0)}},e.list.map=e.list.map||function(E,d,N){return t("list.map"),A(E,d,N)},e.list.index=1,e.obj=e.boj||{is:function(E){return t("obj"),E?E instanceof Object&&E.constructor===Object||Object.prototype.toString.call(E).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},e.obj.put=e.obj.put||function(E,d,N){return t("obj.put"),(E||{})[d]=N,E},e.obj.has=e.obj.has||function(E,d){return t("obj.has"),E&&Object.prototype.hasOwnProperty.call(E,d)},e.obj.del=e.obj.del||function(E,d){if(t("obj.del"),!!E)return E[d]=null,delete E[d],E},e.obj.as=e.obj.as||function(E,d,N,O){return t("obj.as"),E[d]=E[d]||(O===N?{}:N)},e.obj.ify=e.obj.ify||function(E){if(t("obj.ify"),R(E))return E;try{E=JSON.parse(E)}catch{E={}}return E},(function(){var E;function d(N,O){x(this,O)&&E!==this[O]||(this[O]=N)}e.obj.to=e.obj.to||function(N,O){return t("obj.to"),O=O||{},A(N,d,O),O}})(),e.obj.copy=e.obj.copy||function(E){return t("obj.copy"),E&&JSON.parse(JSON.stringify(E))},(function(){function E(d,N){var O=this.n,U;if(!(O&&(N===O||R(O)&&x(O,N)))&&U!==N)return!0}e.obj.empty=e.obj.empty||function(d,N){return t("obj.empty"),d?!A(d,E,{n:N}):!0}})(),(function(){function E(O,U){if(arguments.length===2){E.r=E.r||{},E.r[O]=U;return}E.r=E.r||[],E.r.push(O)}var d=Object.keys,N;Object.keys=Object.keys||function(O){return N(O,function(U,F,L){L(F)})},e.obj.map=N=e.obj.map||function(O,U,F){t("obj.map");var L,$=0,G,Y,Q,J,lt=typeof U=="function";if(E.r=L,d&&R(O)&&(Q=d(O),J=!0),F=F||{},r(O)||Q)for(G=(Q||O).length;$<G;$++){var _t=$+e.list.index;if(lt){if(Y=J?U.call(F,O[Q[$]],Q[$],E):U.call(F,O[$],_t,E),Y!==L)return Y}else if(U===O[J?Q[$]:$])return Q?Q[$]:_t}else for($ in O)if(lt){if(x(O,$)&&(Y=F?U.call(F,O[$],$,E):U(O[$],$,E),Y!==L))return Y}else if(U===O[$])return $;return lt?E.r:e.list.index?0:-1}})(),e.time=e.time||{},e.time.is=e.time.is||function(E){return t("time"),E?E instanceof Date:+new Date().getTime()};var y=e.fn.is,r=e.list.is,m=e.obj,R=m.is,x=m.has,A=m.map,i={};i.is=function(E){return t("val.is"),E===P?!1:E===null?!0:E===1/0?!1:u(E)||a(E)||g(E)?!0:i.link.is(E)||!1},i.link=i.rel={_:"#"},(function(){i.link.is=function(d){if(t("val.link.is"),d&&d[s]&&!d._&&R(d)){var N={};if(A(d,E,N),N.id)return N.id}return!1};function E(d,N){var O=this;if(O.id)return O.id=!1;if(N==s&&u(d))O.id=d;else return O.id=!1}})(),i.link.ify=function(E){return t("val.link.ify"),w({},s,E)},e.obj.has._=".";var s=i.link._,P,a=e.bi.is,g=e.num.is,u=e.text.is,m=e.obj,R=m.is,w=m.put,A=m.map;e.val=e.val||i;var c={_:"_"};c.soul=function(E,d){return t("node.soul"),E&&E._&&E._[d||p]},c.soul.ify=function(E,d){return t("node.soul.ify"),d=typeof d=="string"?{soul:d}:d||{},E=E||{},E._=E._||{},E._[p]=d.soul||E._[p]||h(),E},c.soul._=i.link._,(function(){c.is=function(d,N,O){t("node.is");var U;return R(d)&&(U=c.soul(d))?!A(d,E,{as:O,cb:N,s:U,n:d}):!1};function E(d,N){if(N!==c._){if(!i.is(d))return!0;this.cb&&this.cb.call(this.as,d,N,this.n,this.s)}}})(),(function(){c.ify=function(d,N,O){return t("node.ify"),N?typeof N=="string"?N={soul:N}:typeof N=="function"&&(N={map:N}):N={},N.map&&(N.node=N.map.call(O,d,P,N.node||{})),(N.node=c.soul.ify(N.node||{},N))&&A(d,E,{o:N,as:O}),N.node};function E(d,N){var O=this.o,U,F;if(O.map){U=O.map.call(this.as,d,""+N,O.node),F===U?C(O.node,N):O.node&&(O.node[N]=U);return}i.is(d)&&(O.node[N]=d)}})();var m=e.obj,R=m.is,C=m.del,A=m.map,l=e.text,h=l.random,p=c.soul._,P;e.node=e.node||c;var _=e.state;_.lex=function(){return t("state.lex"),_().toString(36).replace(".","")},_.to=function(E,d,N){t("state.to");var O=(E||{})[d];return R(O)&&(O=V(O)),_.ify(N,d,_.is(E,d),O,c.soul(E))},(function(){_.map=function(d,N,O){t("state.map");var U,F=R(F=d||N)?F:null;return d=y(d=d||N)?d:null,F&&!d?(N=g(N)?N:_(),F[b]=F[b]||{},A(F,E,{o:F,s:N}),F):(O=O||R(N)?N:U,N=g(N)?N:_(),function(L,$,G,Y){if(!d)return E.call({o:G,s:N},L,$),L;d.call(O||this||{},L,$,G,Y),!(x(G,$)&&U===G[$])&&E.call({o:G,s:N},L,$)})};function E(d,N){b!==N&&_.ify(this.o,N,this.s)}})();var m=e.obj;m.as;var x=m.has,R=m.is,A=m.map,V=m.copy,I=e.num,g=I.is,S=e.fn,y=S.is,b=c._,P,k={};(function(){k.is=function(N,O,U,F){return t("graph.is"),!N||!R(N)||T(N)?!1:!A(N,E,{cb:O,fn:U,as:F})};function E(N,O){if(!N||O!==c.soul(N)||!c.is(N,this.fn,this.as))return!0;this.cb&&(d.n=N,d.as=this.as,this.cb.call(d.as,N,O,d))}function d(N){N&&c.is(d.n,N,d.as)}})(),(function(){k.ify=function(F,L,$){t("graph.ify");var G={path:[],obj:F};return L?typeof L=="string"?L={soul:L}:typeof L=="function"&&(L.map=L):L={},typeof $=="string"&&(L.soul=L.soul||$,$=P),L.soul&&(G.link=i.link.ify(L.soul)),L.shell=($||{}).shell,L.graph=L.graph||{},L.seen=L.seen||[],L.as=L.as||$,E(L,G),L.root=G.node,L.graph};function E(F,L){var $;return($=U(F,L))?$:(L.env=F,L.soul=N,c.ify(L.obj,d,L)&&(L.link=L.link||i.link.ify(c.soul(L.node)),L.obj!==F.shell&&(F.graph[i.link.is(L.link)]=L.node)),L)}function d(F,L,$){var G=this,Y=G.env,Q,J;if(c._===L&&x(F,i.link._))return $._;if(Q=O(F,L,$,G,Y)){if(L||(G.node=G.node||$||{},x(F,c._)&&c.soul(F)&&(G.node._=V(F._)),G.node=c.soul.ify(G.node,i.link.is(G.link)),G.link=G.link||i.link.ify(c.soul(G.node))),(J=Y.map)&&(J.call(Y.as||{},F,L,$,G),x($,L))){if(F=$[L],P===F){C($,L);return}if(!(Q=O(F,L,$,G,Y)))return}if(!L)return G.node;if(Q===!0)return F;if(J=E(Y,{obj:F,path:G.path.concat(L)}),!!J.node)return J.link}}function N(F){var L=this,$=i.link.is(L.link),G=L.env.graph;L.link=L.link||i.link.ify(F),L.link[i.link._]=F,L.node&&L.node[c._]&&(L.node[c._][i.link._]=F),x(G,$)&&(G[F]=G[$],C(G,$))}function O(F,L,$,G,Y){var Q;if(i.is(F))return!0;if(R(F))return 1;if(Q=Y.invalid)return F=Q.call(Y.as||{},F,L,$),O(F,L,$,G,Y);Y.err="Invalid value at '"+G.path.concat(L).join(".")+"'!",e.list.is(F)&&(Y.err+=" Use `.set(item)` instead of an Array.")}function U(F,L){for(var $=F.seen,G=$.length,Y;G--;)if(Y=$[G],L.obj===Y.obj)return Y;$.push(L)}})(),k.node=function(E){t("graph.node");var d=c.soul(E);if(d)return w({},d,E)},(function(){k.to=function(d,N,O){if(t("graph.to"),!!d){var U={};return O=O||{seen:{}},A(d[N],E,{obj:U,graph:d,opt:O}),U}};function E(d,N){var O,U;if(c._===N){if(T(d,i.link._))return;this.obj[N]=V(d);return}if(!(O=i.link.is(d))){this.obj[N]=d;return}if(U=this.opt.seen[O]){this.obj[N]=U;return}this.obj[N]=this.opt.seen[O]=k.to(this.graph,O,this.opt)}})();var y=e.fn.is,m=e.obj,R=m.is,C=m.del,x=m.has,T=m.empty,w=m.put,A=m.map,V=m.copy,P;e.graph=e.graph||k}})()})(Wi)),Wi.exports}var Eo,Il;function wg(){return Il||(Il=1,Eo=ka()),Eo}var Eg=wg();const $o=Ca(Eg);var Qi={exports:{}};Qi.exports;var Sl;function Tg(){return Sl||(Sl=1,(function(n){(function(){function t(r,i){return i?Ph(r):r.slice?t[s(r)]:function(a,u){r(a={exports:{}}),t[s(u)]=a.exports};function s(a){return a.split("/").slice(-1).toString().replace(".js","")}}var e=n;t(function(r){typeof self<"u"&&(r.window=self),typeof window<"u"&&(r.window=window);var i=r.window||r,s,a=i.SEA||{};(a.window=r.window)&&(a.window.SEA=a);try{s+""!=typeof e&&(e.exports=a)}catch{}r.exports=a})(t,"./root"),t(function(r){var i=t("./root");try{i.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(t,"./https"),t(function(r){var i;if(i+""==typeof btoa){if(i+""==typeof Buffer)try{En.Buffer=t("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}En.btoa=function(s){return Buffer.from(s,"binary").toString("base64")},En.atob=function(s){return Buffer.from(s,"base64").toString("binary")}}})(t,"./base64"),t(function(r){t("./base64");function i(){}Object.assign(i,{from:Array.from}),i.prototype=Object.create(Array.prototype),i.prototype.toString=function(s,a,u){s=s||"utf8",a=a||0;const c=this.length;if(s==="hex"){const l=new Uint8Array(this);return[...Array((u&&u+1||c)-a).keys()].map(h=>l[h+a].toString(16).padStart(2,"0")).join("")}if(s==="utf8")return Array.from({length:(u||c)-a},(l,h)=>String.fromCharCode(this[h+a])).join("");if(s==="base64")return btoa(this)},r.exports=i})(t,"./array"),t(function(r){t("./base64");var i=t("./array");function s(...a){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),s.from(...a)}s.prototype=Object.create(Array.prototype),Object.assign(s,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const a=arguments[0];let u;if(typeof a=="string"){const l=arguments[1]||"utf8";if(l==="hex"){const h=a.match(/([\da-fA-F]{2})/g).map(p=>parseInt(p,16));if(!h||!h.length)throw new TypeError("Invalid first argument for type 'hex'.");u=i.from(h)}else if(l==="utf8"||l==="binary"){const h=a.length,p=new Uint16Array(h);Array.from({length:h},(_,I)=>p[I]=a.charCodeAt(I)),u=i.from(p)}else if(l==="base64"){const h=atob(a),p=h.length,_=new Uint8Array(p);Array.from({length:p},(I,g)=>_[g]=h.charCodeAt(g)),u=i.from(_)}else l==="binary"?u=i.from(a):console.info("SafeBuffer.from unknown encoding: "+l);return u}if(a.byteLength,a.byteLength?a.byteLength:a.length){let l;return a instanceof ArrayBuffer&&(l=new Uint8Array(a)),i.from(l||a)}},alloc(a,u=0){return i.from(new Uint8Array(Array.from({length:a},()=>u)))},allocUnsafe(a){return i.from(new Uint8Array(Array.from({length:a})))},concat(a){if(!Array.isArray(a))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return i.from(a.reduce((u,c)=>u.concat(Array.from(c)),[]))}}),s.prototype.from=s.from,s.prototype.toString=i.prototype.toString,r.exports=s})(t,"./buffer"),t(function(r){const i=t("./root"),s={Buffer:t("./buffer")};var a={},u;if(JSON.parseAsync=JSON.parseAsync||function(l,h,p){var _;try{h(_,JSON.parse(l,p))}catch(I){h(I)}},JSON.stringifyAsync=JSON.stringifyAsync||function(l,h,p,_){var I;try{h(I,JSON.stringify(l,p,_))}catch(g){h(g)}},s.parse=function(l,h){return new Promise(function(p,_){JSON.parseAsync(l,function(I,g){I?_(I):p(g)},h)})},s.stringify=function(l,h,p){return new Promise(function(_,I){JSON.stringifyAsync(l,function(g,S){g?I(g):_(S)},h,p)})},i.window&&(s.crypto=i.window.crypto||i.window.msCrypto,s.subtle=(s.crypto||a).subtle||(s.crypto||a).webkitSubtle,s.TextEncoder=i.window.TextEncoder,s.TextDecoder=i.window.TextDecoder,s.random=l=>s.Buffer.from(s.crypto.getRandomValues(new Uint8Array(s.Buffer.alloc(l))))),!s.TextDecoder){const{TextEncoder:l,TextDecoder:h}=t((u+""==typeof e?".":"")+"./lib/text-encoding",1);s.TextDecoder=h,s.TextEncoder=l}if(!s.crypto)try{var c=t("crypto",1);Object.assign(s,{crypto:c,random:h=>s.Buffer.from(c.randomBytes(h))});const{Crypto:l}=t("@peculiar/webcrypto",1);s.ossl=s.subtle=new l({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}r.exports=s})(t,"./shim"),t(function(r){var i=t("./root"),s=t("./shim"),a={};a.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},a.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},a.ecdh={name:"ECDH",namedCurve:"P-256"},a.jwk=function(u,c){u=u.split(".");var l=u[0],h=u[1],p={kty:"EC",crv:"P-256",x:l,y:h,ext:!0};return p.key_ops=c?["sign"]:["verify"],c&&(p.d=c),p},a.keyToJwk=function(u){return{kty:"oct",k:u.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},a.recall={validity:720*60,hook:function(u){return u}},a.check=function(u){return typeof u=="string"&&u.slice(0,4)==="SEA{"},a.parse=async function(c){try{var l=typeof c=="string";return l&&c.slice(0,4)==="SEA{"&&(c=c.slice(3)),l?await s.parse(c):c}catch{}return c},i.opt=a,r.exports=a})(t,"./settings"),t(function(r){var i=t("./shim");r.exports=async function(s,a){var u=typeof s=="string"?s:await i.stringify(s),c=await i.subtle.digest({name:a||"SHA-256"},new i.TextEncoder().encode(u));return i.Buffer.from(c)}})(t,"./sha256"),t(function(r){const i=t("./shim"),s=i.subtle,a=i.ossl?i.ossl:s,u=c=>a.digest({name:"SHA-1"},new ArrayBuffer(c));r.exports=u})(t,"./sha1"),t(function(r){var i=t("./root"),s=t("./shim"),a=t("./settings"),u=t("./sha256"),c;i.work=i.work||(async(l,h,p,_)=>{try{var I=(h||{}).epub||h;if(_=_||{},I instanceof Function&&(p=I,I=c),l=typeof l=="string"?l:await s.stringify(l),(_.name||"").toLowerCase().slice(0,3)==="sha"){var g=s.Buffer.from(await u(l,_.name),"binary").toString(_.encode||"base64");if(p)try{p(g)}catch(y){console.log(y)}return g}I=I||s.random(9);var S=await(s.ossl||s.subtle).importKey("raw",new s.TextEncoder().encode(l),{name:_.name||"PBKDF2"},!1,["deriveBits"]),b=await(s.ossl||s.subtle).deriveBits({name:_.name||"PBKDF2",iterations:_.iterations||a.pbkdf2.iter,salt:new s.TextEncoder().encode(_.salt||I),hash:_.hash||a.pbkdf2.hash},S,_.length||a.pbkdf2.ks*8);l=s.random(l.length);var k=s.Buffer.from(b,"binary").toString(_.encode||"base64");if(p)try{p(k)}catch(y){console.log(y)}return k}catch(y){if(console.log(y),i.err=y,i.throw)throw y;p&&p();return}}),r.exports=i.work})(t,"./work"),t(function(r){var i=t("./root"),s=t("./shim");t("./settings"),i.name=i.name||(async(a,u)=>{try{if(a)try{a()}catch(c){console.log(c)}return}catch(c){if(console.log(c),i.err=c,i.throw)throw c;a&&a();return}}),i.pair=i.pair||(async(a,u)=>{try{var c=s.ossl||s.subtle,l=await s.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async _=>{var I={};I.priv=(await s.subtle.exportKey("jwk",_.privateKey)).d;var g=await s.subtle.exportKey("jwk",_.publicKey);return I.pub=g.x+"."+g.y,I});try{var h=await c.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async _=>{var I={};I.epriv=(await c.exportKey("jwk",_.privateKey)).d;var g=await c.exportKey("jwk",_.publicKey);return I.epub=g.x+"."+g.y,I})}catch(_){if(i.window)throw _;if(_=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw _}h=h||{};var p={pub:l.pub,priv:l.priv,epub:h.epub,epriv:h.epriv};if(a)try{a(p)}catch(_){console.log(_)}return p}catch(_){if(console.log(_),i.err=_,i.throw)throw _;a&&a();return}}),r.exports=i.pair})(t,"./pair"),t(function(r){var i=t("./root"),s=t("./shim"),a=t("./settings"),u=t("./sha256"),c;i.sign=i.sign||(async(l,h,p,_)=>{try{if(_=_||{},!(h||_).priv){if(!i.I)throw"No signing key.";h=await i.I(null,{what:l,how:"sign",why:_.why})}if(c===l)throw"`undefined` not allowed.";var I=await a.parse(l),g=_.check=_.check||I;if(i.verify&&(i.opt.check(g)||g&&g.s&&g.m)&&c!==await i.verify(g,h)){var R=await a.parse(g);if(_.raw||(R="SEA"+await s.stringify(R)),p)try{p(R)}catch(x){console.log(x)}return R}var S=h.pub,b=h.priv,k=a.jwk(S,b),y=await u(I),m=await(s.ossl||s.subtle).importKey("jwk",k,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(C=>(s.ossl||s.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},C,new Uint8Array(y))),R={m:I,s:s.Buffer.from(m,"binary").toString(_.encode||"base64")};if(_.raw||(R="SEA"+await s.stringify(R)),p)try{p(R)}catch(C){console.log(C)}return R}catch(C){if(console.log(C),i.err=C,i.throw)throw C;p&&p();return}}),r.exports=i.sign})(t,"./sign"),t(function(r){var i=t("./root"),s=t("./shim"),a=t("./settings"),u=t("./sha256"),c;i.verify=i.verify||(async(p,_,I,g)=>{try{var S=await a.parse(p);if(_===!1){var b=await a.parse(S.m);if(I)try{I(b)}catch(A){console.log(A)}return b}g=g||{};var k=_.pub||_,y=i.opt.slow_leak?await i.opt.slow_leak(k):await(s.ossl||s.subtle).importKey("jwk",a.jwk(k),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),m=await u(S.m),R,C,x,T;try{if(R=s.Buffer.from(S.s,g.encode||"base64"),C=new Uint8Array(R),x=await(s.ossl||s.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},y,C,new Uint8Array(m)),!x)throw"Signature did not match."}catch{if(i.opt.fallback)return await i.opt.fall_verify(p,_,I,g)}var w=x?await a.parse(S.m):c;if(I)try{I(w)}catch(A){console.log(A)}return w}catch(A){if(console.log(A),i.err=A,i.throw)throw A;I&&I();return}}),r.exports=i.verify;var l={};i.opt.slow_leak=p=>{if(l[p])return l[p];var _=a.jwk(p);return l[p]=(s.ossl||s.subtle).importKey("jwk",_,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),l[p]};var h=i.opt;i.opt.fall_verify=async function(p,_,I,g,S){if(S===i.opt.fallback)throw"Signature did not match";S=S||1;var b=p||"";p=i.opt.unpack(p)||p;var k=await a.parse(p),y=_.pub||_,m=await i.opt.slow_leak(y),R=S<=i.opt.fallback?s.Buffer.from(await s.subtle.digest({name:"SHA-256"},new s.TextEncoder().encode(await a.parse(k.m)))):await u(k.m),C,x,T;try{if(C=s.Buffer.from(k.s,g.encode||"base64"),x=new Uint8Array(C),T=await(s.ossl||s.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},m,x,new Uint8Array(R)),!T)throw"Signature did not match."}catch{try{C=s.Buffer.from(k.s,"utf8"),x=new Uint8Array(C),T=await(s.ossl||s.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},m,x,new Uint8Array(R))}catch{if(!T)throw"Signature did not match."}}var w=T?await a.parse(k.m):c;if(h.fall_soul=b["#"],h.fall_key=b["."],h.fall_val=p,h.fall_state=b[">"],I)try{I(w)}catch(A){console.log(A)}return w},i.opt.fallback=2})(t,"./verify"),t(function(r){var i=t("./shim"),s=t("./settings"),a=t("./sha256");const u=async(c,l,h)=>{const p=c+(l||i.random(8)).toString("utf8"),_=i.Buffer.from(await a(p),"binary"),I=s.keyToJwk(_);return await i.subtle.importKey("jwk",I,{name:"AES-GCM"},!1,["encrypt","decrypt"])};r.exports=u})(t,"./aeskey"),t(function(r){var i=t("./root"),s=t("./shim");t("./settings");var a=t("./aeskey"),u;i.encrypt=i.encrypt||(async(c,l,h,p)=>{try{p=p||{};var _=(l||p).epriv||l;if(u===c)throw"`undefined` not allowed.";if(!_){if(!i.I)throw"No encryption key.";l=await i.I(null,{what:c,how:"encrypt",why:p.why}),_=l.epriv||l}var I=typeof c=="string"?c:await s.stringify(c),g={s:s.random(9),iv:s.random(15)},S=await a(_,g.s,p).then(k=>s.subtle.encrypt({name:p.name||"AES-GCM",iv:new Uint8Array(g.iv)},k,new s.TextEncoder().encode(I))),b={ct:s.Buffer.from(S,"binary").toString(p.encode||"base64"),iv:g.iv.toString(p.encode||"base64"),s:g.s.toString(p.encode||"base64")};if(p.raw||(b="SEA"+await s.stringify(b)),h)try{h(b)}catch(k){console.log(k)}return b}catch(k){if(console.log(k),i.err=k,i.throw)throw k;h&&h();return}}),r.exports=i.encrypt})(t,"./encrypt"),t(function(r){var i=t("./root"),s=t("./shim"),a=t("./settings"),u=t("./aeskey");i.decrypt=i.decrypt||(async(c,l,h,p)=>{try{p=p||{};var _=(l||p).epriv||l;if(!_){if(!i.I)throw"No decryption key.";l=await i.I(null,{what:c,how:"decrypt",why:p.why}),_=l.epriv||l}var I=await a.parse(c),g,S,b;try{g=s.Buffer.from(I.s,p.encode||"base64"),S=s.Buffer.from(I.iv,p.encode||"base64"),b=s.Buffer.from(I.ct,p.encode||"base64");var k=await u(_,g,p).then(m=>s.subtle.decrypt({name:p.name||"AES-GCM",iv:new Uint8Array(S),tagLength:128},m,new Uint8Array(b)))}catch{if(p.encode==="utf8")throw"Could not decrypt";if(i.opt.fallback)return p.encode="utf8",await i.decrypt(c,l,h,p)}var y=await a.parse(new s.TextDecoder("utf8").decode(k));if(h)try{h(y)}catch(m){console.log(m)}return y}catch(m){if(console.log(m),i.err=m,i.throw)throw m;h&&h();return}}),r.exports=i.decrypt})(t,"./decrypt"),t(function(r){var i=t("./root"),s=t("./shim");t("./settings"),i.secret=i.secret||(async(u,c,l,h)=>{try{if(h=h||{},!c||!c.epriv||!c.epub){if(!i.I)throw"No secret mix.";c=await i.I(null,{what:u,how:"secret",why:h.why})}var p=u.epub||u,_=c.epub,I=c.epriv,g=s.ossl||s.subtle,S=a(p),b=Object.assign({public:await g.importKey(...S,!0,[])},{name:"ECDH",namedCurve:"P-256"}),k=a(_,I),y=await g.importKey(...k,!1,["deriveBits"]).then(async R=>{var C=await g.deriveBits(b,R,256),x=new Uint8Array(C),T=await g.importKey("raw",x,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return g.exportKey("jwk",T).then(({k:w})=>w)}),m=y;if(l)try{l(m)}catch(R){console.log(R)}return m}catch(R){if(console.log(R),i.err=R,i.throw)throw R;l&&l();return}});var a=(u,c)=>{var[l,h]=u.split("."),p=c?{d:c}:{};return["jwk",Object.assign(p,{x:l,y:h,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};r.exports=i.secret})(t,"./secret"),t(function(r){var i=t("./root");i.certify=i.certify||(async(s,a={},u,c,l={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),s=(()=>{var m=[];if(s){if((typeof s=="string"||Array.isArray(s))&&s.indexOf("*")>-1)return"*";if(typeof s=="string")return s;if(Array.isArray(s)){if(s.length===1&&s[0])return typeof s[0]=="object"&&s[0].pub?s[0].pub:typeof s[0]=="string"?s[0]:null;s.map(R=>{typeof R=="string"?m.push(R):typeof R=="object"&&R.pub&&m.push(R.pub)})}return typeof s=="object"&&s.pub?s.pub:m.length>0?m:null}})(),!s)return console.log("No certificant found.");const p=l.expiry&&(typeof l.expiry=="number"||typeof l.expiry=="string")?parseFloat(l.expiry):null,_=(a||{}).read?a.read:null,I=(a||{}).write?a.write:typeof a=="string"||Array.isArray(a)||a["+"]||a["#"]||a["."]||a["="]||a["*"]||a[">"]||a["<"]?a:null,g=(l||{}).block||(l||{}).blacklist||(l||{}).ban||{},S=g.read&&(typeof g.read=="string"||(g.read||{})["#"])?g.read:null,b=typeof g=="string"?g:g.write&&(typeof g.write=="string"||g.write["#"])?g.write:null;if(!_&&!I)return console.log("No policy found.");const k=JSON.stringify({c:s,...p?{e:p}:{},..._?{r:_}:{},...I?{w:I}:{},...S?{rb:S}:{},...b?{wb:b}:{}});var h=await i.sign(k,u,null,{raw:1});if(l.raw||(h="SEA"+JSON.stringify(h)),c)try{c(h)}catch(m){console.log(m)}return h}catch(p){if(i.err=p,i.throw)throw p;c&&c();return}}),r.exports=i.certify})(t,"./certify"),t(function(r){var i=t("./shim"),s=t("./root");s.work=t("./work"),s.sign=t("./sign"),s.verify=t("./verify"),s.encrypt=t("./encrypt"),s.decrypt=t("./decrypt"),s.certify=t("./certify"),s.random=s.random||i.random,s.Buffer=s.Buffer||t("./buffer"),s.keyid=s.keyid||(async a=>{try{const u=i.Buffer.concat(a.replace(/-/g,"+").replace(/_/g,"/").split(".").map(p=>i.Buffer.from(p,"base64"))),c=i.Buffer.concat([i.Buffer.from([153,u.length/256,u.length%256]),u]),l=await sha1hash(c),h=i.Buffer.from(l,"binary");return h.toString("hex",h.length-8)}catch(u){throw console.log(u),u}}),((s.window||{}).GUN||{}).SEA=s,r.exports=s})(t,"./sea"),t(function(r){var i=t("./sea"),s,a;i.window?s=i.window.GUN||{chain:{}}:s=t((a+""==typeof e?".":"")+"./gun",1),i.GUN=s;function u(l){this._={$:this}}u.prototype=(function(){function l(){}return l.prototype=s.chain,new l})(),u.prototype.constructor=u,s.chain.user=function(l){var h=this,_=h.back(-1),p;if(l)return l=i.opt.pub((l._||"")["#"])||l,_.get("~"+l);if(p=_.back("user"))return p;var _=_._,I=_,g=I.opt.uuid||c;return(I=(p=I.user=h.chain(new u))._).opt={},I.opt.uuid=function(S){var b=g(),k=_.user;return!k||!(k=k.is)||!(k=k.pub)||(b="~"+k+"/"+b,S&&S.call&&S(null,b)),b},p};function c(){return s.state().toString(36).replace(".","")}s.User=u,u.GUN=s,u.SEA=s.SEA=i,r.exports=u})(t,"./user"),t(function(r){var i,s=""+i!=typeof GUN?GUN||{chain:{}}:t((""+i==typeof e?".":"")+"./gun",1);s.chain.then=function(a,u){var c=this,l=new Promise(function(h,p){c.once(h,u)});return a?l.then(a):l}})(t,"./then"),t(function(r){var i=t("./user"),s=i.SEA,a=i.GUN,u=function(){};i.prototype.create=function(...c){var l=typeof c[0]=="object"&&(c[0].pub||c[0].epub)?c[0]:typeof c[1]=="object"&&(c[1].pub||c[1].epub)?c[1]:null,h=l&&(l.pub||l.epub)?l.pub:typeof c[0]=="string"?c[0]:null,p=l&&(l.pub||l.epub)?l:h&&typeof c[1]=="string"?c[1]:null,_=c.filter(m=>typeof m=="function")[0]||null,I=c&&c.length>1&&typeof c[c.length-1]=="object"?c[c.length-1]:{},g=this,S=g._,b=g.back(-1);if(_=_||u,I=I||{},I.check!==!1){var k;if(h||(k="No user."),(p||"").length<8&&(k="Password too short!"),k)return _({err:a.log(k)}),g}if(S.ing)return(_||u)({err:a.log("User is already being created or authenticated!"),wait:!0}),g;S.ing=!0;var y={};return y.a=function(m){if(y.pubs=m,m&&!I.already){var R={err:a.log("User already created!")};S.ing=!1,(_||u)(R),g.leave();return}y.salt=String.random(64),s.work(p,y.salt,y.b)},y.b=function(m){y.proof=m,l?y.c(l):s.pair(y.c)},y.c=function(m){var R;y.pair=m||{},(R=S.root.user)&&(R._.sea=m,R.is={pub:m.pub,epub:m.epub,alias:h}),y.data={pub:m.pub},y.d()},y.d=function(){y.data.alias=h,y.e()},y.e=function(){y.data.epub=y.pair.epub,s.encrypt({priv:y.pair.priv,epriv:y.pair.epriv},y.proof,y.f,{raw:1})},y.f=function(m){y.data.auth=JSON.stringify({ek:m,s:y.salt}),y.g(y.data.auth)},y.g=function(m){var R;y.data.auth=y.data.auth||m,b.get(R="~"+y.pair.pub).put(y.data).on(y.h);var C={};C[R]={"#":R},b.get("~@"+h).put(C).get(R).on(y.i)},y.h=function(m,R,C,x){x.off(),y.h.ok=1,y.i()},y.i=function(m,R,C,x){x&&(y.i.ok=1,x.off()),!(!y.h.ok||!y.i.ok)&&(S.ing=!1,_({ok:0,pub:y.pair.pub}),u===_&&(l?g.auth(l):g.auth(h,p)))},b.get("~@"+h).once(y.a),g},i.prototype.leave=function(c,l){var h=this,p=h.back(-1)._.user;if(p&&(delete p.is,delete p._.is,delete p._.sea),s.window)try{var _={};_=s.window.sessionStorage,delete _.recall,delete _.pair}catch{}return h}})(t,"./create"),t(function(r){var i=t("./user"),s=i.SEA,a=i.GUN,u=function(){};i.prototype.auth=function(...l){var h=typeof l[0]=="object"&&(l[0].pub||l[0].epub)?l[0]:typeof l[1]=="object"&&(l[1].pub||l[1].epub)?l[1]:null,p=!h&&typeof l[0]=="string"?l[0]:null,_=(p||h&&!(h.priv&&h.epriv))&&typeof l[1]=="string"?l[1]:null,I=l.filter(C=>typeof C=="function")[0]||null,g=l&&l.length>1&&typeof l[l.length-1]=="object"?l[l.length-1]:{},S=this,b=S._,k=S.back(-1);if(b.ing)return(I||u)({err:a.log("User is already being created or authenticated!"),wait:!0}),S;b.ing=!0;var y={},m,R=9;return y.a=function(C){if(!C)return y.b();if(!C.pub){var x=[];return Object.keys(C).forEach(function(T){T!="_"&&x.push(C[T])}),y.b(x)}if(y.name)return y.f(C);y.c((y.data=C).auth)},y.b=function(C){var x=(y.list=(y.list||[]).concat(C||[])).shift();if(m===x){if(y.name)return y.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(p&&R--){k.get("~@"+p).once(y.a);return}return y.err("Wrong user or password.")}k.get(x).once(y.a)},y.c=function(C){if(m===C)return y.b();if(typeof C=="string")return y.c(c(C));s.work(_,(y.auth=C).s,y.d,y.enc)},y.d=function(C){s.decrypt(y.auth.ek,C,y.e,y.enc)},y.e=function(C){if(m===C)return y.enc?(y.enc=null,y.b()):(y.enc={encode:"utf8"},y.c(y.auth));y.half=C,y.f(y.data)},y.f=function(C){var x=y.half||{},T=y.data||{};y.g(y.lol={pub:C.pub||T.pub,epub:C.epub||T.epub,priv:C.priv||x.priv,epriv:C.epriv||x.epriv})},y.g=function(C){if(!C||!C.pub||!C.epub)return y.b();y.pair=C;var x=k._.user,T=x._;T.tag;var w=T.opt;T=x._=k.get("~"+C.pub)._,T.opt=w,x.is={pub:C.pub,epub:C.epub,alias:p||C.pub},T.sea=y.pair,b.ing=!1;try{_&&m==(c(b.root.graph["~"+C.pub].auth)||"")[":"]&&(g.shuffle=g.change=_)}catch{}if(g.change?y.z():(I||u)(T),s.window&&(S.back("user")._.opt||g).remember)try{var A={};A=s.window.sessionStorage,A.recall=!0,A.pair=JSON.stringify(C)}catch{}try{k._.tag.auth?k._.on("auth",T):setTimeout(function(){k._.on("auth",T)},1)}catch(V){a.log("Your 'auth' callback crashed with:",V)}},y.h=function(C){if(!C)return y.b();if(p=C.alias,p||(p=C.alias="~"+h.pub),!C.auth)return y.g(h);h=null,y.c((y.data=C).auth)},y.z=function(){y.salt=String.random(64),s.work(g.change,y.salt,y.y)},y.y=function(C){s.encrypt({priv:y.pair.priv,epriv:y.pair.epriv},C,y.x,{raw:1})},y.x=function(C){y.w(JSON.stringify({ek:C,s:y.salt}))},y.w=function(C){if(g.shuffle){console.log("migrate core account from UTF8 & shuffle");var x={};Object.keys(y.data).forEach(function(T){x[T]=y.data[T]}),delete x._,x.auth=C,k.get("~"+y.pair.pub).put(x)}k.get("~"+y.pair.pub).get("auth").put(C,I||u)},y.err=function(C){var x={err:a.log(C||"User cannot be found!")};b.ing=!1,(I||u)(x)},y.plugin=function(C){if(!(y.name=C))return y.err();var x=[C];C[0]!=="~"&&(x[1]="~"+C,x[2]="~@"+C),y.b(x)},h?h.priv&&h.epriv?y.g(h):k.get("~"+h.pub).once(y.h):p?k.get("~@"+p).once(y.a):!p&&!_&&s.name(y.plugin),S};function c(l){if(typeof l!="string")return l;try{l=JSON.parse(l)}catch{l={}}return l}})(t,"./auth"),t(function(r){var i=t("./user"),s=i.SEA;i.GUN,i.prototype.recall=function(a,u){var c=this,l=c.back(-1);if(a=a||{},a&&a.sessionStorage){if(s.window)try{var h={};h=s.window.sessionStorage,h&&(l._.opt.remember=!0,(c.back("user")._.opt||a).remember=!0,(h.recall||h.pair)&&l.user().auth(JSON.parse(h.pair),u))}catch{}return c}return c}})(t,"./recall"),t(function(r){var i=t("./user"),s=i.SEA,a=i.GUN,u=function(){};i.prototype.pair=function(){var c=this,l;try{l=new Proxy({DANGER:"☠"},{get:function(h,p,_){if(!(!c.is||!(c._||"").sea))return c._.sea[p]}})}catch{}return l},i.prototype.delete=async function(c,l,h){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var p=this;p.back(-1);var _=p.back("user");try{_.auth(c,l,function(I){var g=(_.is||{}).pub;_.map().once(function(){this.put(null)}),_.leave(),(h||u)({ok:0})})}catch(I){a.log("User.delete failed! Error:",I)}return p},i.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const c=this.back(-1);try{return await authRecall(c),c._.user._}catch{const h="No session!";throw a.log(h),{err:h}}},i.prototype.trust=async function(c){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),a.is(c)&&c.get("pub").get((l,h)=>{console.log(l,h)}),c.get("trust").get(path).put(theirPubkey)},i.prototype.grant=function(c,l){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var h=this,p=h.back(-1).user(),_=p._.sea,I="";return h.back(function(g){g.is||(I+=g.get||"")}),(async function(){var g,S=await p.get("grant").get(_.pub).get(I).then();S=await s.decrypt(S,_),S||(S=s.random(16).toString(),g=await s.encrypt(S,_),p.get("grant").get(_.pub).get(I).put(g));var b=c.get("pub").then(),k=c.get("epub").then();b=await b,k=await k;var y=await s.secret(k,_);g=await s.encrypt(S,y),p.get("grant").get(b).get(I).put(g,l)})(),h},i.prototype.secret=function(c,l){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var h=this,p=h.back(-1).user(),_=p.pair(),I="";return h.back(function(g){g.is||(I+=g.get||"")}),(async function(){var g,S=await p.get("trust").get(_.pub).get(I).then();S=await s.decrypt(S,_),S||(S=s.random(16).toString(),g=await s.encrypt(S,_),p.get("trust").get(_.pub).get(I).put(g)),g=await s.encrypt(c,S),h.put(g,l)})(),h},r.exports=i})(t,"./share"),t(function(r){var i=t("./sea"),s=t("./settings"),a,u=(i.window||"").GUN||t((""+a==typeof e?".":"")+"./gun",1);u.on("opt",function(g){g.sea||(g.sea={own:{}},g.on("put",c,g)),this.to.next(g)});function c(g){var S=this,b=S.as,k=g.put,y=k["#"],m=k["."],R=k[":"],C=k[">"],x=g["#"],T;if(!(!y||!m)){if((g._||"").faith&&(b.opt||"").faith&&typeof g._=="function"){i.opt.pack(k,function(A){i.verify(A,!1,function(V){k["="]=i.opt.unpack(V),S.to.next(g)})});return}var w=function(A){b.on("in",{"@":x,err:g.err=A})};if((g._||"").DBG&&((g._||"").DBG.c=+new Date),0<=y.indexOf("<?")&&(T=parseFloat(y.split("<?")[1]||""),T&&C<u.state()-T*1e3)){(T=g._)&&T.stun&&T.stun--;return}if(y==="~@"){c.alias(S,g,R,m,y,b,w);return}if(y.slice(0,2)==="~@"){c.pubs(S,g,R,m,y,b,w);return}if(T=i.opt.pub(y)){c.pub(S,g,R,m,y,b,w,b.user||"",T);return}if(0<=y.indexOf("#")){c.hash(S,g,R,m,y,b,w);return}c.any(S,g,R,m,y,b,w,b.user||"")}}c.hash=function(g,S,b,k,y,m,R){i.work(b,null,function(C){function x(T){let w="";for(let A=0;A<T.length;A++)w+=A-1&1?"":String.fromCharCode(parseInt(T.substring(A-1,A+1),16));return btoa(w)}if(C&&C===k.split("#").slice(-1)[0])return g.to.next(S);if(C&&C===x(k.split("#").slice(-1)[0]))return g.to.next(S);R("Data hash not same as hash!")},{name:"SHA-256"})},c.alias=function(g,S,b,k,y,m,R){if(!b)return R("Data must exist!");if("~@"+k===h(b))return g.to.next(S);R("Alias not same!")},c.pubs=function(g,S,b,k,y,m,R){if(!b)return R("Alias must exist!");if(k===h(b))return g.to.next(S);R("Alias not same!")},c.pub=async function(g,S,b,k,y,m,R,C,x){var T;const w=await s.parse(b)||{},A=(V,P,E)=>{if(V.m&&V.s&&P&&x)return i.verify(V,x,d=>{if(a!==d&&a!==d.e&&S.put[">"]&&S.put[">"]>parseFloat(d.e))return R("Certificate expired.");if(a!==d&&d.c&&d.w&&(d.c===P||d.c.indexOf("*")>-1)){let O=y.indexOf("/")>-1?y.replace(y.substring(0,y.indexOf("/")+1),""):"";String.match=String.match||u.text.match;const U=Array.isArray(d.w)?d.w:typeof d.w=="object"||typeof d.w=="string"?[d.w]:[];for(const F of U)if(String.match(O,F["#"])&&String.match(k,F["."])||!F["."]&&String.match(O,F["#"])||!F["#"]&&String.match(k,F["."])||String.match(O?O+"/"+k:k,F["#"]||F)){if(F["+"]&&F["+"].indexOf("*")>-1&&O&&O.indexOf(P)==-1&&k.indexOf(P)==-1)return R(`Path "${O}" or key "${k}" must contain string "${P}".`);if(d.wb&&(typeof d.wb=="string"||(d.wb||{})["#"])){var N=g.as.root.$.back(-1);return typeof d.wb=="string"&&d.wb.slice(0,1)!=="~"&&(N=N.get("~"+x)),N.get(d.wb).get(P).once(L=>L&&(L===1||L===!0)?R(`Certificant ${P} blocked.`):E(d))}return E(d)}return R("Certificate verification fail.")}})};if(k==="pub"&&"~"+x===y)return b===x?g.to.next(S):R("Account not same!");if((T=C.is)&&T.pub&&!w["*"]&&!w["+"]&&(x===T.pub||x!==T.pub&&((S._.msg||{}).opt||{}).cert)){i.opt.pack(S.put,V=>{i.sign(V,C._.sea,async function(P){if(a===P)return R(i.err||"Signature fail.");if(S.put[":"]={":":T=i.opt.unpack(P.m),"~":P.s},S.put["="]=T,x===C.is.pub){(T=h(b))&&((m.sea.own[T]=m.sea.own[T]||{})[x]=1),JSON.stringifyAsync(S.put[":"],function(E,d){return E?R(E||"Stringify error."):(S.put[":"]=d,g.to.next(S))});return}if(x!==C.is.pub&&((S._.msg||{}).opt||{}).cert){const E=await s.parse(S._.msg.opt.cert);E&&E.m&&E.s&&A(E,C.is.pub,d=>{S.put[":"]["+"]=E,S.put[":"]["*"]=C.is.pub,JSON.stringifyAsync(S.put[":"],function(N,O){return N?R(N||"Stringify error."):(S.put[":"]=O,g.to.next(S))})})}},{raw:1})});return}i.opt.pack(S.put,V=>{i.verify(V,w["*"]||x,function(P){var E;if(P=i.opt.unpack(P),a===P)return R("Unverified data.");if((E=h(P))&&x===i.opt.pub(E)&&((m.sea.own[E]=m.sea.own[E]||{})[x]=1),w["+"]&&w["+"].m&&w["+"].s&&w["*"])A(w["+"],w["*"],d=>(S.put["="]=P,g.to.next(S)));else return S.put["="]=P,g.to.next(S)})})},c.any=function(g,S,b,k,y,m,R,C){if(m.opt.secure)return R("Soul missing public key at '"+k+"'.");m.on("secure",function(x){if(this.off(),!m.opt.secure)return g.to.next(x);R("Data cannot be changed.")}).on.on("secure",S)};var l=u.valid,h=function(g,S){return typeof(S=l(g))=="string"&&S};(u.state||"").ify;var p=/[^\w_-]/;i.opt.pub=function(g){if(g&&(g=g.split("~"),!(!g||!(g=g[1]))&&(g=g.split(p).slice(0,2),!(!g||g.length!=2)&&(g[0]||"")[0]!=="@")))return g=g.slice(0,2).join("."),g},i.opt.stringy=function(g){},i.opt.pack=function(g,S,b,k,y){var m,R;if(i.opt.check(g))return S(g);g&&g["#"]&&g["."]&&g[">"]&&(m=g[":"],R=1),JSON.parseAsync(R?m:g,function(C,x){var T=a!==(x||"")[":"]&&(x||"")["~"];if(!T){S(g);return}S({m:{"#":y||g["#"],".":b||g["."],":":(x||"")[":"],">":g[">"]||u.state.is(k,b)},s:T})})};var _=i.opt;i.opt.unpack=function(g,S,b){var k;if(a!==g){if(g&&a!==(k=g[":"]))return k;if(S=S||_.fall_key,!b&&_.fall_val&&(b={},b[S]=_.fall_val),!(!S||!b)){if(g===b[S]||!i.opt.check(b[S]))return g;var y=b&&b._&&b._["#"]||_.fall_soul,m=u.state.is(b,S)||_.fall_state;if(g&&g.length===4&&y===g[0]&&S===g[1]&&I(m)===I(g[3]))return g[2];if(m<i.opt.shuffle_attack)return g}}},i.opt.shuffle_attack=15463296e5;var I=Math.floor})(t,"./index")})()})(Qi)),Qi.exports}var bg=Tg();const Rl=Ca(bg);var To={exports:{}},Cl={},kl;function Ag(){if(kl)return Cl;kl=1;var n={},t=typeof window<"u"?window.Gun:ka(),e;t.on("opt",function(i){r(i),this.to.next(i)});function r(i){if(i.axe)return;var s=i.opt;if(s.peers,s.axe===!1||typeof process<"u"&&""+(n||"").AXE=="false")return;t.log.once("AXE","AXE relay enabled!");var a=i.axe={},u=s.mesh=s.mesh||t.Mesh(i),c=i.dup;u.way=function(b){if(b){if(b.get)return l(b);b.put||h(b)}};function l(b){if(b){var k=(b._||"").via,y;if(!k||!k.id||!(y=p(b)._))return h(b);y.asked=+new Date,l.turn(b,y.route,0)}}l.turn=function(b,k,y){var m=b["#"],R=c.s[m],C;if(!(!m||!R)&&(clearTimeout(R.lack),!(R.ack&&(m=R["##"])&&b["##"]===m))){if(C=Object.maps(k||s.peers).slice(y=y||0),!C.length){if(!k)return;l.turn(b,e,0);return}setTimeout.each(C,function(x){var T=s.peers[x];if(y++,!T||!T.wire){k&&k.delete(x);return}if(u.say(b,T)!==!1&&y%3==0)return 1},function(){R["##"]=b["##"],R.lack=setTimeout(function(){l.turn(b,k,y)},25)},3)}};function h(b){u.say(b,s.peers)}function p(b){var k="",y,m,R;if(!b||!b.get)return k;typeof(y=b.get["#"])=="string"&&(k=i.$.get(y)),typeof(R=b.get["."])=="string"?m=R:m="";var C=(b._||"").via,x=C.sub||(C.sub=new Object.Map);return(x.get(y)||x.set(y,R=new Object.Map)&&R).set(m,1),C.id&&k._&&(k._.route||(k._.route=new Object.Map)).set(C.id,C),k}function _(b){return(b=b||"")["="]||b["*"]||b[">"]||b}i.on("in",function(b){var k=this.to,y;if((y=b["@"])&&(y=c.s[y])){if(y.ack=(y.ack||0)+1,y.it&&y.it.get&&b.put){var m=y.it.get||"",R=p(y.it)._,C=(y.it._||"").via||"",x;if(C&&R&&(C.id&&(R.route||(R.route=new Object.Map)).set(C.id,C),x=C.sub||(C.sub=new Object.Map),R&&(x.get(_(m["#"]))||x.set(_(m["#"]),x=new Object.Map)&&x).set(_(m["."]),1),C=(b._||"").via||"",C&&(C.id&&(R.route||(R.route=new Object.Map)).set(C.id,C),x=C.sub||(C.sub=new Object.Map),R))){var T=_(m["#"]),w=x.get(T),A=_(m["."]);A?(w||x.set(T,w=new Object.Map)&&w).set(A,1):w||(x.set(T,w=new Object.Map),w.set("",1))}}if(y=y.back){setTimeout.each(Object.keys(y),function(V){k.next({"#":b["#"],"@":V,ok:b.ok})});return}}k.next(b)}),i.on("create",function(b){this.to.next(b),b.on("put",function(k){var y=this;y.as;var m=k.put,R=m["#"],C=m["."],x=m[":"],T=m[">"];if(y.to.next(k),!k["@"]&&!(!R||!C)){var w=b.$.get(R)._,A=(w||"").route;if(A){if(w.skip&&w.skip.has==C){w.skip.now=k["#"];return}(w.skip={now:k["#"],has:C}).to=setTimeout(function(){setTimeout.each(Object.maps(A),function(V){var P,U,E=w.skip||"";if(w.skip=null,!!(P=A.get(V))){if(!P.wire){A.delete(V);return}var d=(P.sub||(P.sub=new Object.Map)).get(R);if(d&&!(!d.get(C)&&!d.get(""))){var N=P.put||(P.put={}),O=b.graph[R],U;O&&e!==(U=O[C])&&(T=S(O,C),x=U),N[R]=g(N[R],C,T,x,R),U=c.track(P.next=P.next||String.random(9)),(U.back||(U.back={}))[""+(E.now||k["#"])]=1,!P.to&&(P.to=setTimeout(function(){I(P)},s.gap))}}})},9)}}})});function I(b){var k={"#":b.next,put:b.put,ok:{"@":3,"/":u.near}};b.next=b.put=b.to=null,u.say(k,b)}var g=t.state.ify,S=t.state.is;(function(){a.up={};var b=u.hear["?"];u.hear["?"]=function(k,y){var m;if(b(k,y),!!y.pid){if(y.pid===s.pid){u.bye(y);return}if(m=a.up[y.pid]){if(m===y)return;s.pid>y.pid&&(m=y,y=a.up[m.pid]),m.url=m.url||y.url,u.bye(y),a.up[m.pid]=m;return}y.url&&(a.up[y.pid]=y,a.stay&&a.stay())}},u.hear.opt=function(k,y){if(!k.ok){var m=k.opt;m&&(m=m.peers,!(!m||typeof m!="string")&&(99<=Object.keys(a.up).length||(u.hi({id:m,url:m,retry:9}),y&&u.say({dam:"opt",ok:1,"@":k["#"]},y))))}},a.stay=function(){clearTimeout(a.stay.to),a.stay.to=setTimeout(function(k,y){(k=i.stats&&i.stats.stay)&&(y={},Object.keys(a.up||"").forEach(function(m){m=(a.up||"")[m],m.url&&(y[m.url]={})}),(k.axe=k.axe||{}).up=y)},1e3*9)},setTimeout(function(k){(k=i.stats&&i.stats.stay&&i.stats.stay.axe)&&(k=k.up)&&(k instanceof Array||(k=Object.keys(k)),setTimeout.each(k||[],function(y){u.hear.opt({opt:{peers:y}})}))},1e3)})(),(function(){s.mob=s.mob||9900,i.on("hi",function(b){if(this.to.next(b),!b.url){var k=u.near;if(!(s.mob>=k)){var y={};Object.keys(a.up).forEach(function(m){m=a.up[m],m.url&&(y[m.url]={})}),u.say({dam:"mob",mob:k,peers:y},b),setTimeout(function(){u.bye(b)},9)}}}),i.on("bye",function(b){this.to.next(b)})})()}return(function(){var i=Array.from;if(Object.maps=function(s){return i&&s instanceof Map?i(s.keys()):(s instanceof Object.Map&&(s=s.s),Object.keys(s))},i)return Object.Map=Map;(Object.Map=function(){this.s={}}).prototype={set:function(s,a){return this.s[s]=a,this},get:function(s){return this.s[s]},delete:function(s){delete this.s[s]}}})(),Cl}var Pl;function Ig(){return Pl||(Pl=1,(function(n){(function(){var t=setTimeout||{},e;typeof window!=""+e&&(t.window=window);var r=(t.window||"").AXE||function(){};(r.window=t.window)&&(r.window.AXE=r);var i=(r.window||"").GUN||ka();(i.AXE=r).GUN=r.Gun=i,i.window||Ag(),i.on("opt",function(a){s(a),this.to.next(a)});function s(a){if(a.axe)return;var u=a.opt,c=u.peers;if(u.axe===!1||!i.window)return;var l=i.window,h=l.localStorage||u.localStorage||{},p=l.location||u.location||{},_=l.navigator||u.navigator||{},I=a.axe={},g,S,b=u.mesh=u.mesh||i.Mesh(a);g=c[S=p.origin+"/gun"]=c[S]||{},g.id=g.url=S,g.retry=g.retry||0,g=c[S="http://localhost:8765/gun"]=c[S]||{},g.id=g.url=S,g.retry=g.retry||0,i.log.once("AXE","AXE enabled: Trying to find network via (1) local peer (2) last used peers (3) a URL parameter, and last (4) hard coded peers."),i.log.once("AXEWarn","Warning: AXE is in alpha, use only for testing!");var k=h.peers||"";k&&(k+=" "),k+=((p.search||"").split("peers=")[1]||"").split("&")[0],a.on("bye",function(m){this.to.next(m),m.url&&(_.onLine||(m.retry=1),!m.retry&&(I.fall&&delete I.fall[m.url||m.id],(function R(){if(!I.fall){setTimeout(R,9);return}var C=Object.keys(I.fall||""),x=C[Math.random()*C.length>>0];if(C.length||(h.peers="",x="https://gunjs.herokuapp.com/gun"),c[x]){R();return}b.hi(x)})()))}),a.on("hi",function(m){this.to.next(m),m.url});function y(m){I.fall={},((m||"").match(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/ig)||[]).forEach(function(R){I.fall[R]={url:R,id:R,retry:0}})}if(k){y(k);return}try{fetch(((p.search||"").split("axe=")[1]||"").split("&")[0]||p.axe||"https://raw.githubusercontent.com/wiki/amark/gun/volunteer.dht.md").then(function(m){return m.text()}).then(function(m){y(h.peers=m)}).catch(function(){y()})}catch{y()}}try{""+e!="object"&&(n.exports=r)}catch{}})()})(To)),To.exports}Ig();const Sg=$o(),ur=Sg.user().recall({sessionStorage:!0}),kn=Ra("");ur.get("alias").on(n=>kn.set(n));const Rg=Ra(null),Cg=Ra([]);function kg(n,t){return[n,t].sort().join("_")}async function Pg(n,t){const e=kg(n,t);return Rg.set({id:e,participants:[n,t],type:"private"}),e}var Dg=Ct('<div class="error-message svelte-nzf11y"> </div>'),Vg=Ct('<span class="loading-spinner svelte-nzf11y"></span> ',1),xg=Ct('<div class="forgot-password svelte-nzf11y"><button type="button" class="forgot-link svelte-nzf11y">Forgot your password?</button></div>'),Ng=Ct('<div class="auth-container svelte-nzf11y"><div class="bg-animation svelte-nzf11y"><div class="floating-shape shape-1 svelte-nzf11y"></div> <div class="floating-shape shape-2 svelte-nzf11y"></div> <div class="floating-shape shape-3 svelte-nzf11y"></div></div> <div class="auth-card svelte-nzf11y"><div class="auth-header svelte-nzf11y"><h1 class="auth-title svelte-nzf11y"> </h1> <p class="auth-subtitle svelte-nzf11y"> </p> <div class="login-refresh-note svelte-nzf11y" style="margin-top: 1em; color: #fbbf24; background: rgba(255,255,255,0.15); padding: 0.5em 1em; border-radius: 8px; font-size: 0.95em;"><strong class="svelte-nzf11y">Note:</strong> After logging in, please refresh the page.</div></div> <div class="mode-toggle svelte-nzf11y"><div></div> <button type="button">Sign In</button> <button type="button">Sign Up</button></div> <!> <form class="svelte-nzf11y"><div class="form-group svelte-nzf11y"><label for="username" class="form-label svelte-nzf11y">Username</label> <input type="text" id="username" name="username" minlength="3" maxlength="16" class="form-input svelte-nzf11y" placeholder="Enter your username" required/></div> <div class="form-group svelte-nzf11y"><label for="password" class="form-label svelte-nzf11y">Password</label> <div class="password-container svelte-nzf11y"><input id="password" name="password" class="form-input svelte-nzf11y" placeholder="Enter your password" required/> <button type="button" class="toggle-password svelte-nzf11y"> </button></div></div> <button type="submit" class="submit-btn svelte-nzf11y"><!></button></form> <!></div></div>');function Og(n,t){hn(t,!1);let e=yt(""),r=yt(""),i=yt(!1),s=yt(!1),a=yt(!1),u=yt("");function c(){Z(a,!0),Z(u,""),ur.auth(z(e),z(r),({err:nt})=>{Z(a,!1),nt?Z(u,nt):Z(u,"")})}function l(){Z(a,!0),Z(u,""),ur.create(z(e),z(r),({err:nt})=>{nt?(Z(a,!1),Z(u,nt)):c()})}function h(){z(i)?l():c()}function p(){Z(s,!z(s))}Mn();var _=Ng(),I=it(X(_),2),g=X(I),S=X(g),b=X(S),k=it(S,2),y=X(k),m=it(g,2),R=X(m);let C;var x=it(R,2);let T;var w=it(x,2);let A;var V=it(m,2);{var P=nt=>{var rt=Dg(),vt=X(rt);ve(()=>le(vt,z(u))),Et(nt,rt)};ie(V,nt=>{z(u)&&nt(P)})}var E=it(V,2),d=X(E),N=it(X(d),2),O=it(d,2),U=it(X(O),2),F=X(U),L=it(F,2),$=X(L),G=it(O,2),Y=X(G);{var Q=nt=>{var rt=Vg(),vt=it(Zr(rt));ve(()=>le(vt,` ${z(i)?"Creating account...":"Signing in..."}`)),Et(nt,rt)},J=nt=>{var rt=eg();ve(()=>le(rt,z(i)?"Sign Up":"Sign In")),Et(nt,rt)};ie(Y,nt=>{z(a)?nt(Q):nt(J,!1)})}var lt=it(E,2);{var _t=nt=>{var rt=xg();Et(nt,rt)};ie(lt,nt=>{z(i)||nt(_t)})}ve((nt,rt,vt)=>{le(b,z(i)?"Create Account":"Welcome Back"),le(y,z(i)?"Sign up to get started":"Sign in to your account"),C=Gr(R,1,"toggle-slider svelte-nzf11y",null,C,nt),T=Gr(x,1,"toggle-option svelte-nzf11y",null,T,rt),A=Gr(w,1,"toggle-option svelte-nzf11y",null,A,vt),N.disabled=z(a),ni(F,"type",z(s)?"text":"password"),F.disabled=z(a),L.disabled=z(a),le($,z(s)?"🙈":"👁️"),G.disabled=z(a)||!z(e)||!z(r)},[()=>({"signup-mode":z(i)}),()=>({active:!z(i)}),()=>({active:z(i)})]),Nt("click",x,()=>Z(i,!1)),Nt("click",w,()=>Z(i,!0)),ri(N,()=>z(e),nt=>Z(e,nt)),ri(F,()=>z(r),nt=>Z(r,nt)),Nt("click",L,p),Nt("submit",E,Ch(h)),Et(n,_),fn()}var Mg=Ct('<div><img alt="avatar" class="svelte-9h5n4q"/> <div class="message-text svelte-9h5n4q"><p class="svelte-9h5n4q"> </p> <time class="svelte-9h5n4q"> </time></div></div>');function Lg(n,t){hn(t,!1);let e=bl(t,"message",8),r=bl(t,"sender",8);const i=e().who===r()?"sent":"received",s=`https://api.dicebear.com/7.x/personas/svg?seed=${encodeURIComponent(e().who)}`,a=new Date(e().when);Mn();var u=Mg(),c=X(u),l=it(c,2),h=X(l),p=X(h),_=it(h,2),I=X(_);ve(g=>{Gr(u,1,`message ${i}`,"svelte-9h5n4q"),ni(c,"src",s),le(p,(bh(e()),oe(()=>e().what))),le(I,g)},[()=>oe(()=>a.toLocaleTimeString())]),Et(n,u),fn()}var bo,Dl;function jg(){if(Dl)return bo;Dl=1;var n="Expected a function",t=NaN,e="[object Symbol]",r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,u=parseInt,c=typeof En=="object"&&En&&En.Object===Object&&En,l=typeof self=="object"&&self&&self.Object===Object&&self,h=c||l||Function("return this")(),p=Object.prototype,_=p.toString,I=Math.max,g=Math.min,S=function(){return h.Date.now()};function b(C,x,T){var w,A,V,P,E,d,N=0,O=!1,U=!1,F=!0;if(typeof C!="function")throw new TypeError(n);x=R(x)||0,k(T)&&(O=!!T.leading,U="maxWait"in T,V=U?I(R(T.maxWait)||0,x):V,F="trailing"in T?!!T.trailing:F);function L(rt){var vt=w,ne=A;return w=A=void 0,N=rt,P=C.apply(ne,vt),P}function $(rt){return N=rt,E=setTimeout(Q,x),O?L(rt):P}function G(rt){var vt=rt-d,ne=rt-N,fe=x-vt;return U?g(fe,V-ne):fe}function Y(rt){var vt=rt-d,ne=rt-N;return d===void 0||vt>=x||vt<0||U&&ne>=V}function Q(){var rt=S();if(Y(rt))return J(rt);E=setTimeout(Q,G(rt))}function J(rt){return E=void 0,F&&w?L(rt):(w=A=void 0,P)}function lt(){E!==void 0&&clearTimeout(E),N=0,w=d=A=E=void 0}function _t(){return E===void 0?P:J(S())}function nt(){var rt=S(),vt=Y(rt);if(w=arguments,A=this,d=rt,vt){if(E===void 0)return $(d);if(U)return E=setTimeout(Q,x),L(d)}return E===void 0&&(E=setTimeout(Q,x)),P}return nt.cancel=lt,nt.flush=_t,nt}function k(C){var x=typeof C;return!!C&&(x=="object"||x=="function")}function y(C){return!!C&&typeof C=="object"}function m(C){return typeof C=="symbol"||y(C)&&_.call(C)==e}function R(C){if(typeof C=="number")return C;if(m(C))return t;if(k(C)){var x=typeof C.valueOf=="function"?C.valueOf():C;C=k(x)?x+"":x}if(typeof C!="string")return C===0?C:+C;C=C.replace(r,"");var T=s.test(C);return T||a.test(C)?u(C.slice(2),T?2:8):i.test(C)?t:+C}return bo=b,bo}var Fg=jg();const Vl=Ca(Fg);var Ug=Ct('<div class="empty-state svelte-1hc2hgz"><div class="empty-icon svelte-1hc2hgz">💬</div> <h3 class="svelte-1hc2hgz">No messages yet</h3> <p class="svelte-1hc2hgz">Be the first to start the conversation!</p></div>'),Bg=Ct('<div class="typing-indicator svelte-1hc2hgz"><div class="typing-bubble svelte-1hc2hgz"><div class="typing-dots svelte-1hc2hgz"><span class="svelte-1hc2hgz"></span> <span class="svelte-1hc2hgz"></span> <span class="svelte-1hc2hgz"></span></div></div></div>'),$g=Ct('<div class="scroll-button-container svelte-1hc2hgz"><button class="scroll-button new-messages svelte-1hc2hgz"><div class="scroll-content svelte-1hc2hgz"><span class="unread-count svelte-1hc2hgz">New</span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1hc2hgz"><polyline points="6,9 12,15 18,9" class="svelte-1hc2hgz"></polyline></svg></div></button></div>'),qg=Ct('<div class="scroll-button-container svelte-1hc2hgz"><button class="scroll-button svelte-1hc2hgz"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1hc2hgz"><polyline points="6,9 12,15 18,9" class="svelte-1hc2hgz"></polyline></svg></button></div>'),zg=Ct('<header class="chat-header svelte-1hc2hgz"><div class="header-content svelte-1hc2hgz"><div class="chat-info svelte-1hc2hgz"><div class="status-dot svelte-1hc2hgz"></div> <div class="svelte-1hc2hgz"><h2 class="chat-title svelte-1hc2hgz">General Chat</h2> <p class="chat-subtitle svelte-1hc2hgz"> </p></div></div> <div class="header-actions svelte-1hc2hgz"><button class="action-btn svelte-1hc2hgz" title="Search messages"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1hc2hgz"><circle cx="11" cy="11" r="8" class="svelte-1hc2hgz"></circle><path d="M21 21l-4.35-4.35" class="svelte-1hc2hgz"></path></svg></button></div></div></header> <main class="messages-container svelte-1hc2hgz"><div class="messages-list svelte-1hc2hgz"><!> <!> <!> <div class="scroll-anchor svelte-1hc2hgz"></div></div></main> <footer class="message-form-container svelte-1hc2hgz"><form class="message-form svelte-1hc2hgz"><div class="input-container svelte-1hc2hgz"><div class="input-wrapper svelte-1hc2hgz"><input type="text" placeholder="Type your message..." maxlength="500" class="message-input svelte-1hc2hgz" autocomplete="off"/> <div class="input-actions svelte-1hc2hgz"><button type="button" class="emoji-btn svelte-1hc2hgz" title="Add emoji">😊</button></div></div> <button type="submit" class="send-button svelte-1hc2hgz" title="Send message (Ctrl+Enter)"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1hc2hgz"><line x1="22" y1="2" x2="11" y2="13" class="svelte-1hc2hgz"></line><polygon points="22,2 15,22 11,13 2,9 22,2" class="svelte-1hc2hgz"></polygon></svg></button></div> <div class="input-footer svelte-1hc2hgz"><div> </div> <div class="shortcuts svelte-1hc2hgz"><span class="shortcut svelte-1hc2hgz">Ctrl+Enter to send</span></div></div></form></footer> <!>',1),Gg=Ct('<main class="login-container svelte-1hc2hgz"><!></main>'),Hg=Ct('<div class="chat-container svelte-1hc2hgz"><!></div>');function xl(n,t){hn(t,!1);const e=()=>ar(kn,"$username",r),[r,i]=mi(),s=yt(),a=$o();let u=yt(),c=yt([]),l=yt(),h,p=yt(!0),_=yt(!1),I=yt(),g=yt(!1);function S(){setTimeout(()=>z(l)?.scrollIntoView({behavior:"smooth"}),50),Z(_,!1)}function b(w){Z(p,(w.target.scrollTop||1/0)>h),h=w.target.scrollTop}function k(){z(u)&&!z(g)&&(Z(g,!0),setTimeout(()=>Z(g,!1),2e3))}gg(()=>{var w={".":{">":new Date(+new Date-108e5).toISOString()},"-":1};a.get("chat").map(w).once(async(A,V)=>{if(A){const E="#foo",d=await a.user(A).get("alias"),N=await Rl.decrypt(A.what,E);var P={who:d,what:N+"",when:$o.state.is(A,"what")};P.what&&P.what!=="null"&&P.what!=="undefined"&&(Z(c,[...z(c).slice(-100),P].sort((O,U)=>O.when-U.when)),z(p)?S():Z(_,!0))}})});async function y(){if(!z(u)?.trim())return;const w=await Rl.encrypt(z(u),"#foo"),A=ur.get("all").set({what:w}),V=new Date().toISOString();a.get("chat").get(V).put(A),Z(u,""),Z(p,!0),S()}function m(w){w.key==="Enter"&&(w.ctrlKey||w.metaKey)&&(w.preventDefault(),y()),k()}tr(()=>Vl,()=>{Z(s,Vl(b,1e3))}),ba(),Mn();var R=Hg(),C=X(R);{var x=w=>{var A=zg(),V=Zr(A),P=X(V),E=X(P),d=it(X(E),2),N=it(X(d),2),O=X(N),U=it(V,2),F=X(U),L=X(F);{var $=gt=>{var Xt=Ug();Et(gt,Xt)};ie(L,gt=>{z(c),oe(()=>z(c).length===0)&&gt($)})}var G=it(L,2);Ah(G,1,()=>z(c),gt=>gt.when,(gt,Xt)=>{Lg(gt,{get message(){return z(Xt)},get sender(){return e()}})});var Y=it(G,2);{var Q=gt=>{var Xt=Bg();Et(gt,Xt)};ie(Y,gt=>{z(g)&&z(u)&&gt(Q)})}var J=it(Y,2);hs(J,gt=>Z(l,gt),()=>z(l)),hs(U,gt=>Z(I,gt),()=>z(I));var lt=it(U,2),_t=X(lt),nt=X(_t),rt=X(nt),vt=X(rt),ne=it(rt,2),fe=it(nt,2),Jt=X(fe);let _e;var ze=X(Jt),Tr=it(lt,2);{var br=gt=>{var Xt=$g(),Fn=X(Xt);Nt("click",Fn,S),Et(gt,Xt)},Ti=gt=>{var Xt=Uo(),Fn=Zr(Xt);{var Ar=Un=>{var bi=qg(),Ir=X(bi);Nt("click",Ir,S),Et(Un,bi)};ie(Fn,Un=>{z(p)||Un(Ar)},!0)}Et(gt,Xt)};ie(Tr,gt=>{!z(p)&&z(_)?gt(br):gt(Ti,!1)})}ve((gt,Xt)=>{le(O,`${z(c),oe(()=>z(c).length)??""} messages • End-to-end encrypted`),ne.disabled=gt,_e=Gr(Jt,1,"char-count svelte-1hc2hgz",null,_e,Xt),le(ze,`${z(u),oe(()=>z(u)?.length||0)??""}/500`)},[()=>(z(u),oe(()=>!z(u)?.trim())),()=>({warning:z(u)?.length>400})]),Nt("scroll",U,function(...gt){z(s)?.apply(this,gt)}),ri(vt,()=>z(u),gt=>Z(u,gt)),Nt("keydown",vt,m),Nt("submit",_t,Ch(y)),Et(w,A)},T=w=>{var A=Gg(),V=X(A);Og(V,{}),Et(w,A)};ie(C,w=>{e()?w(x):w(T,!1)})}Et(n,R),fn(),i()}var Kg=Ct('<div class="user-section svelte-uu35bh"><div class="user-info svelte-uu35bh"><div class="user-avatar svelte-uu35bh"><img class="svelte-uu35bh"/> <div class="status-indicator svelte-uu35bh"></div></div> <div class="user-details svelte-uu35bh"><span class="greeting svelte-uu35bh">Welcome back</span> <span class="username svelte-uu35bh" style="cursor:pointer;"> </span></div></div> <button class="signout-button svelte-uu35bh" aria-label="Sign out"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-uu35bh"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" class="svelte-uu35bh"></path><polyline points="16,17 21,12 16,7" class="svelte-uu35bh"></polyline><line x1="21" y1="12" x2="9" y2="12" class="svelte-uu35bh"></line></svg></button></div>'),Wg=Ct('<header class="flopper-header svelte-uu35bh"><div class="header-content svelte-uu35bh"><div class="brand svelte-uu35bh"><div class="logo svelte-uu35bh"><svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-uu35bh"><circle cx="16" cy="16" r="14" fill="url(#gradient)" stroke="rgba(255,255,255,0.2)" stroke-width="2" class="svelte-uu35bh"></circle><path d="M12 10c0-2.2 1.8-4 4-4s4 1.8 4 4v6c0 2.2-1.8 4-4 4s-4-1.8-4-4v-6z" fill="white" fill-opacity="0.9" class="svelte-uu35bh"></path><circle cx="14" cy="14" r="1.5" fill="rgba(0,0,0,0.3)" class="svelte-uu35bh"></circle><circle cx="18" cy="14" r="1.5" fill="rgba(0,0,0,0.3)" class="svelte-uu35bh"></circle><path d="M14 18c0.5 0.5 1.2 1 2 1s1.5-0.5 2-1" stroke="rgba(0,0,0,0.3)" stroke-width="1.5" stroke-linecap="round" class="svelte-uu35bh"></path><defs class="svelte-uu35bh"><linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%" class="svelte-uu35bh"><stop offset="0%" style="stop-color:#667eea;stop-opacity:1" class="svelte-uu35bh"></stop><stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" class="svelte-uu35bh"></stop></linearGradient></defs></svg></div> <h1 class="app-name svelte-uu35bh">Flopper</h1></div> <!></div></header>');function Qg(n,t){hn(t,!1);const e=()=>ar(kn,"$username",r),[r,i]=mi(),s=_g();function a(){ur.leave(),kn.set("")}function u(){s("profile")}Mn();var c=Wg(),l=X(c),h=it(X(l),2);{var p=_=>{var I=Kg(),g=X(I),S=X(g),b=X(S),k=it(S,2),y=it(X(k),2),m=X(y),R=it(g,2);ve(()=>{ni(b,"src",`https://api.dicebear.com/7.x/adventurer/svg?seed=${e()}&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf`),ni(b,"alt",`${e()}'s avatar`),le(m,e())}),Nt("click",y,u),Nt("click",R,a),Et(_,I)};ie(h,_=>{e()&&_(p)})}Et(n,c),fn(),i()}var Jg=Ct('<p class="profile-message svelte-1n8hafb"> </p>'),Xg=Ct('<div class="profile-container svelte-1n8hafb"><button class="back-btn svelte-1n8hafb" title="Back to chat">← Back</button> <div class="avatar-section svelte-1n8hafb"><img class="avatar-img svelte-1n8hafb" alt="Avatar"/> <h2 class="profile-title svelte-1n8hafb">Profile</h2></div> <div class="profile-form svelte-1n8hafb"><label for="username" class="svelte-1n8hafb">Username:</label> <input id="username" maxlength="16" class="svelte-1n8hafb"/> <button class="update-btn svelte-1n8hafb">Update</button></div> <!></div>');function Yg(n,t){hn(t,!1);const e=()=>ar(kn,"$username",r),[r,i]=mi(),s=yt();let a=yt(e()),u=yt("");function c(){ur.get("alias").put(z(a),m=>{m.err?Z(u,"Error updating username."):Z(u,"Profile updated!")})}function l(){const m=new CustomEvent("back",{bubbles:!0});dispatchEvent(m)}tr(()=>z(a),()=>{Z(s,`https://api.dicebear.com/7.x/adventurer/svg?seed=${encodeURIComponent(z(a))}`)}),tr(()=>(e(),z(a)),()=>{e()&&z(a)!==e()&&Z(u,"")}),ba(),Mn();var h=Xg(),p=X(h),_=it(p,2),I=X(_),g=it(_,2),S=it(X(g),2),b=it(S,2),k=it(g,2);{var y=m=>{var R=Jg(),C=X(R);ve(()=>le(C,z(u))),Et(m,R)};ie(k,m=>{z(u)&&m(y)})}ve(()=>ni(I,"src",z(s))),Nt("click",p,l),ri(S,()=>z(a),m=>Z(a,m)),Nt("click",b,c),Et(n,h),fn(),i()}const Zg=()=>{};var Nl={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dh=function(n){const t=[];let e=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?t[e++]=i:i<2048?(t[e++]=i>>6|192,t[e++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=i>>18|240,t[e++]=i>>12&63|128,t[e++]=i>>6&63|128,t[e++]=i&63|128):(t[e++]=i>>12|224,t[e++]=i>>6&63|128,t[e++]=i&63|128)}return t},tm=function(n){const t=[];let e=0,r=0;for(;e<n.length;){const i=n[e++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[e++];t[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[e++],a=n[e++],u=n[e++],c=((i&7)<<18|(s&63)<<12|(a&63)<<6|u&63)-65536;t[r++]=String.fromCharCode(55296+(c>>10)),t[r++]=String.fromCharCode(56320+(c&1023))}else{const s=n[e++],a=n[e++];t[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return t.join("")},Vh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],a=i+1<n.length,u=a?n[i+1]:0,c=i+2<n.length,l=c?n[i+2]:0,h=s>>2,p=(s&3)<<4|u>>4;let _=(u&15)<<2|l>>6,I=l&63;c||(I=64,a||(_=64)),r.push(e[h],e[p],e[_],e[I])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Dh(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):tm(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=e[n.charAt(i++)],u=i<n.length?e[n.charAt(i)]:0;++i;const l=i<n.length?e[n.charAt(i)]:64;++i;const p=i<n.length?e[n.charAt(i)]:64;if(++i,s==null||u==null||l==null||p==null)throw new em;const _=s<<2|u>>4;if(r.push(_),l!==64){const I=u<<4&240|l>>2;if(r.push(I),p!==64){const g=l<<6&192|p;r.push(g)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class em extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const nm=function(n){const t=Dh(n);return Vh.encodeByteArray(t,!0)},fs=function(n){return nm(n).replace(/\./g,"")},rm=function(n){try{return Vh.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function im(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sm=()=>im().__FIREBASE_DEFAULTS__,om=()=>{if(typeof process>"u"||typeof Nl>"u")return;const n=Nl.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},am=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&rm(n[1]);return t&&JSON.parse(t)},Pa=()=>{try{return Zg()||sm()||om()||am()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},um=n=>Pa()?.emulatorHosts?.[n],lm=n=>{const t=um(n);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},xh=()=>Pa()?.config;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Da(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function hm(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fm(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},r=t||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...n};return[fs(JSON.stringify(e)),fs(JSON.stringify(a)),""].join(".")}const Hr={};function dm(){const n={prod:[],emulator:[]};for(const t of Object.keys(Hr))Hr[t]?n.emulator.push(t):n.prod.push(t);return n}function pm(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}let Ol=!1;function gm(n,t){if(typeof window>"u"||typeof document>"u"||!Da(window.location.host)||Hr[n]===t||Hr[n]||Ol)return;Hr[n]=t;function e(_){return`__firebase__banner__${_}`}const r="__firebase__banner",s=dm().prod.length>0;function a(){const _=document.getElementById(r);_&&_.remove()}function u(_){_.style.display="flex",_.style.background="#7faaf0",_.style.position="fixed",_.style.bottom="5px",_.style.left="5px",_.style.padding=".5em",_.style.borderRadius="5px",_.style.alignItems="center"}function c(_,I){_.setAttribute("width","24"),_.setAttribute("id",I),_.setAttribute("height","24"),_.setAttribute("viewBox","0 0 24 24"),_.setAttribute("fill","none"),_.style.marginLeft="-6px"}function l(){const _=document.createElement("span");return _.style.cursor="pointer",_.style.marginLeft="16px",_.style.fontSize="24px",_.innerHTML=" &times;",_.onclick=()=>{Ol=!0,a()},_}function h(_,I){_.setAttribute("id",I),_.innerText="Learn more",_.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",_.setAttribute("target","__blank"),_.style.paddingLeft="5px",_.style.textDecoration="underline"}function p(){const _=pm(r),I=e("text"),g=document.getElementById(I)||document.createElement("span"),S=e("learnmore"),b=document.getElementById(S)||document.createElement("a"),k=e("preprendIcon"),y=document.getElementById(k)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(_.created){const m=_.element;u(m),h(b,S);const R=l();c(y,k),m.append(y,g,b,R),document.body.appendChild(m)}s?(g.innerText="Preview backend disconnected.",y.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(y.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,g.innerText="Preview backend running in this workspace."),g.setAttribute("id",I)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mm(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function _m(){const n=Pa()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function ym(){return!_m()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function vm(){try{return typeof indexedDB=="object"}catch{return!1}}function wm(){return new Promise((n,t)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Em="FirebaseError";class _r extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=Em,Object.setPrototypeOf(this,_r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Nh.prototype.create)}}class Nh{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){const r=e[0]||{},i=`${this.service}/${t}`,s=this.errors[t],a=s?Tm(s,r):"Error",u=`${this.serviceName}: ${a} (${i}).`;return new _r(i,u,r)}}function Tm(n,t){return n.replace(bm,(e,r)=>{const i=t[r];return i!=null?String(i):`<${r}?>`})}const bm=/\{\$([^}]+)}/g;function ds(n,t){if(n===t)return!0;const e=Object.keys(n),r=Object.keys(t);for(const i of e){if(!r.includes(i))return!1;const s=n[i],a=t[i];if(Ml(s)&&Ml(a)){if(!ds(s,a))return!1}else if(s!==a)return!1}for(const i of r)if(!e.includes(i))return!1;return!0}function Ml(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(n){return n&&n._delegate?n._delegate:n}class ii{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vn="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Am{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const r=new cm;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:e});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),r=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Sm(t))try{this.getOrInitializeService({instanceIdentifier:vn})}catch{}for(const[e,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(t=vn){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=vn){return this.instances.has(t)}getOptions(t=vn){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:e});for(const[s,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(s);r===u&&a.resolve(i)}return i}onInit(t,e){const r=this.normalizeInstanceIdentifier(e),i=this.onInitCallbacks.get(r)??new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const r=this.onInitCallbacks.get(e);if(r)for(const i of r)try{i(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Im(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=vn){return this.component?this.component.multipleInstances?t:vn:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Im(n){return n===vn?void 0:n}function Sm(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Am(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ht;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ht||(ht={}));const Cm={debug:ht.DEBUG,verbose:ht.VERBOSE,info:ht.INFO,warn:ht.WARN,error:ht.ERROR,silent:ht.SILENT},km=ht.INFO,Pm={[ht.DEBUG]:"log",[ht.VERBOSE]:"log",[ht.INFO]:"info",[ht.WARN]:"warn",[ht.ERROR]:"error"},Dm=(n,t,...e)=>{if(t<n.logLevel)return;const r=new Date().toISOString(),i=Pm[t];if(i)console[i](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Oh{constructor(t){this.name=t,this._logLevel=km,this._logHandler=Dm,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in ht))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Cm[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,ht.DEBUG,...t),this._logHandler(this,ht.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,ht.VERBOSE,...t),this._logHandler(this,ht.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,ht.INFO,...t),this._logHandler(this,ht.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,ht.WARN,...t),this._logHandler(this,ht.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,ht.ERROR,...t),this._logHandler(this,ht.ERROR,...t)}}const Vm=(n,t)=>t.some(e=>n instanceof e);let Ll,jl;function xm(){return Ll||(Ll=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Nm(){return jl||(jl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Mh=new WeakMap,qo=new WeakMap,Lh=new WeakMap,Ao=new WeakMap,Va=new WeakMap;function Om(n){const t=new Promise((e,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{e(Ye(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&Mh.set(e,n)}).catch(()=>{}),Va.set(t,n),t}function Mm(n){if(qo.has(n))return;const t=new Promise((e,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{e(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});qo.set(n,t)}let zo={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return qo.get(n);if(t==="objectStoreNames")return n.objectStoreNames||Lh.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Ye(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function Lm(n){zo=n(zo)}function jm(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const r=n.call(Io(this),t,...e);return Lh.set(r,t.sort?t.sort():[t]),Ye(r)}:Nm().includes(n)?function(...t){return n.apply(Io(this),t),Ye(Mh.get(this))}:function(...t){return Ye(n.apply(Io(this),t))}}function Fm(n){return typeof n=="function"?jm(n):(n instanceof IDBTransaction&&Mm(n),Vm(n,xm())?new Proxy(n,zo):n)}function Ye(n){if(n instanceof IDBRequest)return Om(n);if(Ao.has(n))return Ao.get(n);const t=Fm(n);return t!==n&&(Ao.set(n,t),Va.set(t,n)),t}const Io=n=>Va.get(n);function Um(n,t,{blocked:e,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(n,t),u=Ye(a);return r&&a.addEventListener("upgradeneeded",c=>{r(Ye(a.result),c.oldVersion,c.newVersion,Ye(a.transaction),c)}),e&&a.addEventListener("blocked",c=>e(c.oldVersion,c.newVersion,c)),u.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),u}const Bm=["get","getKey","getAll","getAllKeys","count"],$m=["put","add","delete","clear"],So=new Map;function Fl(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(So.get(t))return So.get(t);const e=t.replace(/FromIndex$/,""),r=t!==e,i=$m.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Bm.includes(e)))return;const s=async function(a,...u){const c=this.transaction(a,i?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(u.shift())),(await Promise.all([l[e](...u),i&&c.done]))[0]};return So.set(t,s),s}Lm(n=>({...n,get:(t,e,r)=>Fl(t,e)||n.get(t,e,r),has:(t,e)=>!!Fl(t,e)||n.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(zm(e)){const r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}}function zm(n){return n.getComponent()?.type==="VERSION"}const Go="@firebase/app",Ul="0.14.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fe=new Oh("@firebase/app"),Gm="@firebase/app-compat",Hm="@firebase/analytics-compat",Km="@firebase/analytics",Wm="@firebase/app-check-compat",Qm="@firebase/app-check",Jm="@firebase/auth",Xm="@firebase/auth-compat",Ym="@firebase/database",Zm="@firebase/data-connect",t_="@firebase/database-compat",e_="@firebase/functions",n_="@firebase/functions-compat",r_="@firebase/installations",i_="@firebase/installations-compat",s_="@firebase/messaging",o_="@firebase/messaging-compat",a_="@firebase/performance",u_="@firebase/performance-compat",l_="@firebase/remote-config",c_="@firebase/remote-config-compat",h_="@firebase/storage",f_="@firebase/storage-compat",d_="@firebase/firestore",p_="@firebase/ai",g_="@firebase/firestore-compat",m_="firebase",__="12.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ho="[DEFAULT]",y_={[Go]:"fire-core",[Gm]:"fire-core-compat",[Km]:"fire-analytics",[Hm]:"fire-analytics-compat",[Qm]:"fire-app-check",[Wm]:"fire-app-check-compat",[Jm]:"fire-auth",[Xm]:"fire-auth-compat",[Ym]:"fire-rtdb",[Zm]:"fire-data-connect",[t_]:"fire-rtdb-compat",[e_]:"fire-fn",[n_]:"fire-fn-compat",[r_]:"fire-iid",[i_]:"fire-iid-compat",[s_]:"fire-fcm",[o_]:"fire-fcm-compat",[a_]:"fire-perf",[u_]:"fire-perf-compat",[l_]:"fire-rc",[c_]:"fire-rc-compat",[h_]:"fire-gcs",[f_]:"fire-gcs-compat",[d_]:"fire-fst",[g_]:"fire-fst-compat",[p_]:"fire-vertex","fire-js":"fire-js",[m_]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ps=new Map,v_=new Map,Ko=new Map;function Bl(n,t){try{n.container.addComponent(t)}catch(e){Fe.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function gs(n){const t=n.name;if(Ko.has(t))return Fe.debug(`There were multiple attempts to register component ${t}.`),!1;Ko.set(t,n);for(const e of ps.values())Bl(e,n);for(const e of v_.values())Bl(e,n);return!0}function w_(n,t){const e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function E_(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T_={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ze=new Nh("app","Firebase",T_);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b_{constructor(t,e,r){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ii("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ze.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A_=__;function jh(n,t={}){let e=n;typeof t!="object"&&(t={name:t});const r={name:Ho,automaticDataCollectionEnabled:!0,...t},i=r.name;if(typeof i!="string"||!i)throw Ze.create("bad-app-name",{appName:String(i)});if(e||(e=xh()),!e)throw Ze.create("no-options");const s=ps.get(i);if(s){if(ds(e,s.options)&&ds(r,s.config))return s;throw Ze.create("duplicate-app",{appName:i})}const a=new Rm(i);for(const c of Ko.values())a.addComponent(c);const u=new b_(e,r,a);return ps.set(i,u),u}function I_(n=Ho){const t=ps.get(n);if(!t&&n===Ho&&xh())return jh();if(!t)throw Ze.create("no-app",{appName:n});return t}function nr(n,t,e){let r=y_[n]??n;e&&(r+=`-${e}`);const i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){const a=[`Unable to register library "${r}" with version "${t}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&a.push("and"),s&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Fe.warn(a.join(" "));return}gs(new ii(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S_="firebase-heartbeat-database",R_=1,si="firebase-heartbeat-store";let Ro=null;function Fh(){return Ro||(Ro=Um(S_,R_,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(si)}catch(e){console.warn(e)}}}}).catch(n=>{throw Ze.create("idb-open",{originalErrorMessage:n.message})})),Ro}async function C_(n){try{const e=(await Fh()).transaction(si),r=await e.objectStore(si).get(Uh(n));return await e.done,r}catch(t){if(t instanceof _r)Fe.warn(t.message);else{const e=Ze.create("idb-get",{originalErrorMessage:t?.message});Fe.warn(e.message)}}}async function $l(n,t){try{const r=(await Fh()).transaction(si,"readwrite");await r.objectStore(si).put(t,Uh(n)),await r.done}catch(e){if(e instanceof _r)Fe.warn(e.message);else{const r=Ze.create("idb-set",{originalErrorMessage:e?.message});Fe.warn(r.message)}}}function Uh(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k_=1024,P_=30;class D_{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new x_(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ql();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:e}),this._heartbeatsCache.heartbeats.length>P_){const i=N_(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Fe.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=ql(),{heartbeatsToSend:e,unsentEntries:r}=V_(this._heartbeatsCache.heartbeats),i=fs(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Fe.warn(t),""}}}function ql(){return new Date().toISOString().substring(0,10)}function V_(n,t=k_){const e=[];let r=n.slice();for(const i of n){const s=e.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),zl(e)>t){s.dates.pop();break}}else if(e.push({agent:i.agent,dates:[i.date]}),zl(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}class x_{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return vm()?wm().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await C_(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return $l(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return $l(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return}}function zl(n){return fs(JSON.stringify({version:2,heartbeats:n})).length}function N_(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O_(n){gs(new ii("platform-logger",t=>new qm(t),"PRIVATE")),gs(new ii("heartbeat",t=>new D_(t),"PRIVATE")),nr(Go,Ul,n),nr(Go,Ul,"esm2020"),nr("fire-js","")}O_("");var M_="firebase",L_="12.2.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nr(M_,L_,"app");var Gl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var tn,Bh;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(T,w){function A(){}A.prototype=w.prototype,T.D=w.prototype,T.prototype=new A,T.prototype.constructor=T,T.C=function(V,P,E){for(var d=Array(arguments.length-2),N=2;N<arguments.length;N++)d[N-2]=arguments[N];return w.prototype[P].apply(V,d)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,e),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,w,A){A||(A=0);var V=Array(16);if(typeof w=="string")for(var P=0;16>P;++P)V[P]=w.charCodeAt(A++)|w.charCodeAt(A++)<<8|w.charCodeAt(A++)<<16|w.charCodeAt(A++)<<24;else for(P=0;16>P;++P)V[P]=w[A++]|w[A++]<<8|w[A++]<<16|w[A++]<<24;w=T.g[0],A=T.g[1],P=T.g[2];var E=T.g[3],d=w+(E^A&(P^E))+V[0]+3614090360&4294967295;w=A+(d<<7&4294967295|d>>>25),d=E+(P^w&(A^P))+V[1]+3905402710&4294967295,E=w+(d<<12&4294967295|d>>>20),d=P+(A^E&(w^A))+V[2]+606105819&4294967295,P=E+(d<<17&4294967295|d>>>15),d=A+(w^P&(E^w))+V[3]+3250441966&4294967295,A=P+(d<<22&4294967295|d>>>10),d=w+(E^A&(P^E))+V[4]+4118548399&4294967295,w=A+(d<<7&4294967295|d>>>25),d=E+(P^w&(A^P))+V[5]+1200080426&4294967295,E=w+(d<<12&4294967295|d>>>20),d=P+(A^E&(w^A))+V[6]+2821735955&4294967295,P=E+(d<<17&4294967295|d>>>15),d=A+(w^P&(E^w))+V[7]+4249261313&4294967295,A=P+(d<<22&4294967295|d>>>10),d=w+(E^A&(P^E))+V[8]+1770035416&4294967295,w=A+(d<<7&4294967295|d>>>25),d=E+(P^w&(A^P))+V[9]+2336552879&4294967295,E=w+(d<<12&4294967295|d>>>20),d=P+(A^E&(w^A))+V[10]+4294925233&4294967295,P=E+(d<<17&4294967295|d>>>15),d=A+(w^P&(E^w))+V[11]+2304563134&4294967295,A=P+(d<<22&4294967295|d>>>10),d=w+(E^A&(P^E))+V[12]+1804603682&4294967295,w=A+(d<<7&4294967295|d>>>25),d=E+(P^w&(A^P))+V[13]+4254626195&4294967295,E=w+(d<<12&4294967295|d>>>20),d=P+(A^E&(w^A))+V[14]+2792965006&4294967295,P=E+(d<<17&4294967295|d>>>15),d=A+(w^P&(E^w))+V[15]+1236535329&4294967295,A=P+(d<<22&4294967295|d>>>10),d=w+(P^E&(A^P))+V[1]+4129170786&4294967295,w=A+(d<<5&4294967295|d>>>27),d=E+(A^P&(w^A))+V[6]+3225465664&4294967295,E=w+(d<<9&4294967295|d>>>23),d=P+(w^A&(E^w))+V[11]+643717713&4294967295,P=E+(d<<14&4294967295|d>>>18),d=A+(E^w&(P^E))+V[0]+3921069994&4294967295,A=P+(d<<20&4294967295|d>>>12),d=w+(P^E&(A^P))+V[5]+3593408605&4294967295,w=A+(d<<5&4294967295|d>>>27),d=E+(A^P&(w^A))+V[10]+38016083&4294967295,E=w+(d<<9&4294967295|d>>>23),d=P+(w^A&(E^w))+V[15]+3634488961&4294967295,P=E+(d<<14&4294967295|d>>>18),d=A+(E^w&(P^E))+V[4]+3889429448&4294967295,A=P+(d<<20&4294967295|d>>>12),d=w+(P^E&(A^P))+V[9]+568446438&4294967295,w=A+(d<<5&4294967295|d>>>27),d=E+(A^P&(w^A))+V[14]+3275163606&4294967295,E=w+(d<<9&4294967295|d>>>23),d=P+(w^A&(E^w))+V[3]+4107603335&4294967295,P=E+(d<<14&4294967295|d>>>18),d=A+(E^w&(P^E))+V[8]+1163531501&4294967295,A=P+(d<<20&4294967295|d>>>12),d=w+(P^E&(A^P))+V[13]+2850285829&4294967295,w=A+(d<<5&4294967295|d>>>27),d=E+(A^P&(w^A))+V[2]+4243563512&4294967295,E=w+(d<<9&4294967295|d>>>23),d=P+(w^A&(E^w))+V[7]+1735328473&4294967295,P=E+(d<<14&4294967295|d>>>18),d=A+(E^w&(P^E))+V[12]+2368359562&4294967295,A=P+(d<<20&4294967295|d>>>12),d=w+(A^P^E)+V[5]+4294588738&4294967295,w=A+(d<<4&4294967295|d>>>28),d=E+(w^A^P)+V[8]+2272392833&4294967295,E=w+(d<<11&4294967295|d>>>21),d=P+(E^w^A)+V[11]+1839030562&4294967295,P=E+(d<<16&4294967295|d>>>16),d=A+(P^E^w)+V[14]+4259657740&4294967295,A=P+(d<<23&4294967295|d>>>9),d=w+(A^P^E)+V[1]+2763975236&4294967295,w=A+(d<<4&4294967295|d>>>28),d=E+(w^A^P)+V[4]+1272893353&4294967295,E=w+(d<<11&4294967295|d>>>21),d=P+(E^w^A)+V[7]+4139469664&4294967295,P=E+(d<<16&4294967295|d>>>16),d=A+(P^E^w)+V[10]+3200236656&4294967295,A=P+(d<<23&4294967295|d>>>9),d=w+(A^P^E)+V[13]+681279174&4294967295,w=A+(d<<4&4294967295|d>>>28),d=E+(w^A^P)+V[0]+3936430074&4294967295,E=w+(d<<11&4294967295|d>>>21),d=P+(E^w^A)+V[3]+3572445317&4294967295,P=E+(d<<16&4294967295|d>>>16),d=A+(P^E^w)+V[6]+76029189&4294967295,A=P+(d<<23&4294967295|d>>>9),d=w+(A^P^E)+V[9]+3654602809&4294967295,w=A+(d<<4&4294967295|d>>>28),d=E+(w^A^P)+V[12]+3873151461&4294967295,E=w+(d<<11&4294967295|d>>>21),d=P+(E^w^A)+V[15]+530742520&4294967295,P=E+(d<<16&4294967295|d>>>16),d=A+(P^E^w)+V[2]+3299628645&4294967295,A=P+(d<<23&4294967295|d>>>9),d=w+(P^(A|~E))+V[0]+4096336452&4294967295,w=A+(d<<6&4294967295|d>>>26),d=E+(A^(w|~P))+V[7]+1126891415&4294967295,E=w+(d<<10&4294967295|d>>>22),d=P+(w^(E|~A))+V[14]+2878612391&4294967295,P=E+(d<<15&4294967295|d>>>17),d=A+(E^(P|~w))+V[5]+4237533241&4294967295,A=P+(d<<21&4294967295|d>>>11),d=w+(P^(A|~E))+V[12]+1700485571&4294967295,w=A+(d<<6&4294967295|d>>>26),d=E+(A^(w|~P))+V[3]+2399980690&4294967295,E=w+(d<<10&4294967295|d>>>22),d=P+(w^(E|~A))+V[10]+4293915773&4294967295,P=E+(d<<15&4294967295|d>>>17),d=A+(E^(P|~w))+V[1]+2240044497&4294967295,A=P+(d<<21&4294967295|d>>>11),d=w+(P^(A|~E))+V[8]+1873313359&4294967295,w=A+(d<<6&4294967295|d>>>26),d=E+(A^(w|~P))+V[15]+4264355552&4294967295,E=w+(d<<10&4294967295|d>>>22),d=P+(w^(E|~A))+V[6]+2734768916&4294967295,P=E+(d<<15&4294967295|d>>>17),d=A+(E^(P|~w))+V[13]+1309151649&4294967295,A=P+(d<<21&4294967295|d>>>11),d=w+(P^(A|~E))+V[4]+4149444226&4294967295,w=A+(d<<6&4294967295|d>>>26),d=E+(A^(w|~P))+V[11]+3174756917&4294967295,E=w+(d<<10&4294967295|d>>>22),d=P+(w^(E|~A))+V[2]+718787259&4294967295,P=E+(d<<15&4294967295|d>>>17),d=A+(E^(P|~w))+V[9]+3951481745&4294967295,T.g[0]=T.g[0]+w&4294967295,T.g[1]=T.g[1]+(P+(d<<21&4294967295|d>>>11))&4294967295,T.g[2]=T.g[2]+P&4294967295,T.g[3]=T.g[3]+E&4294967295}r.prototype.u=function(T,w){w===void 0&&(w=T.length);for(var A=w-this.blockSize,V=this.B,P=this.h,E=0;E<w;){if(P==0)for(;E<=A;)i(this,T,E),E+=this.blockSize;if(typeof T=="string"){for(;E<w;)if(V[P++]=T.charCodeAt(E++),P==this.blockSize){i(this,V),P=0;break}}else for(;E<w;)if(V[P++]=T[E++],P==this.blockSize){i(this,V),P=0;break}}this.h=P,this.o+=w},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var w=1;w<T.length-8;++w)T[w]=0;var A=8*this.o;for(w=T.length-8;w<T.length;++w)T[w]=A&255,A/=256;for(this.u(T),T=Array(16),w=A=0;4>w;++w)for(var V=0;32>V;V+=8)T[A++]=this.g[w]>>>V&255;return T};function s(T,w){var A=u;return Object.prototype.hasOwnProperty.call(A,T)?A[T]:A[T]=w(T)}function a(T,w){this.h=w;for(var A=[],V=!0,P=T.length-1;0<=P;P--){var E=T[P]|0;V&&E==w||(A[P]=E,V=!1)}this.g=A}var u={};function c(T){return-128<=T&&128>T?s(T,function(w){return new a([w|0],0>w?-1:0)}):new a([T|0],0>T?-1:0)}function l(T){if(isNaN(T)||!isFinite(T))return p;if(0>T)return b(l(-T));for(var w=[],A=1,V=0;T>=A;V++)w[V]=T/A|0,A*=4294967296;return new a(w,0)}function h(T,w){if(T.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(T.charAt(0)=="-")return b(h(T.substring(1),w));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var A=l(Math.pow(w,8)),V=p,P=0;P<T.length;P+=8){var E=Math.min(8,T.length-P),d=parseInt(T.substring(P,P+E),w);8>E?(E=l(Math.pow(w,E)),V=V.j(E).add(l(d))):(V=V.j(A),V=V.add(l(d)))}return V}var p=c(0),_=c(1),I=c(16777216);n=a.prototype,n.m=function(){if(S(this))return-b(this).m();for(var T=0,w=1,A=0;A<this.g.length;A++){var V=this.i(A);T+=(0<=V?V:4294967296+V)*w,w*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(g(this))return"0";if(S(this))return"-"+b(this).toString(T);for(var w=l(Math.pow(T,6)),A=this,V="";;){var P=R(A,w).g;A=k(A,P.j(w));var E=((0<A.g.length?A.g[0]:A.h)>>>0).toString(T);if(A=P,g(A))return E+V;for(;6>E.length;)E="0"+E;V=E+V}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function g(T){if(T.h!=0)return!1;for(var w=0;w<T.g.length;w++)if(T.g[w]!=0)return!1;return!0}function S(T){return T.h==-1}n.l=function(T){return T=k(this,T),S(T)?-1:g(T)?0:1};function b(T){for(var w=T.g.length,A=[],V=0;V<w;V++)A[V]=~T.g[V];return new a(A,~T.h).add(_)}n.abs=function(){return S(this)?b(this):this},n.add=function(T){for(var w=Math.max(this.g.length,T.g.length),A=[],V=0,P=0;P<=w;P++){var E=V+(this.i(P)&65535)+(T.i(P)&65535),d=(E>>>16)+(this.i(P)>>>16)+(T.i(P)>>>16);V=d>>>16,E&=65535,d&=65535,A[P]=d<<16|E}return new a(A,A[A.length-1]&-2147483648?-1:0)};function k(T,w){return T.add(b(w))}n.j=function(T){if(g(this)||g(T))return p;if(S(this))return S(T)?b(this).j(b(T)):b(b(this).j(T));if(S(T))return b(this.j(b(T)));if(0>this.l(I)&&0>T.l(I))return l(this.m()*T.m());for(var w=this.g.length+T.g.length,A=[],V=0;V<2*w;V++)A[V]=0;for(V=0;V<this.g.length;V++)for(var P=0;P<T.g.length;P++){var E=this.i(V)>>>16,d=this.i(V)&65535,N=T.i(P)>>>16,O=T.i(P)&65535;A[2*V+2*P]+=d*O,y(A,2*V+2*P),A[2*V+2*P+1]+=E*O,y(A,2*V+2*P+1),A[2*V+2*P+1]+=d*N,y(A,2*V+2*P+1),A[2*V+2*P+2]+=E*N,y(A,2*V+2*P+2)}for(V=0;V<w;V++)A[V]=A[2*V+1]<<16|A[2*V];for(V=w;V<2*w;V++)A[V]=0;return new a(A,0)};function y(T,w){for(;(T[w]&65535)!=T[w];)T[w+1]+=T[w]>>>16,T[w]&=65535,w++}function m(T,w){this.g=T,this.h=w}function R(T,w){if(g(w))throw Error("division by zero");if(g(T))return new m(p,p);if(S(T))return w=R(b(T),w),new m(b(w.g),b(w.h));if(S(w))return w=R(T,b(w)),new m(b(w.g),w.h);if(30<T.g.length){if(S(T)||S(w))throw Error("slowDivide_ only works with positive integers.");for(var A=_,V=w;0>=V.l(T);)A=C(A),V=C(V);var P=x(A,1),E=x(V,1);for(V=x(V,2),A=x(A,2);!g(V);){var d=E.add(V);0>=d.l(T)&&(P=P.add(A),E=d),V=x(V,1),A=x(A,1)}return w=k(T,P.j(w)),new m(P,w)}for(P=p;0<=T.l(w);){for(A=Math.max(1,Math.floor(T.m()/w.m())),V=Math.ceil(Math.log(A)/Math.LN2),V=48>=V?1:Math.pow(2,V-48),E=l(A),d=E.j(w);S(d)||0<d.l(T);)A-=V,E=l(A),d=E.j(w);g(E)&&(E=_),P=P.add(E),T=k(T,d)}return new m(P,T)}n.A=function(T){return R(this,T).h},n.and=function(T){for(var w=Math.max(this.g.length,T.g.length),A=[],V=0;V<w;V++)A[V]=this.i(V)&T.i(V);return new a(A,this.h&T.h)},n.or=function(T){for(var w=Math.max(this.g.length,T.g.length),A=[],V=0;V<w;V++)A[V]=this.i(V)|T.i(V);return new a(A,this.h|T.h)},n.xor=function(T){for(var w=Math.max(this.g.length,T.g.length),A=[],V=0;V<w;V++)A[V]=this.i(V)^T.i(V);return new a(A,this.h^T.h)};function C(T){for(var w=T.g.length+1,A=[],V=0;V<w;V++)A[V]=T.i(V)<<1|T.i(V-1)>>>31;return new a(A,T.h)}function x(T,w){var A=w>>5;w%=32;for(var V=T.g.length-A,P=[],E=0;E<V;E++)P[E]=0<w?T.i(E+A)>>>w|T.i(E+A+1)<<32-w:T.i(E+A);return new a(P,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Bh=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=l,a.fromString=h,tn=a}).apply(typeof Gl<"u"?Gl:typeof self<"u"?self:typeof window<"u"?window:{});var Bi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var $h,Br,qh,Ji,Wo,zh,Gh,Hh;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,f,v){return o==Array.prototype||o==Object.prototype||(o[f]=v.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Bi=="object"&&Bi];for(var f=0;f<o.length;++f){var v=o[f];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var r=e(this);function i(o,f){if(f)t:{var v=r;o=o.split(".");for(var D=0;D<o.length-1;D++){var M=o[D];if(!(M in v))break t;v=v[M]}o=o[o.length-1],D=v[o],f=f(D),f!=D&&f!=null&&t(v,o,{configurable:!0,writable:!0,value:f})}}function s(o,f){o instanceof String&&(o+="");var v=0,D=!1,M={next:function(){if(!D&&v<o.length){var j=v++;return{value:f(j,o[j]),done:!1}}return D=!0,{done:!0,value:void 0}}};return M[Symbol.iterator]=function(){return M},M}i("Array.prototype.values",function(o){return o||function(){return s(this,function(f,v){return v})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},u=this||self;function c(o){var f=typeof o;return f=f!="object"?f:o?Array.isArray(o)?"array":f:"null",f=="array"||f=="object"&&typeof o.length=="number"}function l(o){var f=typeof o;return f=="object"&&o!=null||f=="function"}function h(o,f,v){return o.call.apply(o.bind,arguments)}function p(o,f,v){if(!o)throw Error();if(2<arguments.length){var D=Array.prototype.slice.call(arguments,2);return function(){var M=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(M,D),o.apply(f,M)}}return function(){return o.apply(f,arguments)}}function _(o,f,v){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:p,_.apply(null,arguments)}function I(o,f){var v=Array.prototype.slice.call(arguments,1);return function(){var D=v.slice();return D.push.apply(D,arguments),o.apply(this,D)}}function g(o,f){function v(){}v.prototype=f.prototype,o.aa=f.prototype,o.prototype=new v,o.prototype.constructor=o,o.Qb=function(D,M,j){for(var H=Array(arguments.length-2),wt=2;wt<arguments.length;wt++)H[wt-2]=arguments[wt];return f.prototype[M].apply(D,H)}}function S(o){const f=o.length;if(0<f){const v=Array(f);for(let D=0;D<f;D++)v[D]=o[D];return v}return[]}function b(o,f){for(let v=1;v<arguments.length;v++){const D=arguments[v];if(c(D)){const M=o.length||0,j=D.length||0;o.length=M+j;for(let H=0;H<j;H++)o[M+H]=D[H]}else o.push(D)}}class k{constructor(f,v){this.i=f,this.j=v,this.h=0,this.g=null}get(){let f;return 0<this.h?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function y(o){return/^[\s\xa0]*$/.test(o)}function m(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function R(o){return R[" "](o),o}R[" "]=function(){};var C=m().indexOf("Gecko")!=-1&&!(m().toLowerCase().indexOf("webkit")!=-1&&m().indexOf("Edge")==-1)&&!(m().indexOf("Trident")!=-1||m().indexOf("MSIE")!=-1)&&m().indexOf("Edge")==-1;function x(o,f,v){for(const D in o)f.call(v,o[D],D,o)}function T(o,f){for(const v in o)f.call(void 0,o[v],v,o)}function w(o){const f={};for(const v in o)f[v]=o[v];return f}const A="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function V(o,f){let v,D;for(let M=1;M<arguments.length;M++){D=arguments[M];for(v in D)o[v]=D[v];for(let j=0;j<A.length;j++)v=A[j],Object.prototype.hasOwnProperty.call(D,v)&&(o[v]=D[v])}}function P(o){var f=1;o=o.split(":");const v=[];for(;0<f&&o.length;)v.push(o.shift()),f--;return o.length&&v.push(o.join(":")),v}function E(o){u.setTimeout(()=>{throw o},0)}function d(){var o=$;let f=null;return o.g&&(f=o.g,o.g=o.g.next,o.g||(o.h=null),f.next=null),f}class N{constructor(){this.h=this.g=null}add(f,v){const D=O.get();D.set(f,v),this.h?this.h.next=D:this.g=D,this.h=D}}var O=new k(()=>new U,o=>o.reset());class U{constructor(){this.next=this.g=this.h=null}set(f,v){this.h=f,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let F,L=!1,$=new N,G=()=>{const o=u.Promise.resolve(void 0);F=()=>{o.then(Y)}};var Y=()=>{for(var o;o=d();){try{o.h.call(o.g)}catch(v){E(v)}var f=O;f.j(o),100>f.h&&(f.h++,o.next=f.g,f.g=o)}L=!1};function Q(){this.s=this.s,this.C=this.C}Q.prototype.s=!1,Q.prototype.ma=function(){this.s||(this.s=!0,this.N())},Q.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function J(o,f){this.type=o,this.g=this.target=f,this.defaultPrevented=!1}J.prototype.h=function(){this.defaultPrevented=!0};var lt=(function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,f=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const v=()=>{};u.addEventListener("test",v,f),u.removeEventListener("test",v,f)}catch{}return o})();function _t(o,f){if(J.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var v=this.type=o.type,D=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=f,f=o.relatedTarget){if(C){t:{try{R(f.nodeName);var M=!0;break t}catch{}M=!1}M||(f=null)}}else v=="mouseover"?f=o.fromElement:v=="mouseout"&&(f=o.toElement);this.relatedTarget=f,D?(this.clientX=D.clientX!==void 0?D.clientX:D.pageX,this.clientY=D.clientY!==void 0?D.clientY:D.pageY,this.screenX=D.screenX||0,this.screenY=D.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:nt[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&_t.aa.h.call(this)}}g(_t,J);var nt={2:"touch",3:"pen",4:"mouse"};_t.prototype.h=function(){_t.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var rt="closure_listenable_"+(1e6*Math.random()|0),vt=0;function ne(o,f,v,D,M){this.listener=o,this.proxy=null,this.src=f,this.type=v,this.capture=!!D,this.ha=M,this.key=++vt,this.da=this.fa=!1}function fe(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Jt(o){this.src=o,this.g={},this.h=0}Jt.prototype.add=function(o,f,v,D,M){var j=o.toString();o=this.g[j],o||(o=this.g[j]=[],this.h++);var H=ze(o,f,D,M);return-1<H?(f=o[H],v||(f.fa=!1)):(f=new ne(f,this.src,j,!!D,M),f.fa=v,o.push(f)),f};function _e(o,f){var v=f.type;if(v in o.g){var D=o.g[v],M=Array.prototype.indexOf.call(D,f,void 0),j;(j=0<=M)&&Array.prototype.splice.call(D,M,1),j&&(fe(f),o.g[v].length==0&&(delete o.g[v],o.h--))}}function ze(o,f,v,D){for(var M=0;M<o.length;++M){var j=o[M];if(!j.da&&j.listener==f&&j.capture==!!v&&j.ha==D)return M}return-1}var Tr="closure_lm_"+(1e6*Math.random()|0),br={};function Ti(o,f,v,D,M){if(Array.isArray(f)){for(var j=0;j<f.length;j++)Ti(o,f[j],v,D,M);return null}return v=hu(v),o&&o[rt]?o.K(f,v,l(D)?!!D.capture:!1,M):gt(o,f,v,!1,D,M)}function gt(o,f,v,D,M,j){if(!f)throw Error("Invalid event type");var H=l(M)?!!M.capture:!!M,wt=Ir(o);if(wt||(o[Tr]=wt=new Jt(o)),v=wt.add(f,v,D,H,j),v.proxy)return v;if(D=Xt(),v.proxy=D,D.src=o,D.listener=v,o.addEventListener)lt||(M=H),M===void 0&&(M=!1),o.addEventListener(f.toString(),D,M);else if(o.attachEvent)o.attachEvent(Un(f.toString()),D);else if(o.addListener&&o.removeListener)o.addListener(D);else throw Error("addEventListener and attachEvent are unavailable.");return v}function Xt(){function o(v){return f.call(o.src,o.listener,v)}const f=bi;return o}function Fn(o,f,v,D,M){if(Array.isArray(f))for(var j=0;j<f.length;j++)Fn(o,f[j],v,D,M);else D=l(D)?!!D.capture:!!D,v=hu(v),o&&o[rt]?(o=o.i,f=String(f).toString(),f in o.g&&(j=o.g[f],v=ze(j,v,D,M),-1<v&&(fe(j[v]),Array.prototype.splice.call(j,v,1),j.length==0&&(delete o.g[f],o.h--)))):o&&(o=Ir(o))&&(f=o.g[f.toString()],o=-1,f&&(o=ze(f,v,D,M)),(v=-1<o?f[o]:null)&&Ar(v))}function Ar(o){if(typeof o!="number"&&o&&!o.da){var f=o.src;if(f&&f[rt])_e(f.i,o);else{var v=o.type,D=o.proxy;f.removeEventListener?f.removeEventListener(v,D,o.capture):f.detachEvent?f.detachEvent(Un(v),D):f.addListener&&f.removeListener&&f.removeListener(D),(v=Ir(f))?(_e(v,o),v.h==0&&(v.src=null,f[Tr]=null)):fe(o)}}}function Un(o){return o in br?br[o]:br[o]="on"+o}function bi(o,f){if(o.da)o=!0;else{f=new _t(f,this);var v=o.listener,D=o.ha||o.src;o.fa&&Ar(o),o=v.call(D,f)}return o}function Ir(o){return o=o[Tr],o instanceof Jt?o:null}var Ys="__closure_events_fn_"+(1e9*Math.random()>>>0);function hu(o){return typeof o=="function"?o:(o[Ys]||(o[Ys]=function(f){return o.handleEvent(f)}),o[Ys])}function zt(){Q.call(this),this.i=new Jt(this),this.M=this,this.F=null}g(zt,Q),zt.prototype[rt]=!0,zt.prototype.removeEventListener=function(o,f,v,D){Fn(this,o,f,v,D)};function Yt(o,f){var v,D=o.F;if(D)for(v=[];D;D=D.F)v.push(D);if(o=o.M,D=f.type||f,typeof f=="string")f=new J(f,o);else if(f instanceof J)f.target=f.target||o;else{var M=f;f=new J(D,o),V(f,M)}if(M=!0,v)for(var j=v.length-1;0<=j;j--){var H=f.g=v[j];M=Ai(H,D,!0,f)&&M}if(H=f.g=o,M=Ai(H,D,!0,f)&&M,M=Ai(H,D,!1,f)&&M,v)for(j=0;j<v.length;j++)H=f.g=v[j],M=Ai(H,D,!1,f)&&M}zt.prototype.N=function(){if(zt.aa.N.call(this),this.i){var o=this.i,f;for(f in o.g){for(var v=o.g[f],D=0;D<v.length;D++)fe(v[D]);delete o.g[f],o.h--}}this.F=null},zt.prototype.K=function(o,f,v,D){return this.i.add(String(o),f,!1,v,D)},zt.prototype.L=function(o,f,v,D){return this.i.add(String(o),f,!0,v,D)};function Ai(o,f,v,D){if(f=o.i.g[String(f)],!f)return!0;f=f.concat();for(var M=!0,j=0;j<f.length;++j){var H=f[j];if(H&&!H.da&&H.capture==v){var wt=H.listener,jt=H.ha||H.src;H.fa&&_e(o.i,H),M=wt.call(jt,D)!==!1&&M}}return M&&!D.defaultPrevented}function fu(o,f,v){if(typeof o=="function")v&&(o=_(o,v));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(f)?-1:u.setTimeout(o,f||0)}function du(o){o.g=fu(()=>{o.g=null,o.i&&(o.i=!1,du(o))},o.l);const f=o.h;o.h=null,o.m.apply(null,f)}class Td extends Q{constructor(f,v){super(),this.m=f,this.l=v,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:du(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Sr(o){Q.call(this),this.h=o,this.g={}}g(Sr,Q);var pu=[];function gu(o){x(o.g,function(f,v){this.g.hasOwnProperty(v)&&Ar(f)},o),o.g={}}Sr.prototype.N=function(){Sr.aa.N.call(this),gu(this)},Sr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Zs=u.JSON.stringify,bd=u.JSON.parse,Ad=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function to(){}to.prototype.h=null;function mu(o){return o.h||(o.h=o.i())}function _u(){}var Rr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eo(){J.call(this,"d")}g(eo,J);function no(){J.call(this,"c")}g(no,J);var gn={},yu=null;function Ii(){return yu=yu||new zt}gn.La="serverreachability";function vu(o){J.call(this,gn.La,o)}g(vu,J);function Cr(o){const f=Ii();Yt(f,new vu(f))}gn.STAT_EVENT="statevent";function wu(o,f){J.call(this,gn.STAT_EVENT,o),this.stat=f}g(wu,J);function Zt(o){const f=Ii();Yt(f,new wu(f,o))}gn.Ma="timingevent";function Eu(o,f){J.call(this,gn.Ma,o),this.size=f}g(Eu,J);function kr(o,f){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},f)}function Pr(){this.g=!0}Pr.prototype.xa=function(){this.g=!1};function Id(o,f,v,D,M,j){o.info(function(){if(o.g)if(j)for(var H="",wt=j.split("&"),jt=0;jt<wt.length;jt++){var pt=wt[jt].split("=");if(1<pt.length){var Gt=pt[0];pt=pt[1];var Ht=Gt.split("_");H=2<=Ht.length&&Ht[1]=="type"?H+(Gt+"="+pt+"&"):H+(Gt+"=redacted&")}}else H=null;else H=j;return"XMLHTTP REQ ("+D+") [attempt "+M+"]: "+f+`
`+v+`
`+H})}function Sd(o,f,v,D,M,j,H){o.info(function(){return"XMLHTTP RESP ("+D+") [ attempt "+M+"]: "+f+`
`+v+`
`+j+" "+H})}function Bn(o,f,v,D){o.info(function(){return"XMLHTTP TEXT ("+f+"): "+Cd(o,v)+(D?" "+D:"")})}function Rd(o,f){o.info(function(){return"TIMEOUT: "+f})}Pr.prototype.info=function(){};function Cd(o,f){if(!o.g)return f;if(!f)return null;try{var v=JSON.parse(f);if(v){for(o=0;o<v.length;o++)if(Array.isArray(v[o])){var D=v[o];if(!(2>D.length)){var M=D[1];if(Array.isArray(M)&&!(1>M.length)){var j=M[0];if(j!="noop"&&j!="stop"&&j!="close")for(var H=1;H<M.length;H++)M[H]=""}}}}return Zs(v)}catch{return f}}var Si={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Tu={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ro;function Ri(){}g(Ri,to),Ri.prototype.g=function(){return new XMLHttpRequest},Ri.prototype.i=function(){return{}},ro=new Ri;function Ge(o,f,v,D){this.j=o,this.i=f,this.l=v,this.R=D||1,this.U=new Sr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new bu}function bu(){this.i=null,this.g="",this.h=!1}var Au={},io={};function so(o,f,v){o.L=1,o.v=Di(Ne(f)),o.m=v,o.P=!0,Iu(o,null)}function Iu(o,f){o.F=Date.now(),Ci(o),o.A=Ne(o.v);var v=o.A,D=o.R;Array.isArray(D)||(D=[String(D)]),Fu(v.i,"t",D),o.C=0,v=o.j.J,o.h=new bu,o.g=rl(o.j,v?f:null,!o.m),0<o.O&&(o.M=new Td(_(o.Y,o,o.g),o.O)),f=o.U,v=o.g,D=o.ca;var M="readystatechange";Array.isArray(M)||(M&&(pu[0]=M.toString()),M=pu);for(var j=0;j<M.length;j++){var H=Ti(v,M[j],D||f.handleEvent,!1,f.h||f);if(!H)break;f.g[H.key]=H}f=o.H?w(o.H):{},o.m?(o.u||(o.u="POST"),f["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,f)):(o.u="GET",o.g.ea(o.A,o.u,null,f)),Cr(),Id(o.i,o.u,o.A,o.l,o.R,o.m)}Ge.prototype.ca=function(o){o=o.target;const f=this.M;f&&Oe(o)==3?f.j():this.Y(o)},Ge.prototype.Y=function(o){try{if(o==this.g)t:{const Ht=Oe(this.g);var f=this.g.Ba();const zn=this.g.Z();if(!(3>Ht)&&(Ht!=3||this.g&&(this.h.h||this.g.oa()||Hu(this.g)))){this.J||Ht!=4||f==7||(f==8||0>=zn?Cr(3):Cr(2)),oo(this);var v=this.g.Z();this.X=v;e:if(Su(this)){var D=Hu(this.g);o="";var M=D.length,j=Oe(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){mn(this),Dr(this);var H="";break e}this.h.i=new u.TextDecoder}for(f=0;f<M;f++)this.h.h=!0,o+=this.h.i.decode(D[f],{stream:!(j&&f==M-1)});D.length=0,this.h.g+=o,this.C=0,H=this.h.g}else H=this.g.oa();if(this.o=v==200,Sd(this.i,this.u,this.A,this.l,this.R,Ht,v),this.o){if(this.T&&!this.K){e:{if(this.g){var wt,jt=this.g;if((wt=jt.g?jt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(wt)){var pt=wt;break e}}pt=null}if(v=pt)Bn(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ao(this,v);else{this.o=!1,this.s=3,Zt(12),mn(this),Dr(this);break t}}if(this.P){v=!0;let ye;for(;!this.J&&this.C<H.length;)if(ye=kd(this,H),ye==io){Ht==4&&(this.s=4,Zt(14),v=!1),Bn(this.i,this.l,null,"[Incomplete Response]");break}else if(ye==Au){this.s=4,Zt(15),Bn(this.i,this.l,H,"[Invalid Chunk]"),v=!1;break}else Bn(this.i,this.l,ye,null),ao(this,ye);if(Su(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ht!=4||H.length!=0||this.h.h||(this.s=1,Zt(16),v=!1),this.o=this.o&&v,!v)Bn(this.i,this.l,H,"[Invalid Chunked Response]"),mn(this),Dr(this);else if(0<H.length&&!this.W){this.W=!0;var Gt=this.j;Gt.g==this&&Gt.ba&&!Gt.M&&(Gt.j.info("Great, no buffering proxy detected. Bytes received: "+H.length),po(Gt),Gt.M=!0,Zt(11))}}else Bn(this.i,this.l,H,null),ao(this,H);Ht==4&&mn(this),this.o&&!this.J&&(Ht==4?Zu(this.j,this):(this.o=!1,Ci(this)))}else Hd(this.g),v==400&&0<H.indexOf("Unknown SID")?(this.s=3,Zt(12)):(this.s=0,Zt(13)),mn(this),Dr(this)}}}catch{}finally{}};function Su(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function kd(o,f){var v=o.C,D=f.indexOf(`
`,v);return D==-1?io:(v=Number(f.substring(v,D)),isNaN(v)?Au:(D+=1,D+v>f.length?io:(f=f.slice(D,D+v),o.C=D+v,f)))}Ge.prototype.cancel=function(){this.J=!0,mn(this)};function Ci(o){o.S=Date.now()+o.I,Ru(o,o.I)}function Ru(o,f){if(o.B!=null)throw Error("WatchDog timer not null");o.B=kr(_(o.ba,o),f)}function oo(o){o.B&&(u.clearTimeout(o.B),o.B=null)}Ge.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(Rd(this.i,this.A),this.L!=2&&(Cr(),Zt(17)),mn(this),this.s=2,Dr(this)):Ru(this,this.S-o)};function Dr(o){o.j.G==0||o.J||Zu(o.j,o)}function mn(o){oo(o);var f=o.M;f&&typeof f.ma=="function"&&f.ma(),o.M=null,gu(o.U),o.g&&(f=o.g,o.g=null,f.abort(),f.ma())}function ao(o,f){try{var v=o.j;if(v.G!=0&&(v.g==o||uo(v.h,o))){if(!o.K&&uo(v.h,o)&&v.G==3){try{var D=v.Da.g.parse(f)}catch{D=null}if(Array.isArray(D)&&D.length==3){var M=D;if(M[0]==0){t:if(!v.u){if(v.g)if(v.g.F+3e3<o.F)Li(v),Oi(v);else break t;fo(v),Zt(18)}}else v.za=M[1],0<v.za-v.T&&37500>M[2]&&v.F&&v.v==0&&!v.C&&(v.C=kr(_(v.Za,v),6e3));if(1>=Pu(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else yn(v,11)}else if((o.K||v.g==o)&&Li(v),!y(f))for(M=v.Da.g.parse(f),f=0;f<M.length;f++){let pt=M[f];if(v.T=pt[0],pt=pt[1],v.G==2)if(pt[0]=="c"){v.K=pt[1],v.ia=pt[2];const Gt=pt[3];Gt!=null&&(v.la=Gt,v.j.info("VER="+v.la));const Ht=pt[4];Ht!=null&&(v.Aa=Ht,v.j.info("SVER="+v.Aa));const zn=pt[5];zn!=null&&typeof zn=="number"&&0<zn&&(D=1.5*zn,v.L=D,v.j.info("backChannelRequestTimeoutMs_="+D)),D=v;const ye=o.g;if(ye){const Fi=ye.g?ye.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Fi){var j=D.h;j.g||Fi.indexOf("spdy")==-1&&Fi.indexOf("quic")==-1&&Fi.indexOf("h2")==-1||(j.j=j.l,j.g=new Set,j.h&&(lo(j,j.h),j.h=null))}if(D.D){const go=ye.g?ye.g.getResponseHeader("X-HTTP-Session-Id"):null;go&&(D.ya=go,Tt(D.I,D.D,go))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-o.F,v.j.info("Handshake RTT: "+v.R+"ms")),D=v;var H=o;if(D.qa=nl(D,D.J?D.ia:null,D.W),H.K){Du(D.h,H);var wt=H,jt=D.L;jt&&(wt.I=jt),wt.B&&(oo(wt),Ci(wt)),D.g=H}else Xu(D);0<v.i.length&&Mi(v)}else pt[0]!="stop"&&pt[0]!="close"||yn(v,7);else v.G==3&&(pt[0]=="stop"||pt[0]=="close"?pt[0]=="stop"?yn(v,7):ho(v):pt[0]!="noop"&&v.l&&v.l.ta(pt),v.v=0)}}Cr(4)}catch{}}var Pd=class{constructor(o,f){this.g=o,this.map=f}};function Cu(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ku(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Pu(o){return o.h?1:o.g?o.g.size:0}function uo(o,f){return o.h?o.h==f:o.g?o.g.has(f):!1}function lo(o,f){o.g?o.g.add(f):o.h=f}function Du(o,f){o.h&&o.h==f?o.h=null:o.g&&o.g.has(f)&&o.g.delete(f)}Cu.prototype.cancel=function(){if(this.i=Vu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Vu(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let f=o.i;for(const v of o.g.values())f=f.concat(v.D);return f}return S(o.i)}function Dd(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(c(o)){for(var f=[],v=o.length,D=0;D<v;D++)f.push(o[D]);return f}f=[],v=0;for(D in o)f[v++]=o[D];return f}function Vd(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||typeof o=="string"){var f=[];o=o.length;for(var v=0;v<o;v++)f.push(v);return f}f=[],v=0;for(const D in o)f[v++]=D;return f}}}function xu(o,f){if(o.forEach&&typeof o.forEach=="function")o.forEach(f,void 0);else if(c(o)||typeof o=="string")Array.prototype.forEach.call(o,f,void 0);else for(var v=Vd(o),D=Dd(o),M=D.length,j=0;j<M;j++)f.call(void 0,D[j],v&&v[j],o)}var Nu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xd(o,f){if(o){o=o.split("&");for(var v=0;v<o.length;v++){var D=o[v].indexOf("="),M=null;if(0<=D){var j=o[v].substring(0,D);M=o[v].substring(D+1)}else j=o[v];f(j,M?decodeURIComponent(M.replace(/\+/g," ")):"")}}}function _n(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof _n){this.h=o.h,ki(this,o.j),this.o=o.o,this.g=o.g,Pi(this,o.s),this.l=o.l;var f=o.i,v=new Nr;v.i=f.i,f.g&&(v.g=new Map(f.g),v.h=f.h),Ou(this,v),this.m=o.m}else o&&(f=String(o).match(Nu))?(this.h=!1,ki(this,f[1]||"",!0),this.o=Vr(f[2]||""),this.g=Vr(f[3]||"",!0),Pi(this,f[4]),this.l=Vr(f[5]||"",!0),Ou(this,f[6]||"",!0),this.m=Vr(f[7]||"")):(this.h=!1,this.i=new Nr(null,this.h))}_n.prototype.toString=function(){var o=[],f=this.j;f&&o.push(xr(f,Mu,!0),":");var v=this.g;return(v||f=="file")&&(o.push("//"),(f=this.o)&&o.push(xr(f,Mu,!0),"@"),o.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&o.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&o.push("/"),o.push(xr(v,v.charAt(0)=="/"?Md:Od,!0))),(v=this.i.toString())&&o.push("?",v),(v=this.m)&&o.push("#",xr(v,jd)),o.join("")};function Ne(o){return new _n(o)}function ki(o,f,v){o.j=v?Vr(f,!0):f,o.j&&(o.j=o.j.replace(/:$/,""))}function Pi(o,f){if(f){if(f=Number(f),isNaN(f)||0>f)throw Error("Bad port number "+f);o.s=f}else o.s=null}function Ou(o,f,v){f instanceof Nr?(o.i=f,Fd(o.i,o.h)):(v||(f=xr(f,Ld)),o.i=new Nr(f,o.h))}function Tt(o,f,v){o.i.set(f,v)}function Di(o){return Tt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Vr(o,f){return o?f?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function xr(o,f,v){return typeof o=="string"?(o=encodeURI(o).replace(f,Nd),v&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Nd(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Mu=/[#\/\?@]/g,Od=/[#\?:]/g,Md=/[#\?]/g,Ld=/[#\?@]/g,jd=/#/g;function Nr(o,f){this.h=this.g=null,this.i=o||null,this.j=!!f}function He(o){o.g||(o.g=new Map,o.h=0,o.i&&xd(o.i,function(f,v){o.add(decodeURIComponent(f.replace(/\+/g," ")),v)}))}n=Nr.prototype,n.add=function(o,f){He(this),this.i=null,o=$n(this,o);var v=this.g.get(o);return v||this.g.set(o,v=[]),v.push(f),this.h+=1,this};function Lu(o,f){He(o),f=$n(o,f),o.g.has(f)&&(o.i=null,o.h-=o.g.get(f).length,o.g.delete(f))}function ju(o,f){return He(o),f=$n(o,f),o.g.has(f)}n.forEach=function(o,f){He(this),this.g.forEach(function(v,D){v.forEach(function(M){o.call(f,M,D,this)},this)},this)},n.na=function(){He(this);const o=Array.from(this.g.values()),f=Array.from(this.g.keys()),v=[];for(let D=0;D<f.length;D++){const M=o[D];for(let j=0;j<M.length;j++)v.push(f[D])}return v},n.V=function(o){He(this);let f=[];if(typeof o=="string")ju(this,o)&&(f=f.concat(this.g.get($n(this,o))));else{o=Array.from(this.g.values());for(let v=0;v<o.length;v++)f=f.concat(o[v])}return f},n.set=function(o,f){return He(this),this.i=null,o=$n(this,o),ju(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[f]),this.h+=1,this},n.get=function(o,f){return o?(o=this.V(o),0<o.length?String(o[0]):f):f};function Fu(o,f,v){Lu(o,f),0<v.length&&(o.i=null,o.g.set($n(o,f),S(v)),o.h+=v.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],f=Array.from(this.g.keys());for(var v=0;v<f.length;v++){var D=f[v];const j=encodeURIComponent(String(D)),H=this.V(D);for(D=0;D<H.length;D++){var M=j;H[D]!==""&&(M+="="+encodeURIComponent(String(H[D]))),o.push(M)}}return this.i=o.join("&")};function $n(o,f){return f=String(f),o.j&&(f=f.toLowerCase()),f}function Fd(o,f){f&&!o.j&&(He(o),o.i=null,o.g.forEach(function(v,D){var M=D.toLowerCase();D!=M&&(Lu(this,D),Fu(this,M,v))},o)),o.j=f}function Ud(o,f){const v=new Pr;if(u.Image){const D=new Image;D.onload=I(Ke,v,"TestLoadImage: loaded",!0,f,D),D.onerror=I(Ke,v,"TestLoadImage: error",!1,f,D),D.onabort=I(Ke,v,"TestLoadImage: abort",!1,f,D),D.ontimeout=I(Ke,v,"TestLoadImage: timeout",!1,f,D),u.setTimeout(function(){D.ontimeout&&D.ontimeout()},1e4),D.src=o}else f(!1)}function Bd(o,f){const v=new Pr,D=new AbortController,M=setTimeout(()=>{D.abort(),Ke(v,"TestPingServer: timeout",!1,f)},1e4);fetch(o,{signal:D.signal}).then(j=>{clearTimeout(M),j.ok?Ke(v,"TestPingServer: ok",!0,f):Ke(v,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(M),Ke(v,"TestPingServer: error",!1,f)})}function Ke(o,f,v,D,M){try{M&&(M.onload=null,M.onerror=null,M.onabort=null,M.ontimeout=null),D(v)}catch{}}function $d(){this.g=new Ad}function qd(o,f,v){const D=v||"";try{xu(o,function(M,j){let H=M;l(M)&&(H=Zs(M)),f.push(D+j+"="+encodeURIComponent(H))})}catch(M){throw f.push(D+"type="+encodeURIComponent("_badmap")),M}}function Vi(o){this.l=o.Ub||null,this.j=o.eb||!1}g(Vi,to),Vi.prototype.g=function(){return new xi(this.l,this.j)},Vi.prototype.i=(function(o){return function(){return o}})({});function xi(o,f){zt.call(this),this.D=o,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}g(xi,zt),n=xi.prototype,n.open=function(o,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=f,this.readyState=1,Mr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const f={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(f.body=o),(this.D||u).fetch(new Request(this.A,f)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Or(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Mr(this)),this.g&&(this.readyState=3,Mr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Uu(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Uu(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var f=o.value?o.value:new Uint8Array(0);(f=this.v.decode(f,{stream:!o.done}))&&(this.response=this.responseText+=f)}o.done?Or(this):Mr(this),this.readyState==3&&Uu(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,Or(this))},n.Qa=function(o){this.g&&(this.response=o,Or(this))},n.ga=function(){this.g&&Or(this)};function Or(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Mr(o)}n.setRequestHeader=function(o,f){this.u.append(o,f)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],f=this.h.entries();for(var v=f.next();!v.done;)v=v.value,o.push(v[0]+": "+v[1]),v=f.next();return o.join(`\r
`)};function Mr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(xi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Bu(o){let f="";return x(o,function(v,D){f+=D,f+=":",f+=v,f+=`\r
`}),f}function co(o,f,v){t:{for(D in v){var D=!1;break t}D=!0}D||(v=Bu(v),typeof o=="string"?v!=null&&encodeURIComponent(String(v)):Tt(o,f,v))}function kt(o){zt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}g(kt,zt);var zd=/^https?$/i,Gd=["POST","PUT"];n=kt.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,f,v,D){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);f=f?f.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ro.g(),this.v=this.o?mu(this.o):mu(ro),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(f,String(o),!0),this.B=!1}catch(j){$u(this,j);return}if(o=v||"",v=new Map(this.headers),D)if(Object.getPrototypeOf(D)===Object.prototype)for(var M in D)v.set(M,D[M]);else if(typeof D.keys=="function"&&typeof D.get=="function")for(const j of D.keys())v.set(j,D.get(j));else throw Error("Unknown input type for opt_headers: "+String(D));D=Array.from(v.keys()).find(j=>j.toLowerCase()=="content-type"),M=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Gd,f,void 0))||D||M||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[j,H]of v)this.g.setRequestHeader(j,H);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gu(this),this.u=!0,this.g.send(o),this.u=!1}catch(j){$u(this,j)}};function $u(o,f){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=f,o.m=5,qu(o),Ni(o)}function qu(o){o.A||(o.A=!0,Yt(o,"complete"),Yt(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Yt(this,"complete"),Yt(this,"abort"),Ni(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ni(this,!0)),kt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?zu(this):this.bb())},n.bb=function(){zu(this)};function zu(o){if(o.h&&typeof a<"u"&&(!o.v[1]||Oe(o)!=4||o.Z()!=2)){if(o.u&&Oe(o)==4)fu(o.Ea,0,o);else if(Yt(o,"readystatechange"),Oe(o)==4){o.h=!1;try{const H=o.Z();t:switch(H){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break t;default:f=!1}var v;if(!(v=f)){var D;if(D=H===0){var M=String(o.D).match(Nu)[1]||null;!M&&u.self&&u.self.location&&(M=u.self.location.protocol.slice(0,-1)),D=!zd.test(M?M.toLowerCase():"")}v=D}if(v)Yt(o,"complete"),Yt(o,"success");else{o.m=6;try{var j=2<Oe(o)?o.g.statusText:""}catch{j=""}o.l=j+" ["+o.Z()+"]",qu(o)}}finally{Ni(o)}}}}function Ni(o,f){if(o.g){Gu(o);const v=o.g,D=o.v[0]?()=>{}:null;o.g=null,o.v=null,f||Yt(o,"ready");try{v.onreadystatechange=D}catch{}}}function Gu(o){o.I&&(u.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function Oe(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<Oe(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(o){if(this.g){var f=this.g.responseText;return o&&f.indexOf(o)==0&&(f=f.substring(o.length)),bd(f)}};function Hu(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Hd(o){const f={};o=(o.g&&2<=Oe(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let D=0;D<o.length;D++){if(y(o[D]))continue;var v=P(o[D]);const M=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();const j=f[M]||[];f[M]=j,j.push(v)}T(f,function(D){return D.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Lr(o,f,v){return v&&v.internalChannelParams&&v.internalChannelParams[o]||f}function Ku(o){this.Aa=0,this.i=[],this.j=new Pr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Lr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Lr("baseRetryDelayMs",5e3,o),this.cb=Lr("retryDelaySeedMs",1e4,o),this.Wa=Lr("forwardChannelMaxRetries",2,o),this.wa=Lr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Cu(o&&o.concurrentRequestLimit),this.Da=new $d,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Ku.prototype,n.la=8,n.G=1,n.connect=function(o,f,v,D){Zt(0),this.W=o,this.H=f||{},v&&D!==void 0&&(this.H.OSID=v,this.H.OAID=D),this.F=this.X,this.I=nl(this,null,this.W),Mi(this)};function ho(o){if(Wu(o),o.G==3){var f=o.U++,v=Ne(o.I);if(Tt(v,"SID",o.K),Tt(v,"RID",f),Tt(v,"TYPE","terminate"),jr(o,v),f=new Ge(o,o.j,f),f.L=2,f.v=Di(Ne(v)),v=!1,u.navigator&&u.navigator.sendBeacon)try{v=u.navigator.sendBeacon(f.v.toString(),"")}catch{}!v&&u.Image&&(new Image().src=f.v,v=!0),v||(f.g=rl(f.j,null),f.g.ea(f.v)),f.F=Date.now(),Ci(f)}el(o)}function Oi(o){o.g&&(po(o),o.g.cancel(),o.g=null)}function Wu(o){Oi(o),o.u&&(u.clearTimeout(o.u),o.u=null),Li(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function Mi(o){if(!ku(o.h)&&!o.s){o.s=!0;var f=o.Ga;F||G(),L||(F(),L=!0),$.add(f,o),o.B=0}}function Kd(o,f){return Pu(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=f.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=kr(_(o.Ga,o,f),tl(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const M=new Ge(this,this.j,o);let j=this.o;if(this.S&&(j?(j=w(j),V(j,this.S)):j=this.S),this.m!==null||this.O||(M.H=j,j=null),this.P)t:{for(var f=0,v=0;v<this.i.length;v++){e:{var D=this.i[v];if("__data__"in D.map&&(D=D.map.__data__,typeof D=="string")){D=D.length;break e}D=void 0}if(D===void 0)break;if(f+=D,4096<f){f=v;break t}if(f===4096||v===this.i.length-1){f=v+1;break t}}f=1e3}else f=1e3;f=Ju(this,M,f),v=Ne(this.I),Tt(v,"RID",o),Tt(v,"CVER",22),this.D&&Tt(v,"X-HTTP-Session-Id",this.D),jr(this,v),j&&(this.O?f="headers="+encodeURIComponent(String(Bu(j)))+"&"+f:this.m&&co(v,this.m,j)),lo(this.h,M),this.Ua&&Tt(v,"TYPE","init"),this.P?(Tt(v,"$req",f),Tt(v,"SID","null"),M.T=!0,so(M,v,null)):so(M,v,f),this.G=2}}else this.G==3&&(o?Qu(this,o):this.i.length==0||ku(this.h)||Qu(this))};function Qu(o,f){var v;f?v=f.l:v=o.U++;const D=Ne(o.I);Tt(D,"SID",o.K),Tt(D,"RID",v),Tt(D,"AID",o.T),jr(o,D),o.m&&o.o&&co(D,o.m,o.o),v=new Ge(o,o.j,v,o.B+1),o.m===null&&(v.H=o.o),f&&(o.i=f.D.concat(o.i)),f=Ju(o,v,1e3),v.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),lo(o.h,v),so(v,D,f)}function jr(o,f){o.H&&x(o.H,function(v,D){Tt(f,D,v)}),o.l&&xu({},function(v,D){Tt(f,D,v)})}function Ju(o,f,v){v=Math.min(o.i.length,v);var D=o.l?_(o.l.Na,o.l,o):null;t:{var M=o.i;let j=-1;for(;;){const H=["count="+v];j==-1?0<v?(j=M[0].g,H.push("ofs="+j)):j=0:H.push("ofs="+j);let wt=!0;for(let jt=0;jt<v;jt++){let pt=M[jt].g;const Gt=M[jt].map;if(pt-=j,0>pt)j=Math.max(0,M[jt].g-100),wt=!1;else try{qd(Gt,H,"req"+pt+"_")}catch{D&&D(Gt)}}if(wt){D=H.join("&");break t}}}return o=o.i.splice(0,v),f.D=o,D}function Xu(o){if(!o.g&&!o.u){o.Y=1;var f=o.Fa;F||G(),L||(F(),L=!0),$.add(f,o),o.v=0}}function fo(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=kr(_(o.Fa,o),tl(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,Yu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=kr(_(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Zt(10),Oi(this),Yu(this))};function po(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function Yu(o){o.g=new Ge(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var f=Ne(o.qa);Tt(f,"RID","rpc"),Tt(f,"SID",o.K),Tt(f,"AID",o.T),Tt(f,"CI",o.F?"0":"1"),!o.F&&o.ja&&Tt(f,"TO",o.ja),Tt(f,"TYPE","xmlhttp"),jr(o,f),o.m&&o.o&&co(f,o.m,o.o),o.L&&(o.g.I=o.L);var v=o.g;o=o.ia,v.L=1,v.v=Di(Ne(f)),v.m=null,v.P=!0,Iu(v,o)}n.Za=function(){this.C!=null&&(this.C=null,Oi(this),fo(this),Zt(19))};function Li(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function Zu(o,f){var v=null;if(o.g==f){Li(o),po(o),o.g=null;var D=2}else if(uo(o.h,f))v=f.D,Du(o.h,f),D=1;else return;if(o.G!=0){if(f.o)if(D==1){v=f.m?f.m.length:0,f=Date.now()-f.F;var M=o.B;D=Ii(),Yt(D,new Eu(D,v)),Mi(o)}else Xu(o);else if(M=f.s,M==3||M==0&&0<f.X||!(D==1&&Kd(o,f)||D==2&&fo(o)))switch(v&&0<v.length&&(f=o.h,f.i=f.i.concat(v)),M){case 1:yn(o,5);break;case 4:yn(o,10);break;case 3:yn(o,6);break;default:yn(o,2)}}}function tl(o,f){let v=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(v*=2),v*f}function yn(o,f){if(o.j.info("Error code "+f),f==2){var v=_(o.fb,o),D=o.Xa;const M=!D;D=new _n(D||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||ki(D,"https"),Di(D),M?Ud(D.toString(),v):Bd(D.toString(),v)}else Zt(2);o.G=0,o.l&&o.l.sa(f),el(o),Wu(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Zt(2)):(this.j.info("Failed to ping google.com"),Zt(1))};function el(o){if(o.G=0,o.ka=[],o.l){const f=Vu(o.h);(f.length!=0||o.i.length!=0)&&(b(o.ka,f),b(o.ka,o.i),o.h.i.length=0,S(o.i),o.i.length=0),o.l.ra()}}function nl(o,f,v){var D=v instanceof _n?Ne(v):new _n(v);if(D.g!="")f&&(D.g=f+"."+D.g),Pi(D,D.s);else{var M=u.location;D=M.protocol,f=f?f+"."+M.hostname:M.hostname,M=+M.port;var j=new _n(null);D&&ki(j,D),f&&(j.g=f),M&&Pi(j,M),v&&(j.l=v),D=j}return v=o.D,f=o.ya,v&&f&&Tt(D,v,f),Tt(D,"VER",o.la),jr(o,D),D}function rl(o,f,v){if(f&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return f=o.Ca&&!o.pa?new kt(new Vi({eb:v})):new kt(o.pa),f.Ha(o.J),f}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function il(){}n=il.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ji(){}ji.prototype.g=function(o,f){return new ae(o,f)};function ae(o,f){zt.call(this),this.g=new Ku(f),this.l=o,this.h=f&&f.messageUrlParams||null,o=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(o?o["X-WebChannel-Content-Type"]=f.messageContentType:o={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.va&&(o?o["X-WebChannel-Client-Profile"]=f.va:o={"X-WebChannel-Client-Profile":f.va}),this.g.S=o,(o=f&&f.Sb)&&!y(o)&&(this.g.m=o),this.v=f&&f.supportsCrossDomainXhr||!1,this.u=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!y(f)&&(this.g.D=f,o=this.h,o!==null&&f in o&&(o=this.h,f in o&&delete o[f])),this.j=new qn(this)}g(ae,zt),ae.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ae.prototype.close=function(){ho(this.g)},ae.prototype.o=function(o){var f=this.g;if(typeof o=="string"){var v={};v.__data__=o,o=v}else this.u&&(v={},v.__data__=Zs(o),o=v);f.i.push(new Pd(f.Ya++,o)),f.G==3&&Mi(f)},ae.prototype.N=function(){this.g.l=null,delete this.j,ho(this.g),delete this.g,ae.aa.N.call(this)};function sl(o){eo.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var f=o.__sm__;if(f){t:{for(const v in f){o=v;break t}o=void 0}(this.i=o)&&(o=this.i,f=f!==null&&o in f?f[o]:void 0),this.data=f}else this.data=o}g(sl,eo);function ol(){no.call(this),this.status=1}g(ol,no);function qn(o){this.g=o}g(qn,il),qn.prototype.ua=function(){Yt(this.g,"a")},qn.prototype.ta=function(o){Yt(this.g,new sl(o))},qn.prototype.sa=function(o){Yt(this.g,new ol)},qn.prototype.ra=function(){Yt(this.g,"b")},ji.prototype.createWebChannel=ji.prototype.g,ae.prototype.send=ae.prototype.o,ae.prototype.open=ae.prototype.m,ae.prototype.close=ae.prototype.close,Hh=function(){return new ji},Gh=function(){return Ii()},zh=gn,Wo={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Si.NO_ERROR=0,Si.TIMEOUT=8,Si.HTTP_ERROR=6,Ji=Si,Tu.COMPLETE="complete",qh=Tu,_u.EventType=Rr,Rr.OPEN="a",Rr.CLOSE="b",Rr.ERROR="c",Rr.MESSAGE="d",zt.prototype.listen=zt.prototype.K,Br=_u,kt.prototype.listenOnce=kt.prototype.L,kt.prototype.getLastError=kt.prototype.Ka,kt.prototype.getLastErrorCode=kt.prototype.Ba,kt.prototype.getStatus=kt.prototype.Z,kt.prototype.getResponseJson=kt.prototype.Oa,kt.prototype.getResponseText=kt.prototype.oa,kt.prototype.send=kt.prototype.ea,kt.prototype.setWithCredentials=kt.prototype.Ha,$h=kt}).apply(typeof Bi<"u"?Bi:typeof self<"u"?self:typeof window<"u"?window:{});const Hl="@firebase/firestore",Kl="4.9.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Wt.UNAUTHENTICATED=new Wt(null),Wt.GOOGLE_CREDENTIALS=new Wt("google-credentials-uid"),Wt.FIRST_PARTY=new Wt("first-party-uid"),Wt.MOCK_USER=new Wt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yr="12.2.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pn=new Oh("@firebase/firestore");function Kn(){return Pn.logLevel}function K(n,...t){if(Pn.logLevel<=ht.DEBUG){const e=t.map(xa);Pn.debug(`Firestore (${yr}): ${n}`,...e)}}function Ue(n,...t){if(Pn.logLevel<=ht.ERROR){const e=t.map(xa);Pn.error(`Firestore (${yr}): ${n}`,...e)}}function lr(n,...t){if(Pn.logLevel<=ht.WARN){const e=t.map(xa);Pn.warn(`Firestore (${yr}): ${n}`,...e)}}function xa(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(e){return JSON.stringify(e)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function et(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,Kh(n,r,e)}function Kh(n,t,e){let r=`FIRESTORE (${yr}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw Ue(r),new Error(r)}function mt(n,t,e,r){let i="Unexpected state";typeof e=="string"?i=e:r=e,n||Kh(t,i,r)}function ot(n,t){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class W extends _r{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wh{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class j_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Wt.UNAUTHENTICATED)))}shutdown(){}}class F_{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class U_{constructor(t){this.t=t,this.currentUser=Wt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){mt(this.o===void 0,42304);let r=this.i;const i=c=>this.i!==r?(r=this.i,e(c)):Promise.resolve();let s=new en;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new en,t.enqueueRetryable((()=>i(this.currentUser)))};const a=()=>{const c=s;t.enqueueRetryable((async()=>{await c.promise,await i(this.currentUser)}))},u=c=>{K("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((c=>u(c))),setTimeout((()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(K("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new en)}}),0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((r=>this.i!==t?(K("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(mt(typeof r.accessToken=="string",31837,{l:r}),new Wh(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return mt(t===null||typeof t=="string",2055,{h:t}),new Wt(t)}}class B_{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=Wt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class $_{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new B_(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(Wt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Wl{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class q_{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,E_(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){mt(this.o===void 0,3512);const r=s=>{s.error!=null&&K("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,K("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable((()=>r(s)))};const i=s=>{K("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((s=>i(s))),setTimeout((()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):K("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Wl(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(mt(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Wl(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z_(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=z_(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<e&&(r+=t.charAt(i[s]%62))}return r}}function at(n,t){return n<t?-1:n>t?1:0}function Qo(n,t){const e=Math.min(n.length,t.length);for(let r=0;r<e;r++){const i=n.charAt(r),s=t.charAt(r);if(i!==s)return Co(i)===Co(s)?at(i,s):Co(i)?1:-1}return at(n.length,t.length)}const G_=55296,H_=57343;function Co(n){const t=n.charCodeAt(0);return t>=G_&&t<=H_}function cr(n,t,e){return n.length===t.length&&n.every(((r,i)=>e(r,t[i])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ql="__name__";class Ae{constructor(t,e,r){e===void 0?e=0:e>t.length&&et(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&et(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return Ae.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Ae?t.forEach((r=>{e.push(r)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const r=Math.min(t.length,e.length);for(let i=0;i<r;i++){const s=Ae.compareSegments(t.get(i),e.get(i));if(s!==0)return s}return at(t.length,e.length)}static compareSegments(t,e){const r=Ae.isNumericId(t),i=Ae.isNumericId(e);return r&&!i?-1:!r&&i?1:r&&i?Ae.extractNumericId(t).compare(Ae.extractNumericId(e)):Qo(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return tn.fromString(t.substring(4,t.length-2))}}class bt extends Ae{construct(t,e,r){return new bt(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const r of t){if(r.indexOf("//")>=0)throw new W(q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter((i=>i.length>0)))}return new bt(e)}static emptyPath(){return new bt([])}}const K_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $t extends Ae{construct(t,e,r){return new $t(t,e,r)}static isValidIdentifier(t){return K_.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$t.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ql}static keyField(){return new $t([Ql])}static fromServerFormat(t){const e=[];let r="",i=0;const s=()=>{if(r.length===0)throw new W(q.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""};let a=!1;for(;i<t.length;){const u=t[i];if(u==="\\"){if(i+1===t.length)throw new W(q.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const c=t[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new W(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=c,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(r+=u,i++):(s(),i++)}if(s(),a)throw new W(q.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new $t(e)}static emptyPath(){return new $t([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(t){this.path=t}static fromPath(t){return new tt(bt.fromString(t))}static fromName(t){return new tt(bt.fromString(t).popFirst(5))}static empty(){return new tt(bt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&bt.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return bt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new tt(new bt(t.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qh(n,t,e){if(!e)throw new W(q.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function W_(n,t,e,r){if(t===!0&&r===!0)throw new W(q.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Jl(n){if(!tt.isDocumentKey(n))throw new W(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Xl(n){if(tt.isDocumentKey(n))throw new W(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Jh(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Oa(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=(function(r){return r.constructor?r.constructor.name:null})(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":et(12329,{type:typeof n})}function Ee(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new W(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Oa(n);throw new W(q.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xt(n,t){const e={typeString:n};return t&&(e.value=t),e}function _i(n,t){if(!Jh(n))throw new W(q.INVALID_ARGUMENT,"JSON must be an object");let e;for(const r in t)if(t[r]){const i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}const a=n[r];if(i&&typeof a!==i){e=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){e=`Expected '${r}' field to equal '${s.value}'`;break}}if(e)throw new W(q.INVALID_ARGUMENT,e);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yl=-62135596800,Zl=1e6;class At{static now(){return At.fromMillis(Date.now())}static fromDate(t){return At.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*Zl);return new At(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new W(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new W(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Yl)throw new W(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new W(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Zl}_compareTo(t){return this.seconds===t.seconds?at(this.nanoseconds,t.nanoseconds):at(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:At._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(_i(t,At._jsonSchema))return new At(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-Yl;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}At._jsonSchemaVersion="firestore/timestamp/1.0",At._jsonSchema={type:xt("string",At._jsonSchemaVersion),seconds:xt("number"),nanoseconds:xt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{static fromTimestamp(t){return new st(t)}static min(){return new st(new At(0,0))}static max(){return new st(new At(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oi=-1;function Q_(n,t){const e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=st.fromTimestamp(r===1e9?new At(e+1,0):new At(e,r));return new sn(i,tt.empty(),t)}function J_(n){return new sn(n.readTime,n.key,oi)}class sn{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new sn(st.min(),tt.empty(),oi)}static max(){return new sn(st.max(),tt.empty(),oi)}}function X_(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=tt.comparator(n.documentKey,t.documentKey),e!==0?e:at(n.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Z_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vr(n){if(n.code!==q.FAILED_PRECONDITION||n.message!==Y_)throw n;K("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&et(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new B(((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(r,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof B?e:B.resolve(e)}catch(e){return B.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):B.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):B.reject(e)}static resolve(t){return new B(((e,r)=>{e(t)}))}static reject(t){return new B(((e,r)=>{r(t)}))}static waitFor(t){return new B(((e,r)=>{let i=0,s=0,a=!1;t.forEach((u=>{++i,u.next((()=>{++s,a&&s===i&&e()}),(c=>r(c)))})),a=!0,s===i&&e()}))}static or(t){let e=B.resolve(!1);for(const r of t)e=e.next((i=>i?B.resolve(i):r()));return e}static forEach(t,e){const r=[];return t.forEach(((i,s)=>{r.push(e.call(this,i,s))})),this.waitFor(r)}static mapArray(t,e){return new B(((r,i)=>{const s=t.length,a=new Array(s);let u=0;for(let c=0;c<s;c++){const l=c;e(t[l]).next((h=>{a[l]=h,++u,u===s&&r(a)}),(h=>i(h)))}}))}static doWhile(t,e){return new B(((r,i)=>{const s=()=>{t()===!0?e().next((()=>{s()}),i):r()};s()}))}}function ty(n){const t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function wr(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>e.writeSequenceNumber(r))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Ns.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ma=-1;function Os(n){return n==null}function ms(n){return n===0&&1/n==-1/0}function ey(n){return typeof n=="number"&&Number.isInteger(n)&&!ms(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xh="";function ny(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=tc(t)),t=ry(n.get(e),t);return tc(t)}function ry(n,t){let e=t;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":e+="";break;case Xh:e+="";break;default:e+=s}}return e}function tc(n){return n+Xh+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ec(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function dn(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function Yh(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(t,e){this.comparator=t,this.root=e||Ut.EMPTY}insert(t,e){return new Rt(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ut.BLACK,null,null))}remove(t){return new Rt(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ut.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(t,r.key);if(i===0)return e+r.left.size;i<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,r)=>(t(e,r),!1)))}toString(){const t=[];return this.inorderTraversal(((e,r)=>(t.push(`${e}:${r}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new $i(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new $i(this.root,t,this.comparator,!1)}getReverseIterator(){return new $i(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new $i(this.root,t,this.comparator,!0)}}class $i{constructor(t,e,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?r(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Ut{constructor(t,e,r,i,s){this.key=t,this.value=e,this.color=r??Ut.RED,this.left=i??Ut.EMPTY,this.right=s??Ut.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,i,s){return new Ut(t??this.key,e??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let i=this;const s=r(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,r),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ut.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return Ut.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Ut.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Ut.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw et(43730,{key:this.key,value:this.value});if(this.right.isRed())throw et(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw et(27949);return t+(this.isRed()?0:1)}}Ut.EMPTY=null,Ut.RED=!0,Ut.BLACK=!1;Ut.EMPTY=new class{constructor(){this.size=0}get key(){throw et(57766)}get value(){throw et(16141)}get color(){throw et(16727)}get left(){throw et(29726)}get right(){throw et(36894)}copy(t,e,r,i,s){return this}insert(t,e,r){return new Ut(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(t){this.comparator=t,this.data=new Rt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,r)=>(t(e),!1)))}forEachInRange(t,e){const r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new nc(this.data.getIterator())}getIteratorFrom(t){return new nc(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((r=>{e=e.add(r)})),e}isEqual(t){if(!(t instanceof Mt)||this.size!==t.size)return!1;const e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){const i=e.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Mt(this.comparator);return e.data=t,e}}class nc{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ce{constructor(t){this.fields=t,t.sort($t.comparator)}static empty(){return new ce([])}unionWith(t){let e=new Mt($t.comparator);for(const r of this.fields)e=e.add(r);for(const r of t)e=e.add(r);return new ce(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return cr(this.fields,t.fields,((e,r)=>e.isEqual(r)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Zh("Invalid base64 string: "+s):s}})(t);return new qt(e)}static fromUint8Array(t){const e=(function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s})(t);return new qt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return at(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}qt.EMPTY_BYTE_STRING=new qt("");const iy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function on(n){if(mt(!!n,39018),typeof n=="string"){let t=0;const e=iy.exec(n);if(mt(!!e,46558,{timestamp:n}),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Pt(n.seconds),nanos:Pt(n.nanos)}}function Pt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function an(n){return typeof n=="string"?qt.fromBase64String(n):qt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tf="server_timestamp",ef="__type__",nf="__previous_value__",rf="__local_write_time__";function La(n){return(n?.mapValue?.fields||{})[ef]?.stringValue===tf}function Ms(n){const t=n.mapValue.fields[nf];return La(t)?Ms(t):t}function ai(n){const t=on(n.mapValue.fields[rf].timestampValue);return new At(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(t,e,r,i,s,a,u,c,l,h){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=l,this.isUsingEmulator=h}}const _s="(default)";class ui{constructor(t,e){this.projectId=t,this.database=e||_s}static empty(){return new ui("","")}get isDefaultDatabase(){return this.database===_s}isEqual(t){return t instanceof ui&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sf="__type__",oy="__max__",qi={mapValue:{}},of="__vector__",ys="value";function un(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?La(n)?4:uy(n)?9007199254740991:ay(n)?10:11:et(28295,{value:n})}function De(n,t){if(n===t)return!0;const e=un(n);if(e!==un(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return ai(n).isEqual(ai(t));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=on(i.timestampValue),u=on(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,t);case 5:return n.stringValue===t.stringValue;case 6:return(function(i,s){return an(i.bytesValue).isEqual(an(s.bytesValue))})(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return(function(i,s){return Pt(i.geoPointValue.latitude)===Pt(s.geoPointValue.latitude)&&Pt(i.geoPointValue.longitude)===Pt(s.geoPointValue.longitude)})(n,t);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return Pt(i.integerValue)===Pt(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=Pt(i.doubleValue),u=Pt(s.doubleValue);return a===u?ms(a)===ms(u):isNaN(a)&&isNaN(u)}return!1})(n,t);case 9:return cr(n.arrayValue.values||[],t.arrayValue.values||[],De);case 10:case 11:return(function(i,s){const a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(ec(a)!==ec(u))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(u[c]===void 0||!De(a[c],u[c])))return!1;return!0})(n,t);default:return et(52216,{left:n})}}function li(n,t){return(n.values||[]).find((e=>De(e,t)))!==void 0}function hr(n,t){if(n===t)return 0;const e=un(n),r=un(t);if(e!==r)return at(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return at(n.booleanValue,t.booleanValue);case 2:return(function(s,a){const u=Pt(s.integerValue||s.doubleValue),c=Pt(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1})(n,t);case 3:return rc(n.timestampValue,t.timestampValue);case 4:return rc(ai(n),ai(t));case 5:return Qo(n.stringValue,t.stringValue);case 6:return(function(s,a){const u=an(s),c=an(a);return u.compareTo(c)})(n.bytesValue,t.bytesValue);case 7:return(function(s,a){const u=s.split("/"),c=a.split("/");for(let l=0;l<u.length&&l<c.length;l++){const h=at(u[l],c[l]);if(h!==0)return h}return at(u.length,c.length)})(n.referenceValue,t.referenceValue);case 8:return(function(s,a){const u=at(Pt(s.latitude),Pt(a.latitude));return u!==0?u:at(Pt(s.longitude),Pt(a.longitude))})(n.geoPointValue,t.geoPointValue);case 9:return ic(n.arrayValue,t.arrayValue);case 10:return(function(s,a){const u=s.fields||{},c=a.fields||{},l=u[ys]?.arrayValue,h=c[ys]?.arrayValue,p=at(l?.values?.length||0,h?.values?.length||0);return p!==0?p:ic(l,h)})(n.mapValue,t.mapValue);case 11:return(function(s,a){if(s===qi.mapValue&&a===qi.mapValue)return 0;if(s===qi.mapValue)return 1;if(a===qi.mapValue)return-1;const u=s.fields||{},c=Object.keys(u),l=a.fields||{},h=Object.keys(l);c.sort(),h.sort();for(let p=0;p<c.length&&p<h.length;++p){const _=Qo(c[p],h[p]);if(_!==0)return _;const I=hr(u[c[p]],l[h[p]]);if(I!==0)return I}return at(c.length,h.length)})(n.mapValue,t.mapValue);default:throw et(23264,{he:e})}}function rc(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return at(n,t);const e=on(n),r=on(t),i=at(e.seconds,r.seconds);return i!==0?i:at(e.nanos,r.nanos)}function ic(n,t){const e=n.values||[],r=t.values||[];for(let i=0;i<e.length&&i<r.length;++i){const s=hr(e[i],r[i]);if(s)return s}return at(e.length,r.length)}function fr(n){return Jo(n)}function Jo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(e){const r=on(e);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(e){return an(e).toBase64()})(n.bytesValue):"referenceValue"in n?(function(e){return tt.fromName(e).toString()})(n.referenceValue):"geoPointValue"in n?(function(e){return`geo(${e.latitude},${e.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(e){let r="[",i=!0;for(const s of e.values||[])i?i=!1:r+=",",r+=Jo(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(e){const r=Object.keys(e.fields||{}).sort();let i="{",s=!0;for(const a of r)s?s=!1:i+=",",i+=`${a}:${Jo(e.fields[a])}`;return i+"}"})(n.mapValue):et(61005,{value:n})}function Xi(n){switch(un(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Ms(n);return t?16+Xi(t):16;case 5:return 2*n.stringValue.length;case 6:return an(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,s)=>i+Xi(s)),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return dn(r.fields,((s,a)=>{i+=s.length+Xi(a)})),i})(n.mapValue);default:throw et(13486,{value:n})}}function Xo(n){return!!n&&"integerValue"in n}function ja(n){return!!n&&"arrayValue"in n}function sc(n){return!!n&&"nullValue"in n}function oc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Yi(n){return!!n&&"mapValue"in n}function ay(n){return(n?.mapValue?.fields||{})[sf]?.stringValue===of}function Kr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const t={mapValue:{fields:{}}};return dn(n.mapValue.fields,((e,r)=>t.mapValue.fields[e]=Kr(r))),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Kr(n.arrayValue.values[e]);return t}return{...n}}function uy(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===oy}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class se{constructor(t){this.value=t}static empty(){return new se({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Yi(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Kr(e)}setAll(t){let e=$t.emptyPath(),r={},i=[];t.forEach(((a,u)=>{if(!e.isImmediateParentOf(u)){const c=this.getFieldsMap(e);this.applyChanges(c,r,i),r={},i=[],e=u.popLast()}a?r[u.lastSegment()]=Kr(a):i.push(u.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,r,i)}delete(t){const e=this.field(t.popLast());Yi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return De(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let i=e.mapValue.fields[t.get(r)];Yi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,r){dn(e,((i,s)=>t[i]=s));for(const i of r)delete t[i]}clone(){return new se(Kr(this.value))}}function af(n){const t=[];return dn(n.fields,((e,r)=>{const i=new $t([e]);if(Yi(r)){const s=af(r.mapValue).fields;if(s.length===0)t.push(i);else for(const a of s)t.push(i.child(a))}else t.push(i)})),new ce(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(t,e,r,i,s,a,u){this.key=t,this.documentType=e,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(t){return new Qt(t,0,st.min(),st.min(),st.min(),se.empty(),0)}static newFoundDocument(t,e,r,i){return new Qt(t,1,e,st.min(),r,i,0)}static newNoDocument(t,e){return new Qt(t,2,e,st.min(),st.min(),se.empty(),0)}static newUnknownDocument(t,e){return new Qt(t,3,e,st.min(),st.min(),se.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(st.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=se.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=se.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=st.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Qt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Qt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs{constructor(t,e){this.position=t,this.inclusive=e}}function ac(n,t,e){let r=0;for(let i=0;i<n.position.length;i++){const s=t[i],a=n.position[i];if(s.field.isKeyField()?r=tt.comparator(tt.fromName(a.referenceValue),e.key):r=hr(a,e.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function uc(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!De(n.position[e],t.position[e]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(t,e="asc"){this.field=t,this.dir=e}}function ly(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{}class Ot extends uf{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new hy(t,e,r):e==="array-contains"?new py(t,r):e==="in"?new gy(t,r):e==="not-in"?new my(t,r):e==="array-contains-any"?new _y(t,r):new Ot(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new fy(t,r):new dy(t,r)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(hr(e,this.value)):e!==null&&un(this.value)===un(e)&&this.matchesComparison(hr(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return et(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ve extends uf{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new Ve(t,e)}matches(t){return lf(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function lf(n){return n.op==="and"}function cf(n){return cy(n)&&lf(n)}function cy(n){for(const t of n.filters)if(t instanceof Ve)return!1;return!0}function Yo(n){if(n instanceof Ot)return n.field.canonicalString()+n.op.toString()+fr(n.value);if(cf(n))return n.filters.map((t=>Yo(t))).join(",");{const t=n.filters.map((e=>Yo(e))).join(",");return`${n.op}(${t})`}}function hf(n,t){return n instanceof Ot?(function(r,i){return i instanceof Ot&&r.op===i.op&&r.field.isEqual(i.field)&&De(r.value,i.value)})(n,t):n instanceof Ve?(function(r,i){return i instanceof Ve&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((s,a,u)=>s&&hf(a,i.filters[u])),!0):!1})(n,t):void et(19439)}function ff(n){return n instanceof Ot?(function(e){return`${e.field.canonicalString()} ${e.op} ${fr(e.value)}`})(n):n instanceof Ve?(function(e){return e.op.toString()+" {"+e.getFilters().map(ff).join(" ,")+"}"})(n):"Filter"}class hy extends Ot{constructor(t,e,r){super(t,e,r),this.key=tt.fromName(r.referenceValue)}matches(t){const e=tt.comparator(t.key,this.key);return this.matchesComparison(e)}}class fy extends Ot{constructor(t,e){super(t,"in",e),this.keys=df("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class dy extends Ot{constructor(t,e){super(t,"not-in",e),this.keys=df("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function df(n,t){return(t.arrayValue?.values||[]).map((e=>tt.fromName(e.referenceValue)))}class py extends Ot{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ja(e)&&li(e.arrayValue,this.value)}}class gy extends Ot{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&li(this.value.arrayValue,e)}}class my extends Ot{constructor(t,e){super(t,"not-in",e)}matches(t){if(li(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!li(this.value.arrayValue,e)}}class _y extends Ot{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ja(e)||!e.arrayValue.values)&&e.arrayValue.values.some((r=>li(this.value.arrayValue,r)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yy{constructor(t,e=null,r=[],i=[],s=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.Te=null}}function lc(n,t=null,e=[],r=[],i=null,s=null,a=null){return new yy(n,t,e,r,i,s,a)}function Fa(n){const t=ot(n);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((r=>Yo(r))).join(","),e+="|ob:",e+=t.orderBy.map((r=>(function(s){return s.field.canonicalString()+s.dir})(r))).join(","),Os(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((r=>fr(r))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((r=>fr(r))).join(",")),t.Te=e}return t.Te}function Ua(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!ly(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!hf(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!uc(n.startAt,t.startAt)&&uc(n.endAt,t.endAt)}function Zo(n){return tt.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls{constructor(t,e=null,r=[],i=[],s=null,a="F",u=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function vy(n,t,e,r,i,s,a,u){return new Ls(n,t,e,r,i,s,a,u)}function js(n){return new Ls(n)}function cc(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function wy(n){return n.collectionGroup!==null}function Wr(n){const t=ot(n);if(t.Ie===null){t.Ie=[];const e=new Set;for(const s of t.explicitOrderBy)t.Ie.push(s),e.add(s.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new Mt($t.comparator);return a.filters.forEach((c=>{c.getFlattenedFilters().forEach((l=>{l.isInequality()&&(u=u.add(l.field))}))})),u})(t).forEach((s=>{e.has(s.canonicalString())||s.isKeyField()||t.Ie.push(new ws(s,r))})),e.has($t.keyField().canonicalString())||t.Ie.push(new ws($t.keyField(),r))}return t.Ie}function Se(n){const t=ot(n);return t.Ee||(t.Ee=Ey(t,Wr(n))),t.Ee}function Ey(n,t){if(n.limitType==="F")return lc(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map((i=>{const s=i.dir==="desc"?"asc":"desc";return new ws(i.field,s)}));const e=n.endAt?new vs(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new vs(n.startAt.position,n.startAt.inclusive):null;return lc(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function ta(n,t,e){return new Ls(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Fs(n,t){return Ua(Se(n),Se(t))&&n.limitType===t.limitType}function pf(n){return`${Fa(Se(n))}|lt:${n.limitType}`}function Wn(n){return`Query(target=${(function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map((i=>ff(i))).join(", ")}]`),Os(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map((i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i))).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map((i=>fr(i))).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map((i=>fr(i))).join(",")),`Target(${r})`})(Se(n))}; limitType=${n.limitType})`}function Us(n,t){return t.isFoundDocument()&&(function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):tt.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,t)&&(function(r,i){for(const s of Wr(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,t)&&(function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0})(n,t)&&(function(r,i){return!(r.startAt&&!(function(a,u,c){const l=ac(a,u,c);return a.inclusive?l<=0:l<0})(r.startAt,Wr(r),i)||r.endAt&&!(function(a,u,c){const l=ac(a,u,c);return a.inclusive?l>=0:l>0})(r.endAt,Wr(r),i))})(n,t)}function Ty(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function gf(n){return(t,e)=>{let r=!1;for(const i of Wr(n)){const s=by(i,t,e);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function by(n,t,e){const r=n.field.isKeyField()?tt.comparator(t.key,e.key):(function(s,a,u){const c=a.data.field(s),l=u.data.field(s);return c!==null&&l!==null?hr(c,l):et(42886)})(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return et(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){const r=this.mapKeyFn(t),i=this.inner[r];if(i===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[e]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(t){dn(this.inner,((e,r)=>{for(const[i,s]of r)t(i,s)}))}isEmpty(){return Yh(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ay=new Rt(tt.comparator);function Be(){return Ay}const mf=new Rt(tt.comparator);function $r(...n){let t=mf;for(const e of n)t=t.insert(e.key,e);return t}function _f(n){let t=mf;return n.forEach(((e,r)=>t=t.insert(e,r.overlayedDocument))),t}function Tn(){return Qr()}function yf(){return Qr()}function Qr(){return new Ln((n=>n.toString()),((n,t)=>n.isEqual(t)))}const Iy=new Rt(tt.comparator),Sy=new Mt(tt.comparator);function ut(...n){let t=Sy;for(const e of n)t=t.add(e);return t}const Ry=new Mt(at);function Cy(){return Ry}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ba(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ms(t)?"-0":t}}function vf(n){return{integerValue:""+n}}function ky(n,t){return ey(t)?vf(t):Ba(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bs{constructor(){this._=void 0}}function Py(n,t,e){return n instanceof Es?(function(i,s){const a={fields:{[ef]:{stringValue:tf},[rf]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&La(s)&&(s=Ms(s)),s&&(a.fields[nf]=s),{mapValue:a}})(e,t):n instanceof ci?Ef(n,t):n instanceof hi?Tf(n,t):(function(i,s){const a=wf(i,s),u=hc(a)+hc(i.Ae);return Xo(a)&&Xo(i.Ae)?vf(u):Ba(i.serializer,u)})(n,t)}function Dy(n,t,e){return n instanceof ci?Ef(n,t):n instanceof hi?Tf(n,t):e}function wf(n,t){return n instanceof Ts?(function(r){return Xo(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(t)?t:{integerValue:0}:null}class Es extends Bs{}class ci extends Bs{constructor(t){super(),this.elements=t}}function Ef(n,t){const e=bf(t);for(const r of n.elements)e.some((i=>De(i,r)))||e.push(r);return{arrayValue:{values:e}}}class hi extends Bs{constructor(t){super(),this.elements=t}}function Tf(n,t){let e=bf(t);for(const r of n.elements)e=e.filter((i=>!De(i,r)));return{arrayValue:{values:e}}}class Ts extends Bs{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function hc(n){return Pt(n.integerValue||n.doubleValue)}function bf(n){return ja(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Vy(n,t){return n.field.isEqual(t.field)&&(function(r,i){return r instanceof ci&&i instanceof ci||r instanceof hi&&i instanceof hi?cr(r.elements,i.elements,De):r instanceof Ts&&i instanceof Ts?De(r.Ae,i.Ae):r instanceof Es&&i instanceof Es})(n.transform,t.transform)}class xy{constructor(t,e){this.version=t,this.transformResults=e}}class Te{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Te}static exists(t){return new Te(void 0,t)}static updateTime(t){return new Te(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Zi(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class $s{}function Af(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Sf(n.key,Te.none()):new yi(n.key,n.data,Te.none());{const e=n.data,r=se.empty();let i=new Mt($t.comparator);for(let s of t.fields)if(!i.has(s)){let a=e.field(s);a===null&&s.length>1&&(s=s.popLast(),a=e.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new pn(n.key,r,new ce(i.toArray()),Te.none())}}function Ny(n,t,e){n instanceof yi?(function(i,s,a){const u=i.value.clone(),c=dc(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,t,e):n instanceof pn?(function(i,s,a){if(!Zi(i.precondition,s))return void s.convertToUnknownDocument(a.version);const u=dc(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(If(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(n,t,e):(function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function Jr(n,t,e,r){return n instanceof yi?(function(s,a,u,c){if(!Zi(s.precondition,a))return u;const l=s.value.clone(),h=pc(s.fieldTransforms,c,a);return l.setAll(h),a.convertToFoundDocument(a.version,l).setHasLocalMutations(),null})(n,t,e,r):n instanceof pn?(function(s,a,u,c){if(!Zi(s.precondition,a))return u;const l=pc(s.fieldTransforms,c,a),h=a.data;return h.setAll(If(s)),h.setAll(l),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map((p=>p.field)))})(n,t,e,r):(function(s,a,u){return Zi(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,t,e)}function Oy(n,t){let e=null;for(const r of n.fieldTransforms){const i=t.data.field(r.field),s=wf(r.transform,i||null);s!=null&&(e===null&&(e=se.empty()),e.set(r.field,s))}return e||null}function fc(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&cr(r,i,((s,a)=>Vy(s,a)))})(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class yi extends $s{constructor(t,e,r,i=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class pn extends $s{constructor(t,e,r,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function If(n){const t=new Map;return n.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const r=n.data.field(e);t.set(e,r)}})),t}function dc(n,t,e){const r=new Map;mt(n.length===e.length,32656,{Re:e.length,Ve:n.length});for(let i=0;i<e.length;i++){const s=n[i],a=s.transform,u=t.data.field(s.field);r.set(s.field,Dy(a,u,e[i]))}return r}function pc(n,t,e){const r=new Map;for(const i of n){const s=i.transform,a=e.data.field(i.field);r.set(i.field,Py(s,a,t))}return r}class Sf extends $s{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class My extends $s{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ly{constructor(t,e,r,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(t,e){const r=e.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(t.key)&&Ny(s,t,r[i])}}applyToLocalView(t,e){for(const r of this.baseMutations)r.key.isEqual(t.key)&&(e=Jr(r,t,e,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(t.key)&&(e=Jr(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const r=yf();return this.mutations.forEach((i=>{const s=t.get(i.key),a=s.overlayedDocument;let u=this.applyToLocalView(a,s.mutatedFields);u=e.has(i.key)?null:u;const c=Af(a,u);c!==null&&r.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(st.min())})),r}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ut())}isEqual(t){return this.batchId===t.batchId&&cr(this.mutations,t.mutations,((e,r)=>fc(e,r)))&&cr(this.baseMutations,t.baseMutations,((e,r)=>fc(e,r)))}}class $a{constructor(t,e,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=i}static from(t,e,r){mt(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let i=(function(){return Iy})();const s=t.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new $a(t,e,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jy{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fy{constructor(t,e){this.count=t,this.unchangedNames=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vt,ct;function Uy(n){switch(n){case q.OK:return et(64938);case q.CANCELLED:case q.UNKNOWN:case q.DEADLINE_EXCEEDED:case q.RESOURCE_EXHAUSTED:case q.INTERNAL:case q.UNAVAILABLE:case q.UNAUTHENTICATED:return!1;case q.INVALID_ARGUMENT:case q.NOT_FOUND:case q.ALREADY_EXISTS:case q.PERMISSION_DENIED:case q.FAILED_PRECONDITION:case q.ABORTED:case q.OUT_OF_RANGE:case q.UNIMPLEMENTED:case q.DATA_LOSS:return!0;default:return et(15467,{code:n})}}function Rf(n){if(n===void 0)return Ue("GRPC error has no .code"),q.UNKNOWN;switch(n){case Vt.OK:return q.OK;case Vt.CANCELLED:return q.CANCELLED;case Vt.UNKNOWN:return q.UNKNOWN;case Vt.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case Vt.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case Vt.INTERNAL:return q.INTERNAL;case Vt.UNAVAILABLE:return q.UNAVAILABLE;case Vt.UNAUTHENTICATED:return q.UNAUTHENTICATED;case Vt.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case Vt.NOT_FOUND:return q.NOT_FOUND;case Vt.ALREADY_EXISTS:return q.ALREADY_EXISTS;case Vt.PERMISSION_DENIED:return q.PERMISSION_DENIED;case Vt.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case Vt.ABORTED:return q.ABORTED;case Vt.OUT_OF_RANGE:return q.OUT_OF_RANGE;case Vt.UNIMPLEMENTED:return q.UNIMPLEMENTED;case Vt.DATA_LOSS:return q.DATA_LOSS;default:return et(39323,{code:n})}}(ct=Vt||(Vt={}))[ct.OK=0]="OK",ct[ct.CANCELLED=1]="CANCELLED",ct[ct.UNKNOWN=2]="UNKNOWN",ct[ct.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ct[ct.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ct[ct.NOT_FOUND=5]="NOT_FOUND",ct[ct.ALREADY_EXISTS=6]="ALREADY_EXISTS",ct[ct.PERMISSION_DENIED=7]="PERMISSION_DENIED",ct[ct.UNAUTHENTICATED=16]="UNAUTHENTICATED",ct[ct.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ct[ct.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ct[ct.ABORTED=10]="ABORTED",ct[ct.OUT_OF_RANGE=11]="OUT_OF_RANGE",ct[ct.UNIMPLEMENTED=12]="UNIMPLEMENTED",ct[ct.INTERNAL=13]="INTERNAL",ct[ct.UNAVAILABLE=14]="UNAVAILABLE",ct[ct.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function By(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $y=new tn([4294967295,4294967295],0);function gc(n){const t=By().encode(n),e=new Bh;return e.update(t),new Uint8Array(e.digest())}function mc(n){const t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new tn([e,r],0),new tn([i,s],0)]}class qa{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new qr(`Invalid padding: ${e}`);if(r<0)throw new qr(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new qr(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new qr(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=tn.fromNumber(this.ge)}ye(t,e,r){let i=t.add(e.multiply(tn.fromNumber(r)));return i.compare($y)===1&&(i=new tn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=gc(t),[r,i]=mc(e);for(let s=0;s<this.hashCount;s++){const a=this.ye(r,i,s);if(!this.we(a))return!1}return!0}static create(t,e,r){const i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),a=new qa(s,i,e);return r.forEach((u=>a.insert(u))),a}insert(t){if(this.ge===0)return;const e=gc(t),[r,i]=mc(e);for(let s=0;s<this.hashCount;s++){const a=this.ye(r,i,s);this.Se(a)}}Se(t){const e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}}class qr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(t,e,r,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,r){const i=new Map;return i.set(t,vi.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new qs(st.min(),i,new Rt(at),Be(),ut())}}class vi{constructor(t,e,r,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new vi(r,e,ut(),ut(),ut())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(t,e,r,i){this.be=t,this.removedTargetIds=e,this.key=r,this.De=i}}class Cf{constructor(t,e){this.targetId=t,this.Ce=e}}class kf{constructor(t,e,r=qt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=i}}class _c{constructor(){this.ve=0,this.Fe=yc(),this.Me=qt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=ut(),e=ut(),r=ut();return this.Fe.forEach(((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:r=r.add(i);break;default:et(38017,{changeType:s})}})),new vi(this.Me,this.xe,t,e,r)}qe(){this.Oe=!1,this.Fe=yc()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,mt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class qy{constructor(t){this.Ge=t,this.ze=new Map,this.je=Be(),this.Je=zi(),this.He=zi(),this.Ye=new Rt(at)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const r=this.nt(e);switch(t.state){case 0:this.rt(e)&&r.Le(t.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(t.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(r.We(),r.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),r.Le(t.resumeToken));break;default:et(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((r,i)=>{this.rt(i)&&e(i)}))}st(t){const e=t.targetId,r=t.Ce.count,i=this.ot(e);if(i){const s=i.target;if(Zo(s))if(r===0){const a=new tt(s.path);this.et(e,a,Qt.newNoDocument(a,st.min()))}else mt(r===1,20013,{expectedCount:r});else{const a=this._t(e);if(a!==r){const u=this.ut(t),c=u?this.ct(u,t,a):1;if(c!==0){this.it(e);const l=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,l)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=e;let a,u;try{a=an(r).toUint8Array()}catch(c){if(c instanceof Zh)return lr("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new qa(a,i,s)}catch(c){return lr(c instanceof qr?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.ge===0?null:u}ct(t,e,r){return e.Ce.count===r-this.Pt(t,e.targetId)?0:2}Pt(t,e){const r=this.Ge.getRemoteKeysForTarget(e);let i=0;return r.forEach((s=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.et(e,s,null),i++)})),i}Tt(t){const e=new Map;this.ze.forEach(((s,a)=>{const u=this.ot(a);if(u){if(s.current&&Zo(u.target)){const c=new tt(u.target.path);this.It(c).has(a)||this.Et(a,c)||this.et(a,c,Qt.newNoDocument(c,t))}s.Be&&(e.set(a,s.ke()),s.qe())}}));let r=ut();this.He.forEach(((s,a)=>{let u=!0;a.forEachWhile((c=>{const l=this.ot(c);return!l||l.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(s))})),this.je.forEach(((s,a)=>a.setReadTime(t)));const i=new qs(t,e,this.Ye,this.je,r);return this.je=Be(),this.Je=zi(),this.He=zi(),this.Ye=new Rt(at),i}Xe(t,e){if(!this.rt(t))return;const r=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,r),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,r){if(!this.rt(t))return;const i=this.nt(t);this.Et(t,e)?i.Qe(e,1):i.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),r&&(this.je=this.je.insert(e,r))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new _c,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new Mt(at),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new Mt(at),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||K("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new _c),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function zi(){return new Rt(tt.comparator)}function yc(){return new Rt(tt.comparator)}const zy={asc:"ASCENDING",desc:"DESCENDING"},Gy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Hy={and:"AND",or:"OR"};class Ky{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ea(n,t){return n.useProto3Json||Os(t)?t:{value:t}}function bs(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Pf(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Wy(n,t){return bs(n,t.toTimestamp())}function Re(n){return mt(!!n,49232),st.fromTimestamp((function(e){const r=on(e);return new At(r.seconds,r.nanos)})(n))}function za(n,t){return na(n,t).canonicalString()}function na(n,t){const e=(function(i){return new bt(["projects",i.projectId,"databases",i.database])})(n).child("documents");return t===void 0?e:e.child(t)}function Df(n){const t=bt.fromString(n);return mt(Mf(t),10190,{key:t.toString()}),t}function ra(n,t){return za(n.databaseId,t.path)}function ko(n,t){const e=Df(t);if(e.get(1)!==n.databaseId.projectId)throw new W(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new W(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new tt(xf(e))}function Vf(n,t){return za(n.databaseId,t)}function Qy(n){const t=Df(n);return t.length===4?bt.emptyPath():xf(t)}function ia(n){return new bt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function xf(n){return mt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function vc(n,t,e){return{name:ra(n,t),fields:e.value.mapValue.fields}}function Jy(n,t){let e;if("targetChange"in t){t.targetChange;const r=(function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:et(39313,{state:l})})(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=(function(l,h){return l.useProto3Json?(mt(h===void 0||typeof h=="string",58123),qt.fromBase64String(h||"")):(mt(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),qt.fromUint8Array(h||new Uint8Array))})(n,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&(function(l){const h=l.code===void 0?q.UNKNOWN:Rf(l.code);return new W(h,l.message||"")})(a);e=new kf(r,i,s,u||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=ko(n,r.document.name),s=Re(r.document.updateTime),a=r.document.createTime?Re(r.document.createTime):st.min(),u=new se({mapValue:{fields:r.document.fields}}),c=Qt.newFoundDocument(i,s,a,u),l=r.targetIds||[],h=r.removedTargetIds||[];e=new ts(l,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=ko(n,r.document),s=r.readTime?Re(r.readTime):st.min(),a=Qt.newNoDocument(i,s),u=r.removedTargetIds||[];e=new ts([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=ko(n,r.document),s=r.removedTargetIds||[];e=new ts([],s,i,null)}else{if(!("filter"in t))return et(11601,{Rt:t});{t.filter;const r=t.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,a=new Fy(i,s),u=r.targetId;e=new Cf(u,a)}}return e}function Xy(n,t){let e;if(t instanceof yi)e={update:vc(n,t.key,t.value)};else if(t instanceof Sf)e={delete:ra(n,t.key)};else if(t instanceof pn)e={update:vc(n,t.key,t.data),updateMask:ov(t.fieldMask)};else{if(!(t instanceof My))return et(16599,{Vt:t.type});e={verify:ra(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((r=>(function(s,a){const u=a.transform;if(u instanceof Es)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ci)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof hi)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Ts)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw et(20930,{transform:a.transform})})(0,r)))),t.precondition.isNone||(e.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:Wy(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:et(27497)})(n,t.precondition)),e}function Yy(n,t){return n&&n.length>0?(mt(t!==void 0,14353),n.map((e=>(function(i,s){let a=i.updateTime?Re(i.updateTime):Re(s);return a.isEqual(st.min())&&(a=Re(s)),new xy(a,i.transformResults||[])})(e,t)))):[]}function Zy(n,t){return{documents:[Vf(n,t.path)]}}function tv(n,t){const e={structuredQuery:{}},r=t.path;let i;t.collectionGroup!==null?(i=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=Vf(n,i);const s=(function(l){if(l.length!==0)return Of(Ve.create(l,"and"))})(t.filters);s&&(e.structuredQuery.where=s);const a=(function(l){if(l.length!==0)return l.map((h=>(function(_){return{field:Qn(_.field),direction:rv(_.dir)}})(h)))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);const u=ea(n,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=(function(l){return{before:l.inclusive,values:l.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(l){return{before:!l.inclusive,values:l.position}})(t.endAt)),{ft:e,parent:i}}function ev(n){let t=Qy(n.parent);const e=n.structuredQuery,r=e.from?e.from.length:0;let i=null;if(r>0){mt(r===1,65062);const h=e.from[0];h.allDescendants?i=h.collectionId:t=t.child(h.collectionId)}let s=[];e.where&&(s=(function(p){const _=Nf(p);return _ instanceof Ve&&cf(_)?_.getFilters():[_]})(e.where));let a=[];e.orderBy&&(a=(function(p){return p.map((_=>(function(g){return new ws(Jn(g.field),(function(b){switch(b){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(g.direction))})(_)))})(e.orderBy));let u=null;e.limit&&(u=(function(p){let _;return _=typeof p=="object"?p.value:p,Os(_)?null:_})(e.limit));let c=null;e.startAt&&(c=(function(p){const _=!!p.before,I=p.values||[];return new vs(I,_)})(e.startAt));let l=null;return e.endAt&&(l=(function(p){const _=!p.before,I=p.values||[];return new vs(I,_)})(e.endAt)),vy(t,i,a,s,u,"F",c,l)}function nv(n,t){const e=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return et(28987,{purpose:i})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Nf(n){return n.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const r=Jn(e.unaryFilter.field);return Ot.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Jn(e.unaryFilter.field);return Ot.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Jn(e.unaryFilter.field);return Ot.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Jn(e.unaryFilter.field);return Ot.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return et(61313);default:return et(60726)}})(n):n.fieldFilter!==void 0?(function(e){return Ot.create(Jn(e.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return et(58110);default:return et(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(e){return Ve.create(e.compositeFilter.filters.map((r=>Nf(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return et(1026)}})(e.compositeFilter.op))})(n):et(30097,{filter:n})}function rv(n){return zy[n]}function iv(n){return Gy[n]}function sv(n){return Hy[n]}function Qn(n){return{fieldPath:n.canonicalString()}}function Jn(n){return $t.fromServerFormat(n.fieldPath)}function Of(n){return n instanceof Ot?(function(e){if(e.op==="=="){if(oc(e.value))return{unaryFilter:{field:Qn(e.field),op:"IS_NAN"}};if(sc(e.value))return{unaryFilter:{field:Qn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(oc(e.value))return{unaryFilter:{field:Qn(e.field),op:"IS_NOT_NAN"}};if(sc(e.value))return{unaryFilter:{field:Qn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Qn(e.field),op:iv(e.op),value:e.value}}})(n):n instanceof Ve?(function(e){const r=e.getFilters().map((i=>Of(i)));return r.length===1?r[0]:{compositeFilter:{op:sv(e.op),filters:r}}})(n):et(54877,{filter:n})}function ov(n){const t=[];return n.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Mf(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Je{constructor(t,e,r,i,s=st.min(),a=st.min(),u=qt.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(t){return new Je(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Je(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Je(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Je(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class av{constructor(t){this.yt=t}}function uv(n){const t=ev({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ta(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{constructor(){this.Cn=new cv}addToCollectionParentIndex(t,e){return this.Cn.add(e),B.resolve()}getCollectionParents(t,e){return B.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return B.resolve()}deleteFieldIndex(t,e){return B.resolve()}deleteAllFieldIndexes(t){return B.resolve()}createTargetIndexes(t,e){return B.resolve()}getDocumentsMatchingTarget(t,e){return B.resolve(null)}getIndexType(t,e){return B.resolve(0)}getFieldIndexes(t,e){return B.resolve([])}getNextCollectionGroupToUpdate(t){return B.resolve(null)}getMinOffset(t,e){return B.resolve(sn.min())}getMinOffsetFromCollectionGroup(t,e){return B.resolve(sn.min())}updateCollectionGroup(t,e,r){return B.resolve()}updateIndexEntries(t,e){return B.resolve()}}class cv{constructor(){this.index={}}add(t){const e=t.lastSegment(),r=t.popLast(),i=this.index[e]||new Mt(bt.comparator),s=!i.has(r);return this.index[e]=i.add(r),s}has(t){const e=t.lastSegment(),r=t.popLast(),i=this.index[e];return i&&i.has(r)}getEntries(t){return(this.index[t]||new Mt(bt.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Lf=41943040;class re{static withCacheSize(t){return new re(t,re.DEFAULT_COLLECTION_PERCENTILE,re.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */re.DEFAULT_COLLECTION_PERCENTILE=10,re.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,re.DEFAULT=new re(Lf,re.DEFAULT_COLLECTION_PERCENTILE,re.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),re.DISABLED=new re(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new dr(0)}static cr(){return new dr(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ec="LruGarbageCollector",hv=1048576;function Tc([n,t],[e,r]){const i=at(n,e);return i===0?at(t,r):i}class fv{constructor(t){this.Ir=t,this.buffer=new Mt(Tc),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const r=this.buffer.last();Tc(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}}class dv{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){K(Ec,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){wr(e)?K(Ec,"Ignoring IndexedDB error during garbage collection: ",e):await vr(e)}await this.Vr(3e5)}))}}class pv{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((r=>Math.floor(e/100*r)))}nthSequenceNumber(t,e){if(e===0)return B.resolve(Ns.ce);const r=new fv(e);return this.mr.forEachTarget(t,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(t,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(t,e,r){return this.mr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(K("LruGarbageCollector","Garbage collection skipped; disabled"),B.resolve(wc)):this.getCacheSize(t).next((r=>r<this.params.cacheSizeCollectionThreshold?(K("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),wc):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let r,i,s,a,u,c,l;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(K("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,a=Date.now(),this.nthSequenceNumber(t,i)))).next((p=>(r=p,u=Date.now(),this.removeTargets(t,r,e)))).next((p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(t,r)))).next((p=>(l=Date.now(),Kn()<=ht.DEBUG&&K("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(c-u)+`ms
	Removed ${p} documents in `+(l-c)+`ms
Total Duration: ${l-h}ms`),B.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p}))))}}function gv(n,t){return new pv(n,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mv{constructor(){this.changes=new Ln((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Qt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const r=this.changes.get(e);return r!==void 0?B.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _v{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yv{constructor(t,e,r,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=i}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next((i=>(r=i,this.remoteDocumentCache.getEntry(t,e)))).next((i=>(r!==null&&Jr(r.mutation,i,ce.empty(),At.now()),i)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.getLocalViewOfDocuments(t,r,ut()).next((()=>r))))}getLocalViewOfDocuments(t,e,r=ut()){const i=Tn();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,r).next((s=>{let a=$r();return s.forEach(((u,c)=>{a=a.insert(u,c.overlayedDocument)})),a}))))}getOverlayedDocuments(t,e){const r=Tn();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,ut())))}populateOverlays(t,e,r){const i=[];return r.forEach((s=>{e.has(s)||i.push(s)})),this.documentOverlayCache.getOverlays(t,i).next((s=>{s.forEach(((a,u)=>{e.set(a,u)}))}))}computeViews(t,e,r,i){let s=Be();const a=Qr(),u=(function(){return Qr()})();return e.forEach(((c,l)=>{const h=r.get(l.key);i.has(l.key)&&(h===void 0||h.mutation instanceof pn)?s=s.insert(l.key,l):h!==void 0?(a.set(l.key,h.mutation.getFieldMask()),Jr(h.mutation,l,h.mutation.getFieldMask(),At.now())):a.set(l.key,ce.empty())})),this.recalculateAndSaveOverlays(t,s).next((c=>(c.forEach(((l,h)=>a.set(l,h))),e.forEach(((l,h)=>u.set(l,new _v(h,a.get(l)??null)))),u)))}recalculateAndSaveOverlays(t,e){const r=Qr();let i=new Rt(((a,u)=>a-u)),s=ut();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((a=>{for(const u of a)u.keys().forEach((c=>{const l=e.get(c);if(l===null)return;let h=r.get(c)||ce.empty();h=u.applyToLocalView(l,h),r.set(c,h);const p=(i.get(u.batchId)||ut()).add(c);i=i.insert(u.batchId,p)}))})).next((()=>{const a=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),l=c.key,h=c.value,p=yf();h.forEach((_=>{if(!s.has(_)){const I=Af(e.get(_),r.get(_));I!==null&&p.set(_,I),s=s.add(_)}})),a.push(this.documentOverlayCache.saveOverlays(t,l,p))}return B.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.recalculateAndSaveOverlays(t,r)))}getDocumentsMatchingQuery(t,e,r,i){return(function(a){return tt.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):wy(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,i):this.getDocumentsMatchingCollectionQuery(t,e,r,i)}getNextDocuments(t,e,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,i).next((s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,i-s.size):B.resolve(Tn());let u=oi,c=s;return a.next((l=>B.forEach(l,((h,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),s.get(h)?B.resolve():this.remoteDocumentCache.getEntry(t,h).next((_=>{c=c.insert(h,_)}))))).next((()=>this.populateOverlays(t,l,s))).next((()=>this.computeViews(t,c,l,ut()))).next((h=>({batchId:u,changes:_f(h)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new tt(e)).next((r=>{let i=$r();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(t,e,r,i){const s=e.collectionGroup;let a=$r();return this.indexManager.getCollectionParents(t,s).next((u=>B.forEach(u,(c=>{const l=(function(p,_){return new Ls(_,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(e,c.child(s));return this.getDocumentsMatchingCollectionQuery(t,l,r,i).next((h=>{h.forEach(((p,_)=>{a=a.insert(p,_)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(t,e,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next((a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,s,i)))).next((a=>{s.forEach(((c,l)=>{const h=l.getKey();a.get(h)===null&&(a=a.insert(h,Qt.newInvalidDocument(h)))}));let u=$r();return a.forEach(((c,l)=>{const h=s.get(c);h!==void 0&&Jr(h.mutation,l,ce.empty(),At.now()),Us(e,l)&&(u=u.insert(c,l))})),u}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return B.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(i){return{id:i.id,version:i.version,createTime:Re(i.createTime)}})(e)),B.resolve()}getNamedQuery(t,e){return B.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(i){return{name:i.name,query:uv(i.bundledQuery),readTime:Re(i.readTime)}})(e)),B.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(){this.overlays=new Rt(tt.comparator),this.qr=new Map}getOverlay(t,e){return B.resolve(this.overlays.get(e))}getOverlays(t,e){const r=Tn();return B.forEach(e,(i=>this.getOverlay(t,i).next((s=>{s!==null&&r.set(i,s)})))).next((()=>r))}saveOverlays(t,e,r){return r.forEach(((i,s)=>{this.St(t,e,s)})),B.resolve()}removeOverlaysForBatchId(t,e,r){const i=this.qr.get(r);return i!==void 0&&(i.forEach((s=>this.overlays=this.overlays.remove(s))),this.qr.delete(r)),B.resolve()}getOverlaysForCollection(t,e,r){const i=Tn(),s=e.length+1,a=new tt(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const c=u.getNext().value,l=c.getKey();if(!e.isPrefixOf(l.path))break;l.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return B.resolve(i)}getOverlaysForCollectionGroup(t,e,r,i){let s=new Rt(((l,h)=>l-h));const a=this.overlays.getIterator();for(;a.hasNext();){const l=a.getNext().value;if(l.getKey().getCollectionGroup()===e&&l.largestBatchId>r){let h=s.get(l.largestBatchId);h===null&&(h=Tn(),s=s.insert(l.largestBatchId,h)),h.set(l.getKey(),l)}}const u=Tn(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach(((l,h)=>u.set(l,h))),!(u.size()>=i)););return B.resolve(u)}St(t,e,r){const i=this.overlays.get(r.key);if(i!==null){const a=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new jy(e,r));let s=this.qr.get(e);s===void 0&&(s=ut(),this.qr.set(e,s)),this.qr.set(e,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ev{constructor(){this.sessionToken=qt.EMPTY_BYTE_STRING}getSessionToken(t){return B.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,B.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ga{constructor(){this.Qr=new Mt(Lt.$r),this.Ur=new Mt(Lt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const r=new Lt(t,e);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(t,e){t.forEach((r=>this.addReference(r,e)))}removeReference(t,e){this.Gr(new Lt(t,e))}zr(t,e){t.forEach((r=>this.removeReference(r,e)))}jr(t){const e=new tt(new bt([])),r=new Lt(e,t),i=new Lt(e,t+1),s=[];return this.Ur.forEachInRange([r,i],(a=>{this.Gr(a),s.push(a.key)})),s}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new tt(new bt([])),r=new Lt(e,t),i=new Lt(e,t+1);let s=ut();return this.Ur.forEachInRange([r,i],(a=>{s=s.add(a.key)})),s}containsKey(t){const e=new Lt(t,0),r=this.Qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}}class Lt{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return tt.comparator(t.key,e.key)||at(t.Yr,e.Yr)}static Kr(t,e){return at(t.Yr,e.Yr)||tt.comparator(t.key,e.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tv{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new Mt(Lt.$r)}checkEmpty(t){return B.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,i){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Ly(s,e,r,i);this.mutationQueue.push(a);for(const u of i)this.Zr=this.Zr.add(new Lt(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return B.resolve(a)}lookupMutationBatch(t,e){return B.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const r=e+1,i=this.ei(r),s=i<0?0:i;return B.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return B.resolve(this.mutationQueue.length===0?Ma:this.tr-1)}getAllMutationBatches(t){return B.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const r=new Lt(e,0),i=new Lt(e,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([r,i],(a=>{const u=this.Xr(a.Yr);s.push(u)})),B.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new Mt(at);return e.forEach((i=>{const s=new Lt(i,0),a=new Lt(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,a],(u=>{r=r.add(u.Yr)}))})),B.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(t,e){const r=e.path,i=r.length+1;let s=r;tt.isDocumentKey(s)||(s=s.child(""));const a=new Lt(new tt(s),0);let u=new Mt(at);return this.Zr.forEachWhile((c=>{const l=c.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(u=u.add(c.Yr)),!0)}),a),B.resolve(this.ti(u))}ti(t){const e=[];return t.forEach((r=>{const i=this.Xr(r);i!==null&&e.push(i)})),e}removeMutationBatch(t,e){mt(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return B.forEach(e.mutations,(i=>{const s=new Lt(i.key,e.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.Zr=r}))}ir(t){}containsKey(t,e){const r=new Lt(e,0),i=this.Zr.firstAfterOrEqual(r);return B.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,B.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bv{constructor(t){this.ri=t,this.docs=(function(){return new Rt(tt.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const r=e.key,i=this.docs.get(r),s=i?i.size:0,a=this.ri(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const r=this.docs.get(e);return B.resolve(r?r.document.mutableCopy():Qt.newInvalidDocument(e))}getEntries(t,e){let r=Be();return e.forEach((i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Qt.newInvalidDocument(i))})),B.resolve(r)}getDocumentsMatchingQuery(t,e,r,i){let s=Be();const a=e.path,u=new tt(a.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:l,value:{document:h}}=c.getNext();if(!a.isPrefixOf(l.path))break;l.path.length>a.length+1||X_(J_(h),r)<=0||(i.has(h.key)||Us(e,h))&&(s=s.insert(h.key,h.mutableCopy()))}return B.resolve(s)}getAllFromCollectionGroup(t,e,r,i){et(9500)}ii(t,e){return B.forEach(this.docs,(r=>e(r)))}newChangeBuffer(t){return new Av(this)}getSize(t){return B.resolve(this.size)}}class Av extends mv{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?e.push(this.Nr.addEntry(t,i)):this.Nr.removeEntry(r)})),B.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv{constructor(t){this.persistence=t,this.si=new Ln((e=>Fa(e)),Ua),this.lastRemoteSnapshotVersion=st.min(),this.highestTargetId=0,this.oi=0,this._i=new Ga,this.targetCount=0,this.ai=dr.ur()}forEachTarget(t,e){return this.si.forEach(((r,i)=>e(i))),B.resolve()}getLastRemoteSnapshotVersion(t){return B.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return B.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),B.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.oi&&(this.oi=e),B.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new dr(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,B.resolve()}updateTargetData(t,e){return this.Pr(e),B.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,B.resolve()}removeTargets(t,e,r){let i=0;const s=[];return this.si.forEach(((a,u)=>{u.sequenceNumber<=e&&r.get(u.targetId)===null&&(this.si.delete(a),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)})),B.waitFor(s).next((()=>i))}getTargetCount(t){return B.resolve(this.targetCount)}getTargetData(t,e){const r=this.si.get(e)||null;return B.resolve(r)}addMatchingKeys(t,e,r){return this._i.Wr(e,r),B.resolve()}removeMatchingKeys(t,e,r){this._i.zr(e,r);const i=this.persistence.referenceDelegate,s=[];return i&&e.forEach((a=>{s.push(i.markPotentiallyOrphaned(t,a))})),B.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),B.resolve()}getMatchingKeysForTargetId(t,e){const r=this._i.Hr(e);return B.resolve(r)}containsKey(t,e){return B.resolve(this._i.containsKey(e))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf{constructor(t,e){this.ui={},this.overlays={},this.ci=new Ns(0),this.li=!1,this.li=!0,this.hi=new Ev,this.referenceDelegate=t(this),this.Pi=new Iv(this),this.indexManager=new lv,this.remoteDocumentCache=(function(i){return new bv(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new av(e),this.Ii=new vv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new wv,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ui[t.toKey()];return r||(r=new Tv(e,this.referenceDelegate),this.ui[t.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,r){K("MemoryPersistence","Starting transaction:",t);const i=new Sv(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((s=>this.referenceDelegate.di(i).next((()=>s)))).toPromise().then((s=>(i.raiseOnCommittedEvent(),s)))}Ai(t,e){return B.or(Object.values(this.ui).map((r=>()=>r.containsKey(t,e))))}}class Sv extends Z_{constructor(t){super(),this.currentSequenceNumber=t}}class Ha{constructor(t){this.persistence=t,this.Ri=new Ga,this.Vi=null}static mi(t){return new Ha(t)}get fi(){if(this.Vi)return this.Vi;throw et(60996)}addReference(t,e,r){return this.Ri.addReference(r,e),this.fi.delete(r.toString()),B.resolve()}removeReference(t,e,r){return this.Ri.removeReference(r,e),this.fi.add(r.toString()),B.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),B.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((i=>this.fi.add(i.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((i=>{i.forEach((s=>this.fi.add(s.toString())))})).next((()=>r.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return B.forEach(this.fi,(r=>{const i=tt.fromPath(r);return this.gi(t,i).next((s=>{s||e.removeEntry(i,st.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((r=>{r?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return B.or([()=>B.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class As{constructor(t,e){this.persistence=t,this.pi=new Ln((r=>ny(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=gv(this,e)}static mi(t,e){return new As(t,e)}Ei(){}di(t){return B.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((r=>e.next((i=>r+i))))}wr(t){let e=0;return this.pr(t,(r=>{e++})).next((()=>e))}pr(t,e){return B.forEach(this.pi,((r,i)=>this.br(t,r,i).next((s=>s?B.resolve():e(i)))))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ii(t,(a=>this.br(t,a,e).next((u=>{u||(r++,s.removeEntry(a,st.min()))})))).next((()=>s.apply(t))).next((()=>r))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),B.resolve()}removeTarget(t,e){const r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),B.resolve()}removeReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),B.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),B.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Xi(t.data.value)),e}br(t,e,r){return B.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const i=this.pi.get(e);return B.resolve(i!==void 0&&i>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ka{constructor(t,e,r,i){this.targetId=t,this.fromCache=e,this.Es=r,this.ds=i}static As(t,e){let r=ut(),i=ut();for(const s of e.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Ka(t,e.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cv{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return ym()?8:ty(mm())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,r,i){const s={result:null};return this.ys(t,e).next((a=>{s.result=a})).next((()=>{if(!s.result)return this.ws(t,e,i,r).next((a=>{s.result=a}))})).next((()=>{if(s.result)return;const a=new Rv;return this.Ss(t,e,a).next((u=>{if(s.result=u,this.Vs)return this.bs(t,e,a,u.size)}))})).next((()=>s.result))}bs(t,e,r,i){return r.documentReadCount<this.fs?(Kn()<=ht.DEBUG&&K("QueryEngine","SDK will not create cache indexes for query:",Wn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),B.resolve()):(Kn()<=ht.DEBUG&&K("QueryEngine","Query:",Wn(e),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(Kn()<=ht.DEBUG&&K("QueryEngine","The SDK decides to create cache indexes for query:",Wn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Se(e))):B.resolve())}ys(t,e){if(cc(e))return B.resolve(null);let r=Se(e);return this.indexManager.getIndexType(t,r).next((i=>i===0?null:(e.limit!==null&&i===1&&(e=ta(e,null,"F"),r=Se(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next((s=>{const a=ut(...s);return this.ps.getDocuments(t,a).next((u=>this.indexManager.getMinOffset(t,r).next((c=>{const l=this.Ds(e,u);return this.Cs(e,l,a,c.readTime)?this.ys(t,ta(e,null,"F")):this.vs(t,l,e,c)}))))})))))}ws(t,e,r,i){return cc(e)||i.isEqual(st.min())?B.resolve(null):this.ps.getDocuments(t,r).next((s=>{const a=this.Ds(e,s);return this.Cs(e,a,r,i)?B.resolve(null):(Kn()<=ht.DEBUG&&K("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Wn(e)),this.vs(t,a,e,Q_(i,oi)).next((u=>u)))}))}Ds(t,e){let r=new Mt(gf(t));return e.forEach(((i,s)=>{Us(t,s)&&(r=r.add(s))})),r}Cs(t,e,r,i){if(t.limit===null)return!1;if(r.size!==e.size)return!0;const s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(t,e,r){return Kn()<=ht.DEBUG&&K("QueryEngine","Using full collection scan to execute query:",Wn(e)),this.ps.getDocumentsMatchingQuery(t,e,sn.min(),r)}vs(t,e,r,i){return this.ps.getDocumentsMatchingQuery(t,r,i).next((s=>(e.forEach((a=>{s=s.insert(a.key,a)})),s)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wa="LocalStore",kv=3e8;class Pv{constructor(t,e,r,i){this.persistence=t,this.Fs=e,this.serializer=i,this.Ms=new Rt(at),this.xs=new Ln((s=>Fa(s)),Ua),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(r)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new yv(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function Dv(n,t,e,r){return new Pv(n,t,e,r)}async function Ff(n,t){const e=ot(n);return await e.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return e.mutationQueue.getAllMutationBatches(r).next((s=>(i=s,e.Bs(t),e.mutationQueue.getAllMutationBatches(r)))).next((s=>{const a=[],u=[];let c=ut();for(const l of i){a.push(l.batchId);for(const h of l.mutations)c=c.add(h.key)}for(const l of s){u.push(l.batchId);for(const h of l.mutations)c=c.add(h.key)}return e.localDocuments.getDocuments(r,c).next((l=>({Ls:l,removedBatchIds:a,addedBatchIds:u})))}))}))}function Vv(n,t){const e=ot(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const i=t.batch.keys(),s=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,c,l,h){const p=l.batch,_=p.keys();let I=B.resolve();return _.forEach((g=>{I=I.next((()=>h.getEntry(c,g))).next((S=>{const b=l.docVersions.get(g);mt(b!==null,48541),S.version.compareTo(b)<0&&(p.applyToRemoteDocument(S,l),S.isValidDocument()&&(S.setReadTime(l.commitVersion),h.addEntry(S)))}))})),I.next((()=>u.mutationQueue.removeMutationBatch(c,p)))})(e,r,t,s).next((()=>s.apply(r))).next((()=>e.mutationQueue.performConsistencyCheck(r))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(r,i,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let c=ut();for(let l=0;l<u.mutationResults.length;++l)u.mutationResults[l].transformResults.length>0&&(c=c.add(u.batch.mutations[l].key));return c})(t)))).next((()=>e.localDocuments.getDocuments(r,i)))}))}function Uf(n){const t=ot(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function xv(n,t){const e=ot(n),r=t.snapshotVersion;let i=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(s=>{const a=e.Ns.newChangeBuffer({trackRemovals:!0});i=e.Ms;const u=[];t.targetChanges.forEach(((h,p)=>{const _=i.get(p);if(!_)return;u.push(e.Pi.removeMatchingKeys(s,h.removedDocuments,p).next((()=>e.Pi.addMatchingKeys(s,h.addedDocuments,p))));let I=_.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(p)!==null?I=I.withResumeToken(qt.EMPTY_BYTE_STRING,st.min()).withLastLimboFreeSnapshotVersion(st.min()):h.resumeToken.approximateByteSize()>0&&(I=I.withResumeToken(h.resumeToken,r)),i=i.insert(p,I),(function(S,b,k){return S.resumeToken.approximateByteSize()===0||b.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=kv?!0:k.addedDocuments.size+k.modifiedDocuments.size+k.removedDocuments.size>0})(_,I,h)&&u.push(e.Pi.updateTargetData(s,I))}));let c=Be(),l=ut();if(t.documentUpdates.forEach((h=>{t.resolvedLimboDocuments.has(h)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,h))})),u.push(Nv(s,a,t.documentUpdates).next((h=>{c=h.ks,l=h.qs}))),!r.isEqual(st.min())){const h=e.Pi.getLastRemoteSnapshotVersion(s).next((p=>e.Pi.setTargetsMetadata(s,s.currentSequenceNumber,r)));u.push(h)}return B.waitFor(u).next((()=>a.apply(s))).next((()=>e.localDocuments.getLocalViewOfDocuments(s,c,l))).next((()=>c))})).then((s=>(e.Ms=i,s)))}function Nv(n,t,e){let r=ut(),i=ut();return e.forEach((s=>r=r.add(s))),t.getEntries(n,r).next((s=>{let a=Be();return e.forEach(((u,c)=>{const l=s.get(u);c.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(st.min())?(t.removeEntry(u,c.readTime),a=a.insert(u,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(t.addEntry(c),a=a.insert(u,c)):K(Wa,"Ignoring outdated watch update for ",u,". Current version:",l.version," Watch version:",c.version)})),{ks:a,qs:i}}))}function Ov(n,t){const e=ot(n);return e.persistence.runTransaction("Get next mutation batch","readonly",(r=>(t===void 0&&(t=Ma),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t))))}function Mv(n,t){const e=ot(n);return e.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return e.Pi.getTargetData(r,t).next((s=>s?(i=s,B.resolve(i)):e.Pi.allocateTargetId(r).next((a=>(i=new Je(t,a,"TargetPurposeListen",r.currentSequenceNumber),e.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{const i=e.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(r.targetId,r),e.xs.set(t,r.targetId)),r}))}async function sa(n,t,e){const r=ot(n),i=r.Ms.get(t),s=e?"readwrite":"readwrite-primary";try{e||await r.persistence.runTransaction("Release target",s,(a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!wr(a))throw a;K(Wa,`Failed to update sequence numbers for target ${t}: ${a}`)}r.Ms=r.Ms.remove(t),r.xs.delete(i.target)}function bc(n,t,e){const r=ot(n);let i=st.min(),s=ut();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(c,l,h){const p=ot(c),_=p.xs.get(h);return _!==void 0?B.resolve(p.Ms.get(_)):p.Pi.getTargetData(l,h)})(r,a,Se(t)).next((u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,u.targetId).next((c=>{s=c}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,t,e?i:st.min(),e?s:ut()))).next((u=>(Lv(r,Ty(t),u),{documents:u,Qs:s})))))}function Lv(n,t,e){let r=n.Os.get(t)||st.min();e.forEach(((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)})),n.Os.set(t,r)}class Ac{constructor(){this.activeTargetIds=Cy()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class jv{constructor(){this.Mo=new Ac,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,r){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Ac,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fv{Oo(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ic="ConnectivityMonitor";class Sc{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){K(Ic,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){K(Ic,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gi=null;function oa(){return Gi===null?Gi=(function(){return 268435456+Math.round(2147483648*Math.random())})():Gi++,"0x"+Gi.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Po="RestConnection",Uv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Bv{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===_s?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(t,e,r,i,s){const a=oa(),u=this.zo(t,e.toUriEncodedString());K(Po,`Sending RPC '${t}' ${a}:`,u,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,i,s);const{host:l}=new URL(u),h=Da(l);return this.Jo(t,u,c,r,h).then((p=>(K(Po,`Received RPC '${t}' ${a}: `,p),p)),(p=>{throw lr(Po,`RPC '${t}' ${a} failed with error: `,p,"url: ",u,"request:",r),p}))}Ho(t,e,r,i,s,a){return this.Go(t,e,r,i,s)}jo(t,e,r){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+yr})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((i,s)=>t[s]=i)),r&&r.headers.forEach(((i,s)=>t[s]=i))}zo(t,e){const r=Uv[t];return`${this.Uo}/v1/${e}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $v{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kt="WebChannelConnection";class qv extends Bv{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,r,i,s){const a=oa();return new Promise(((u,c)=>{const l=new $h;l.setWithCredentials(!0),l.listenOnce(qh.COMPLETE,(()=>{try{switch(l.getLastErrorCode()){case Ji.NO_ERROR:const p=l.getResponseJson();K(Kt,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(p)),u(p);break;case Ji.TIMEOUT:K(Kt,`RPC '${t}' ${a} timed out`),c(new W(q.DEADLINE_EXCEEDED,"Request time out"));break;case Ji.HTTP_ERROR:const _=l.getStatus();if(K(Kt,`RPC '${t}' ${a} failed with status:`,_,"response text:",l.getResponseText()),_>0){let I=l.getResponseJson();Array.isArray(I)&&(I=I[0]);const g=I?.error;if(g&&g.status&&g.message){const S=(function(k){const y=k.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf(y)>=0?y:q.UNKNOWN})(g.status);c(new W(S,g.message))}else c(new W(q.UNKNOWN,"Server responded with status "+l.getStatus()))}else c(new W(q.UNAVAILABLE,"Connection failed."));break;default:et(9055,{l_:t,streamId:a,h_:l.getLastErrorCode(),P_:l.getLastError()})}}finally{K(Kt,`RPC '${t}' ${a} completed.`)}}));const h=JSON.stringify(i);K(Kt,`RPC '${t}' ${a} sending request:`,i),l.send(e,"POST",h,r,15)}))}T_(t,e,r){const i=oa(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Hh(),u=Gh(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(c.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,e,r),c.encodeInitMessageHeaders=!0;const h=s.join("");K(Kt,`Creating RPC '${t}' stream ${i}: ${h}`,c);const p=a.createWebChannel(h,c);this.I_(p);let _=!1,I=!1;const g=new $v({Yo:b=>{I?K(Kt,`Not sending because RPC '${t}' stream ${i} is closed:`,b):(_||(K(Kt,`Opening RPC '${t}' stream ${i} transport.`),p.open(),_=!0),K(Kt,`RPC '${t}' stream ${i} sending:`,b),p.send(b))},Zo:()=>p.close()}),S=(b,k,y)=>{b.listen(k,(m=>{try{y(m)}catch(R){setTimeout((()=>{throw R}),0)}}))};return S(p,Br.EventType.OPEN,(()=>{I||(K(Kt,`RPC '${t}' stream ${i} transport opened.`),g.o_())})),S(p,Br.EventType.CLOSE,(()=>{I||(I=!0,K(Kt,`RPC '${t}' stream ${i} transport closed`),g.a_(),this.E_(p))})),S(p,Br.EventType.ERROR,(b=>{I||(I=!0,lr(Kt,`RPC '${t}' stream ${i} transport errored. Name:`,b.name,"Message:",b.message),g.a_(new W(q.UNAVAILABLE,"The operation could not be completed")))})),S(p,Br.EventType.MESSAGE,(b=>{if(!I){const k=b.data[0];mt(!!k,16349);const y=k,m=y?.error||y[0]?.error;if(m){K(Kt,`RPC '${t}' stream ${i} received error:`,m);const R=m.status;let C=(function(w){const A=Vt[w];if(A!==void 0)return Rf(A)})(R),x=m.message;C===void 0&&(C=q.INTERNAL,x="Unknown error status: "+R+" with message "+m.message),I=!0,g.a_(new W(C,x)),p.close()}else K(Kt,`RPC '${t}' stream ${i} received:`,k),g.u_(k)}})),S(u,zh.STAT_EVENT,(b=>{b.stat===Wo.PROXY?K(Kt,`RPC '${t}' stream ${i} detected buffering proxy`):b.stat===Wo.NOPROXY&&K(Kt,`RPC '${t}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{g.__()}),0),g}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function Do(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zs(n){return new Ky(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(t,e,r=1e3,i=1.5,s=6e4){this.Mi=t,this.timerId=e,this.d_=r,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,e-r);i>0&&K("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rc="PersistentStream";class $f{constructor(t,e,r,i,s,a,u,c){this.Mi=t,this.S_=r,this.b_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Bf(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===q.RESOURCE_EXHAUSTED?(Ue(e.toString()),Ue("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===e&&this.G_(r,i)}),(r=>{t((()=>{const i=new W(q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(t,e){const r=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return K(Rc,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(K(Rc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class zv extends $f{constructor(t,e,r,i,s,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,i,a),this.serializer=s}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=Jy(this.serializer,t),r=(function(s){if(!("targetChange"in s))return st.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?st.min():a.readTime?Re(a.readTime):st.min()})(t);return this.listener.H_(e,r)}Y_(t){const e={};e.database=ia(this.serializer),e.addTarget=(function(s,a){let u;const c=a.target;if(u=Zo(c)?{documents:Zy(s,c)}:{query:tv(s,c).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Pf(s,a.resumeToken);const l=ea(s,a.expectedCount);l!==null&&(u.expectedCount=l)}else if(a.snapshotVersion.compareTo(st.min())>0){u.readTime=bs(s,a.snapshotVersion.toTimestamp());const l=ea(s,a.expectedCount);l!==null&&(u.expectedCount=l)}return u})(this.serializer,t);const r=nv(this.serializer,t);r&&(e.labels=r),this.q_(e)}Z_(t){const e={};e.database=ia(this.serializer),e.removeTarget=t,this.q_(e)}}class Gv extends $f{constructor(t,e,r,i,s,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,i,a),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return mt(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,mt(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){mt(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=Yy(t.writeResults,t.commitTime),r=Re(t.commitTime);return this.listener.na(r,e)}ra(){const t={};t.database=ia(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((r=>Xy(this.serializer,r)))};this.q_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{}class Kv extends Hv{constructor(t,e,r,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new W(q.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,a])=>this.connection.Go(t,na(e,r),i,s,a))).catch((s=>{throw s.name==="FirebaseError"?(s.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new W(q.UNKNOWN,s.toString())}))}Ho(t,e,r,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.Ho(t,na(e,r),i,a,u,s))).catch((a=>{throw a.name==="FirebaseError"?(a.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new W(q.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Wv{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ue(e),this.aa=!1):K("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dn="RemoteStore";class Qv{constructor(t,e,r,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{jn(this)&&(K(Dn,"Restarting streams for network reachability change."),await(async function(c){const l=ot(c);l.Ea.add(4),await wi(l),l.Ra.set("Unknown"),l.Ea.delete(4),await Gs(l)})(this))}))})),this.Ra=new Wv(r,i)}}async function Gs(n){if(jn(n))for(const t of n.da)await t(!0)}async function wi(n){for(const t of n.da)await t(!1)}function qf(n,t){const e=ot(n);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),Ya(e)?Xa(e):Er(e).O_()&&Ja(e,t))}function Qa(n,t){const e=ot(n),r=Er(e);e.Ia.delete(t),r.O_()&&zf(e,t),e.Ia.size===0&&(r.O_()?r.L_():jn(e)&&e.Ra.set("Unknown"))}function Ja(n,t){if(n.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(st.min())>0){const e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Er(n).Y_(t)}function zf(n,t){n.Va.Ue(t),Er(n).Z_(t)}function Xa(n){n.Va=new qy({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),At:t=>n.Ia.get(t)||null,ht:()=>n.datastore.serializer.databaseId}),Er(n).start(),n.Ra.ua()}function Ya(n){return jn(n)&&!Er(n).x_()&&n.Ia.size>0}function jn(n){return ot(n).Ea.size===0}function Gf(n){n.Va=void 0}async function Jv(n){n.Ra.set("Online")}async function Xv(n){n.Ia.forEach(((t,e)=>{Ja(n,t)}))}async function Yv(n,t){Gf(n),Ya(n)?(n.Ra.ha(t),Xa(n)):n.Ra.set("Unknown")}async function Zv(n,t,e){if(n.Ra.set("Online"),t instanceof kf&&t.state===2&&t.cause)try{await(async function(i,s){const a=s.cause;for(const u of s.targetIds)i.Ia.has(u)&&(await i.remoteSyncer.rejectListen(u,a),i.Ia.delete(u),i.Va.removeTarget(u))})(n,t)}catch(r){K(Dn,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await Is(n,r)}else if(t instanceof ts?n.Va.Ze(t):t instanceof Cf?n.Va.st(t):n.Va.tt(t),!e.isEqual(st.min()))try{const r=await Uf(n.localStore);e.compareTo(r)>=0&&await(function(s,a){const u=s.Va.Tt(a);return u.targetChanges.forEach(((c,l)=>{if(c.resumeToken.approximateByteSize()>0){const h=s.Ia.get(l);h&&s.Ia.set(l,h.withResumeToken(c.resumeToken,a))}})),u.targetMismatches.forEach(((c,l)=>{const h=s.Ia.get(c);if(!h)return;s.Ia.set(c,h.withResumeToken(qt.EMPTY_BYTE_STRING,h.snapshotVersion)),zf(s,c);const p=new Je(h.target,c,l,h.sequenceNumber);Ja(s,p)})),s.remoteSyncer.applyRemoteEvent(u)})(n,e)}catch(r){K(Dn,"Failed to raise snapshot:",r),await Is(n,r)}}async function Is(n,t,e){if(!wr(t))throw t;n.Ea.add(1),await wi(n),n.Ra.set("Offline"),e||(e=()=>Uf(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{K(Dn,"Retrying IndexedDB access"),await e(),n.Ea.delete(1),await Gs(n)}))}function Hf(n,t){return t().catch((e=>Is(n,e,t)))}async function Hs(n){const t=ot(n),e=ln(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Ma;for(;tw(t);)try{const i=await Ov(t.localStore,r);if(i===null){t.Ta.length===0&&e.L_();break}r=i.batchId,ew(t,i)}catch(i){await Is(t,i)}Kf(t)&&Wf(t)}function tw(n){return jn(n)&&n.Ta.length<10}function ew(n,t){n.Ta.push(t);const e=ln(n);e.O_()&&e.X_&&e.ea(t.mutations)}function Kf(n){return jn(n)&&!ln(n).x_()&&n.Ta.length>0}function Wf(n){ln(n).start()}async function nw(n){ln(n).ra()}async function rw(n){const t=ln(n);for(const e of n.Ta)t.ea(e.mutations)}async function iw(n,t,e){const r=n.Ta.shift(),i=$a.from(r,t,e);await Hf(n,(()=>n.remoteSyncer.applySuccessfulWrite(i))),await Hs(n)}async function sw(n,t){t&&ln(n).X_&&await(async function(r,i){if((function(a){return Uy(a)&&a!==q.ABORTED})(i.code)){const s=r.Ta.shift();ln(r).B_(),await Hf(r,(()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i))),await Hs(r)}})(n,t),Kf(n)&&Wf(n)}async function Cc(n,t){const e=ot(n);e.asyncQueue.verifyOperationInProgress(),K(Dn,"RemoteStore received new credentials");const r=jn(e);e.Ea.add(3),await wi(e),r&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await Gs(e)}async function ow(n,t){const e=ot(n);t?(e.Ea.delete(2),await Gs(e)):t||(e.Ea.add(2),await wi(e),e.Ra.set("Unknown"))}function Er(n){return n.ma||(n.ma=(function(e,r,i){const s=ot(e);return s.sa(),new zv(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Xo:Jv.bind(null,n),t_:Xv.bind(null,n),r_:Yv.bind(null,n),H_:Zv.bind(null,n)}),n.da.push((async t=>{t?(n.ma.B_(),Ya(n)?Xa(n):n.Ra.set("Unknown")):(await n.ma.stop(),Gf(n))}))),n.ma}function ln(n){return n.fa||(n.fa=(function(e,r,i){const s=ot(e);return s.sa(),new Gv(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:nw.bind(null,n),r_:sw.bind(null,n),ta:rw.bind(null,n),na:iw.bind(null,n)}),n.da.push((async t=>{t?(n.fa.B_(),await Hs(n)):(await n.fa.stop(),n.Ta.length>0&&(K(Dn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za{constructor(t,e,r,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new en,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,i,s){const a=Date.now()+r,u=new Za(t,e,a,i,s);return u.start(r),u}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new W(q.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function tu(n,t){if(Ue("AsyncQueue",`${t}: ${n}`),wr(n))return new W(q.UNAVAILABLE,`${t}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{static emptySet(t){return new rr(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||tt.comparator(e.key,r.key):(e,r)=>tt.comparator(e.key,r.key),this.keyedMap=$r(),this.sortedSet=new Rt(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,r)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof rr)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){const i=e.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const r=new rr;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kc{constructor(){this.ga=new Rt(tt.comparator)}track(t){const e=t.doc.key,r=this.ga.get(e);r?t.type!==0&&r.type===3?this.ga=this.ga.insert(e,t):t.type===3&&r.type!==1?this.ga=this.ga.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.ga=this.ga.remove(e):t.type===1&&r.type===2?this.ga=this.ga.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):et(63341,{Rt:t,pa:r}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,r)=>{t.push(r)})),t}}class pr{constructor(t,e,r,i,s,a,u,c,l){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(t,e,r,i,s){const a=[];return e.forEach((u=>{a.push({type:0,doc:u})})),new pr(t,e,rr.emptySet(e),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Fs(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==r[i].type||!e[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class uw{constructor(){this.queries=Pc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,r){const i=ot(e),s=i.queries;i.queries=Pc(),s.forEach(((a,u)=>{for(const c of u.Sa)c.onError(r)}))})(this,new W(q.ABORTED,"Firestore shutting down"))}}function Pc(){return new Ln((n=>pf(n)),Fs)}async function Qf(n,t){const e=ot(n);let r=3;const i=t.query;let s=e.queries.get(i);s?!s.ba()&&t.Da()&&(r=2):(s=new aw,r=t.Da()?0:1);try{switch(r){case 0:s.wa=await e.onListen(i,!0);break;case 1:s.wa=await e.onListen(i,!1);break;case 2:await e.onFirstRemoteStoreListen(i)}}catch(a){const u=tu(a,`Initialization of query '${Wn(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.Sa.push(t),t.va(e.onlineState),s.wa&&t.Fa(s.wa)&&eu(e)}async function Jf(n,t){const e=ot(n),r=t.query;let i=3;const s=e.queries.get(r);if(s){const a=s.Sa.indexOf(t);a>=0&&(s.Sa.splice(a,1),s.Sa.length===0?i=t.Da()?0:1:!s.ba()&&t.Da()&&(i=2))}switch(i){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function lw(n,t){const e=ot(n);let r=!1;for(const i of t){const s=i.query,a=e.queries.get(s);if(a){for(const u of a.Sa)u.Fa(i)&&(r=!0);a.wa=i}}r&&eu(e)}function cw(n,t,e){const r=ot(n),i=r.queries.get(t);if(i)for(const s of i.Sa)s.onError(e);r.queries.delete(t)}function eu(n){n.Ca.forEach((t=>{t.next()}))}var aa,Dc;(Dc=aa||(aa={})).Ma="default",Dc.Cache="cache";class Xf{constructor(t,e,r){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(t){if(!this.options.includeMetadataChanges){const r=[];for(const i of t.docChanges)i.type!==3&&r.push(i);t=new pr(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const r=e!=="Offline";return(!this.options.qa||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=pr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==aa.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(t){this.key=t}}class Zf{constructor(t){this.key=t}}class hw{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ut(),this.mutatedKeys=ut(),this.eu=gf(t),this.tu=new rr(this.eu)}get nu(){return this.Ya}ru(t,e){const r=e?e.iu:new kc,i=e?e.tu:this.tu;let s=e?e.mutatedKeys:this.mutatedKeys,a=i,u=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(((h,p)=>{const _=i.get(h),I=Us(this.query,p)?p:null,g=!!_&&this.mutatedKeys.has(_.key),S=!!I&&(I.hasLocalMutations||this.mutatedKeys.has(I.key)&&I.hasCommittedMutations);let b=!1;_&&I?_.data.isEqual(I.data)?g!==S&&(r.track({type:3,doc:I}),b=!0):this.su(_,I)||(r.track({type:2,doc:I}),b=!0,(c&&this.eu(I,c)>0||l&&this.eu(I,l)<0)&&(u=!0)):!_&&I?(r.track({type:0,doc:I}),b=!0):_&&!I&&(r.track({type:1,doc:_}),b=!0,(c||l)&&(u=!0)),b&&(I?(a=a.add(I),s=S?s.add(h):s.delete(h)):(a=a.delete(h),s=s.delete(h)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),s=s.delete(h.key),r.track({type:1,doc:h})}return{tu:a,iu:r,Cs:u,mutatedKeys:s}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,i){const s=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const a=t.iu.ya();a.sort(((h,p)=>(function(I,g){const S=b=>{switch(b){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return et(20277,{Rt:b})}};return S(I)-S(g)})(h.type,p.type)||this.eu(h.doc,p.doc))),this.ou(r),i=i??!1;const u=e&&!i?this._u():[],c=this.Xa.size===0&&this.current&&!i?1:0,l=c!==this.Za;return this.Za=c,a.length!==0||l?{snapshot:new pr(this.query,t.tu,s,a,t.mutatedKeys,c===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new kc,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=ut(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const e=[];return t.forEach((r=>{this.Xa.has(r)||e.push(new Zf(r))})),this.Xa.forEach((r=>{t.has(r)||e.push(new Yf(r))})),e}cu(t){this.Ya=t.Qs,this.Xa=ut();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return pr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const nu="SyncEngine";class fw{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}}class dw{constructor(t){this.key=t,this.hu=!1}}class pw{constructor(t,e,r,i,s,a){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Ln((u=>pf(u)),Fs),this.Iu=new Map,this.Eu=new Set,this.du=new Rt(tt.comparator),this.Au=new Map,this.Ru=new Ga,this.Vu={},this.mu=new Map,this.fu=dr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function gw(n,t,e=!0){const r=sd(n);let i;const s=r.Tu.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await td(r,t,e,!0),i}async function mw(n,t){const e=sd(n);await td(e,t,!0,!1)}async function td(n,t,e,r){const i=await Mv(n.localStore,Se(t)),s=i.targetId,a=n.sharedClientState.addLocalQueryTarget(s,e);let u;return r&&(u=await _w(n,t,s,a==="current",i.resumeToken)),n.isPrimaryClient&&e&&qf(n.remoteStore,i),u}async function _w(n,t,e,r,i){n.pu=(p,_,I)=>(async function(S,b,k,y){let m=b.view.ru(k);m.Cs&&(m=await bc(S.localStore,b.query,!1).then((({documents:T})=>b.view.ru(T,m))));const R=y&&y.targetChanges.get(b.targetId),C=y&&y.targetMismatches.get(b.targetId)!=null,x=b.view.applyChanges(m,S.isPrimaryClient,R,C);return xc(S,b.targetId,x.au),x.snapshot})(n,p,_,I);const s=await bc(n.localStore,t,!0),a=new hw(t,s.Qs),u=a.ru(s.documents),c=vi.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",i),l=a.applyChanges(u,n.isPrimaryClient,c);xc(n,e,l.au);const h=new fw(t,e,a);return n.Tu.set(t,h),n.Iu.has(e)?n.Iu.get(e).push(t):n.Iu.set(e,[t]),l.snapshot}async function yw(n,t,e){const r=ot(n),i=r.Tu.get(t),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter((a=>!Fs(a,t)))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await sa(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),e&&Qa(r.remoteStore,i.targetId),ua(r,i.targetId)})).catch(vr)):(ua(r,i.targetId),await sa(r.localStore,i.targetId,!0))}async function vw(n,t){const e=ot(n),r=e.Tu.get(t),i=e.Iu.get(r.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),Qa(e.remoteStore,r.targetId))}async function ww(n,t,e){const r=Rw(n);try{const i=await(function(a,u){const c=ot(a),l=At.now(),h=u.reduce(((I,g)=>I.add(g.key)),ut());let p,_;return c.persistence.runTransaction("Locally write mutations","readwrite",(I=>{let g=Be(),S=ut();return c.Ns.getEntries(I,h).next((b=>{g=b,g.forEach(((k,y)=>{y.isValidDocument()||(S=S.add(k))}))})).next((()=>c.localDocuments.getOverlayedDocuments(I,g))).next((b=>{p=b;const k=[];for(const y of u){const m=Oy(y,p.get(y.key).overlayedDocument);m!=null&&k.push(new pn(y.key,m,af(m.value.mapValue),Te.exists(!0)))}return c.mutationQueue.addMutationBatch(I,l,k,u)})).next((b=>{_=b;const k=b.applyToLocalDocumentSet(p,S);return c.documentOverlayCache.saveOverlays(I,b.batchId,k)}))})).then((()=>({batchId:_.batchId,changes:_f(p)})))})(r.localStore,t);r.sharedClientState.addPendingMutation(i.batchId),(function(a,u,c){let l=a.Vu[a.currentUser.toKey()];l||(l=new Rt(at)),l=l.insert(u,c),a.Vu[a.currentUser.toKey()]=l})(r,i.batchId,e),await Ei(r,i.changes),await Hs(r.remoteStore)}catch(i){const s=tu(i,"Failed to persist write");e.reject(s)}}async function ed(n,t){const e=ot(n);try{const r=await xv(e.localStore,t);t.targetChanges.forEach(((i,s)=>{const a=e.Au.get(s);a&&(mt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?mt(a.hu,14607):i.removedDocuments.size>0&&(mt(a.hu,42227),a.hu=!1))})),await Ei(e,r,t)}catch(r){await vr(r)}}function Vc(n,t,e){const r=ot(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){const i=[];r.Tu.forEach(((s,a)=>{const u=a.view.va(t);u.snapshot&&i.push(u.snapshot)})),(function(a,u){const c=ot(a);c.onlineState=u;let l=!1;c.queries.forEach(((h,p)=>{for(const _ of p.Sa)_.va(u)&&(l=!0)})),l&&eu(c)})(r.eventManager,t),i.length&&r.Pu.H_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Ew(n,t,e){const r=ot(n);r.sharedClientState.updateQueryState(t,"rejected",e);const i=r.Au.get(t),s=i&&i.key;if(s){let a=new Rt(tt.comparator);a=a.insert(s,Qt.newNoDocument(s,st.min()));const u=ut().add(s),c=new qs(st.min(),new Map,new Rt(at),a,u);await ed(r,c),r.du=r.du.remove(s),r.Au.delete(t),ru(r)}else await sa(r.localStore,t,!1).then((()=>ua(r,t,e))).catch(vr)}async function Tw(n,t){const e=ot(n),r=t.batch.batchId;try{const i=await Vv(e.localStore,t);rd(e,r,null),nd(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await Ei(e,i)}catch(i){await vr(i)}}async function bw(n,t,e){const r=ot(n);try{const i=await(function(a,u){const c=ot(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",(l=>{let h;return c.mutationQueue.lookupMutationBatch(l,u).next((p=>(mt(p!==null,37113),h=p.keys(),c.mutationQueue.removeMutationBatch(l,p)))).next((()=>c.mutationQueue.performConsistencyCheck(l))).next((()=>c.documentOverlayCache.removeOverlaysForBatchId(l,h,u))).next((()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,h))).next((()=>c.localDocuments.getDocuments(l,h)))}))})(r.localStore,t);rd(r,t,e),nd(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),await Ei(r,i)}catch(i){await vr(i)}}function nd(n,t){(n.mu.get(t)||[]).forEach((e=>{e.resolve()})),n.mu.delete(t)}function rd(n,t,e){const r=ot(n);let i=r.Vu[r.currentUser.toKey()];if(i){const s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),r.Vu[r.currentUser.toKey()]=i}}function ua(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const r of n.Iu.get(t))n.Tu.delete(r),e&&n.Pu.yu(r,e);n.Iu.delete(t),n.isPrimaryClient&&n.Ru.jr(t).forEach((r=>{n.Ru.containsKey(r)||id(n,r)}))}function id(n,t){n.Eu.delete(t.path.canonicalString());const e=n.du.get(t);e!==null&&(Qa(n.remoteStore,e),n.du=n.du.remove(t),n.Au.delete(e),ru(n))}function xc(n,t,e){for(const r of e)r instanceof Yf?(n.Ru.addReference(r.key,t),Aw(n,r)):r instanceof Zf?(K(nu,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,t),n.Ru.containsKey(r.key)||id(n,r.key)):et(19791,{wu:r})}function Aw(n,t){const e=t.key,r=e.path.canonicalString();n.du.get(e)||n.Eu.has(r)||(K(nu,"New document in limbo: "+e),n.Eu.add(r),ru(n))}function ru(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const t=n.Eu.values().next().value;n.Eu.delete(t);const e=new tt(bt.fromString(t)),r=n.fu.next();n.Au.set(r,new dw(e)),n.du=n.du.insert(e,r),qf(n.remoteStore,new Je(Se(js(e.path)),r,"TargetPurposeLimboResolution",Ns.ce))}}async function Ei(n,t,e){const r=ot(n),i=[],s=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,c)=>{a.push(r.pu(c,t,e).then((l=>{if((l||e)&&r.isPrimaryClient){const h=l?!l.fromCache:e?.targetChanges.get(c.targetId)?.current;r.sharedClientState.updateQueryState(c.targetId,h?"current":"not-current")}if(l){i.push(l);const h=Ka.As(c.targetId,l);s.push(h)}})))})),await Promise.all(a),r.Pu.H_(i),await(async function(c,l){const h=ot(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>B.forEach(l,(_=>B.forEach(_.Es,(I=>h.persistence.referenceDelegate.addReference(p,_.targetId,I))).next((()=>B.forEach(_.ds,(I=>h.persistence.referenceDelegate.removeReference(p,_.targetId,I)))))))))}catch(p){if(!wr(p))throw p;K(Wa,"Failed to update sequence numbers: "+p)}for(const p of l){const _=p.targetId;if(!p.fromCache){const I=h.Ms.get(_),g=I.snapshotVersion,S=I.withLastLimboFreeSnapshotVersion(g);h.Ms=h.Ms.insert(_,S)}}})(r.localStore,s))}async function Iw(n,t){const e=ot(n);if(!e.currentUser.isEqual(t)){K(nu,"User change. New user:",t.toKey());const r=await Ff(e.localStore,t);e.currentUser=t,(function(s,a){s.mu.forEach((u=>{u.forEach((c=>{c.reject(new W(q.CANCELLED,a))}))})),s.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await Ei(e,r.Ls)}}function Sw(n,t){const e=ot(n),r=e.Au.get(t);if(r&&r.hu)return ut().add(r.key);{let i=ut();const s=e.Iu.get(t);if(!s)return i;for(const a of s){const u=e.Tu.get(a);i=i.unionWith(u.view.nu)}return i}}function sd(n){const t=ot(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=ed.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Sw.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ew.bind(null,t),t.Pu.H_=lw.bind(null,t.eventManager),t.Pu.yu=cw.bind(null,t.eventManager),t}function Rw(n){const t=ot(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Tw.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=bw.bind(null,t),t}class Ss{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=zs(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return Dv(this.persistence,new Cv,t.initialUser,this.serializer)}Cu(t){return new jf(Ha.mi,this.serializer)}Du(t){return new jv}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ss.provider={build:()=>new Ss};class Cw extends Ss{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){mt(this.persistence.referenceDelegate instanceof As,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new dv(r,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?re.withCacheSize(this.cacheSizeBytes):re.DEFAULT;return new jf((r=>As.mi(r,e)),this.serializer)}}class la{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Vc(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Iw.bind(null,this.syncEngine),await ow(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new uw})()}createDatastore(t){const e=zs(t.databaseInfo.databaseId),r=(function(s){return new qv(s)})(t.databaseInfo);return(function(s,a,u,c){return new Kv(s,a,u,c)})(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return(function(r,i,s,a,u){return new Qv(r,i,s,a,u)})(this.localStore,this.datastore,t.asyncQueue,(e=>Vc(this.syncEngine,e,0)),(function(){return Sc.v()?new Sc:new Fv})())}createSyncEngine(t,e){return(function(i,s,a,u,c,l,h){const p=new pw(i,s,a,u,c,l);return h&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const r=ot(e);K(Dn,"RemoteStore shutting down."),r.Ea.add(5),await wi(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}la.provider={build:()=>new la};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class od{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Ue("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cn="FirestoreClient";class kw{constructor(t,e,r,i,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=i,this.user=Wt.UNAUTHENTICATED,this.clientId=Na.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,(async a=>{K(cn,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(K(cn,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new en;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const r=tu(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}async function Vo(n,t){n.asyncQueue.verifyOperationInProgress(),K(cn,"Initializing OfflineComponentProvider");const e=n.configuration;await t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener((async i=>{r.isEqual(i)||(await Ff(t.localStore,i),r=i)})),t.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=t}async function Nc(n,t){n.asyncQueue.verifyOperationInProgress();const e=await Pw(n);K(cn,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener((r=>Cc(t.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,i)=>Cc(t.remoteStore,i))),n._onlineComponents=t}async function Pw(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){K(cn,"Using user provided OfflineComponentProvider");try{await Vo(n,n._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(i){return i.name==="FirebaseError"?i.code===q.FAILED_PRECONDITION||i.code===q.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(e))throw e;lr("Error using user provided cache. Falling back to memory cache: "+e),await Vo(n,new Ss)}}else K(cn,"Using default OfflineComponentProvider"),await Vo(n,new Cw(void 0));return n._offlineComponents}async function ad(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(K(cn,"Using user provided OnlineComponentProvider"),await Nc(n,n._uninitializedComponentsProvider._online)):(K(cn,"Using default OnlineComponentProvider"),await Nc(n,new la))),n._onlineComponents}function Dw(n){return ad(n).then((t=>t.syncEngine))}async function ca(n){const t=await ad(n),e=t.eventManager;return e.onListen=gw.bind(null,t.syncEngine),e.onUnlisten=yw.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=mw.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=vw.bind(null,t.syncEngine),e}function Vw(n,t,e={}){const r=new en;return n.asyncQueue.enqueueAndForget((async()=>(function(s,a,u,c,l){const h=new od({next:_=>{h.Nu(),a.enqueueAndForget((()=>Jf(s,p)));const I=_.docs.has(u);!I&&_.fromCache?l.reject(new W(q.UNAVAILABLE,"Failed to get document because the client is offline.")):I&&_.fromCache&&c&&c.source==="server"?l.reject(new W(q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(_)},error:_=>l.reject(_)}),p=new Xf(js(u.path),h,{includeMetadataChanges:!0,qa:!0});return Qf(s,p)})(await ca(n),n.asyncQueue,t,e,r))),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ud(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oc=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ld="firestore.googleapis.com",Mc=!0;class Lc{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new W(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ld,this.ssl=Mc}else this.host=t.host,this.ssl=t.ssl??Mc;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Lf;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<hv)throw new W(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}W_("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ud(t.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new W(q.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new W(q.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new W(q.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Ks{constructor(t,e,r,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Lc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new W(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new W(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Lc(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new j_;switch(r.type){case"firstParty":return new $_(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new W(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const r=Oc.get(e);r&&(K("ComponentProvider","Removing Datastore"),Oc.delete(e),r.terminate())})(this),Promise.resolve()}}function xw(n,t,e,r={}){n=Ee(n,Ks);const i=Da(t),s=n._getSettings(),a={...s,emulatorOptions:n._getEmulatorOptions()},u=`${t}:${e}`;i&&(hm(`https://${u}`),gm("Firestore",!0)),s.host!==ld&&s.host!==u&&lr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...s,host:u,ssl:i,emulatorOptions:r};if(!ds(c,a)&&(n._setSettings(c),r.mockUserToken)){let l,h;if(typeof r.mockUserToken=="string")l=r.mockUserToken,h=Wt.MOCK_USER;else{l=fm(r.mockUserToken,n._app?.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new W(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new Wt(p)}n._authCredentials=new F_(new Wh(l,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new Ws(this.firestore,t,this._query)}}class Dt{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new nn(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Dt(this.firestore,t,this._key)}toJSON(){return{type:Dt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(_i(e,Dt._jsonSchema))return new Dt(t,r||null,new tt(bt.fromString(e.referencePath)))}}Dt._jsonSchemaVersion="firestore/documentReference/1.0",Dt._jsonSchema={type:xt("string",Dt._jsonSchemaVersion),referencePath:xt("string")};class nn extends Ws{constructor(t,e,r){super(t,e,js(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Dt(this.firestore,null,new tt(t))}withConverter(t){return new nn(this.firestore,t,this._path)}}function Fr(n,t,...e){if(n=je(n),Qh("collection","path",t),n instanceof Ks){const r=bt.fromString(t,...e);return Xl(r),new nn(n,null,r)}{if(!(n instanceof Dt||n instanceof nn))throw new W(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(bt.fromString(t,...e));return Xl(r),new nn(n.firestore,null,r)}}function cd(n,t,...e){if(n=je(n),arguments.length===1&&(t=Na.newId()),Qh("doc","path",t),n instanceof Ks){const r=bt.fromString(t,...e);return Jl(r),new Dt(n,null,new tt(r))}{if(!(n instanceof Dt||n instanceof nn))throw new W(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(bt.fromString(t,...e));return Jl(r),new Dt(n.firestore,n instanceof nn?n.converter:null,new tt(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jc="AsyncQueue";class Fc{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Bf(this,"async_queue_retry"),this._c=()=>{const r=Do();r&&K(jc,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=t;const e=Do();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Do();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new en;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!wr(t))throw t;K(jc,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((r=>{throw this.nc=r,this.rc=!1,Ue("INTERNAL UNHANDLED ERROR: ",Uc(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=e,e}enqueueAfterDelay(t,e,r){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const i=Za.createAndSchedule(this,t,e,r,(s=>this.hc(s)));return this.tc.push(i),i}uc(){this.nc&&et(47125,{Pc:Uc(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,r)=>e.targetTimeMs-r.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Uc(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bc(n){return(function(e,r){if(typeof e!="object"||e===null)return!1;const i=e;for(const s of r)if(s in i&&typeof i[s]=="function")return!0;return!1})(n,["next","error","complete"])}class Vn extends Ks{constructor(t,e,r,i){super(t,e,r,i),this.type="firestore",this._queue=new Fc,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Fc(t),this._firestoreClient=void 0,await t}}}function Nw(n,t){const e=typeof n=="object"?n:I_(),r=typeof n=="string"?n:_s,i=w_(e,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=lm("firestore");s&&xw(i,...s)}return i}function iu(n){if(n._terminated)throw new W(q.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Ow(n),n._firestoreClient}function Ow(n){const t=n._freezeSettings(),e=(function(i,s,a,u){return new sy(i,s,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,ud(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,t);n._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),n._firestoreClient=new kw(n._authCredentials,n._appCheckCredentials,n._queue,e,n._componentsProvider&&(function(i){const s=i?._online.build();return{_offline:i?._offline.build(s),_online:s}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pe{constructor(t){this._byteString=t}static fromBase64String(t){try{return new pe(qt.fromBase64String(t))}catch(e){throw new W(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new pe(qt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:pe._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(_i(t,pe._jsonSchema))return pe.fromBase64String(t.bytes)}}pe._jsonSchemaVersion="firestore/bytes/1.0",pe._jsonSchema={type:xt("string",pe._jsonSchemaVersion),bytes:xt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new W(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $t(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class su{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new W(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new W(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return at(this._lat,t._lat)||at(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ce._jsonSchemaVersion}}static fromJSON(t){if(_i(t,Ce._jsonSchema))return new Ce(t.latitude,t.longitude)}}Ce._jsonSchemaVersion="firestore/geoPoint/1.0",Ce._jsonSchema={type:xt("string",Ce._jsonSchemaVersion),latitude:xt("number"),longitude:xt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ke{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,t._values)}toJSON(){return{type:ke._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(_i(t,ke._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new ke(t.vectorValues);throw new W(q.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ke._jsonSchemaVersion="firestore/vectorValue/1.0",ke._jsonSchema={type:xt("string",ke._jsonSchemaVersion),vectorValues:xt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mw=/^__.*__$/;class Lw{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new pn(t,this.data,this.fieldMask,e,this.fieldTransforms):new yi(t,this.data,e,this.fieldTransforms)}}class hd{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new pn(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function fd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw et(40011,{Ac:n})}}class ou{constructor(t,e,r,i,s,a){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new ou({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.gc(t),r}yc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return Rs(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(fd(this.Ac)&&Mw.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class jw{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||zs(t)}Cc(t,e,r,i=!1){return new ou({Ac:t,methodName:e,Dc:r,path:$t.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function au(n){const t=n._freezeSettings(),e=zs(n._databaseId);return new jw(n._databaseId,!!t.ignoreUndefinedProperties,e)}function dd(n,t,e,r,i,s={}){const a=n.Cc(s.merge||s.mergeFields?2:0,t,e,i);uu("Data must be an object, but it was:",a,r);const u=pd(r,a);let c,l;if(s.merge)c=new ce(a.fieldMask),l=a.fieldTransforms;else if(s.mergeFields){const h=[];for(const p of s.mergeFields){const _=ha(t,p,e);if(!a.contains(_))throw new W(q.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);md(h,_)||h.push(_)}c=new ce(h),l=a.fieldTransforms.filter((p=>c.covers(p.field)))}else c=null,l=a.fieldTransforms;return new Lw(new se(u),c,l)}class Js extends su{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Js}}function Fw(n,t,e,r){const i=n.Cc(1,t,e);uu("Data must be an object, but it was:",i,r);const s=[],a=se.empty();dn(r,((c,l)=>{const h=lu(t,c,e);l=je(l);const p=i.yc(h);if(l instanceof Js)s.push(h);else{const _=Xs(l,p);_!=null&&(s.push(h),a.set(h,_))}}));const u=new ce(s);return new hd(a,u,i.fieldTransforms)}function Uw(n,t,e,r,i,s){const a=n.Cc(1,t,e),u=[ha(t,r,e)],c=[i];if(s.length%2!=0)throw new W(q.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(ha(t,s[_])),c.push(s[_+1]);const l=[],h=se.empty();for(let _=u.length-1;_>=0;--_)if(!md(l,u[_])){const I=u[_];let g=c[_];g=je(g);const S=a.yc(I);if(g instanceof Js)l.push(I);else{const b=Xs(g,S);b!=null&&(l.push(I),h.set(I,b))}}const p=new ce(l);return new hd(h,p,a.fieldTransforms)}function Xs(n,t){if(gd(n=je(n)))return uu("Unsupported field value:",t,n),pd(n,t);if(n instanceof su)return(function(r,i){if(!fd(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(r,i){const s=[];let a=0;for(const u of r){let c=Xs(u,i.wc(a));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}})(n,t)}return(function(r,i){if((r=je(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return ky(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=At.fromDate(r);return{timestampValue:bs(i.serializer,s)}}if(r instanceof At){const s=new At(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:bs(i.serializer,s)}}if(r instanceof Ce)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof pe)return{bytesValue:Pf(i.serializer,r._byteString)};if(r instanceof Dt){const s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:za(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof ke)return(function(a,u){return{mapValue:{fields:{[sf]:{stringValue:of},[ys]:{arrayValue:{values:a.toArray().map((l=>{if(typeof l!="number")throw u.Sc("VectorValues must only contain numeric values.");return Ba(u.serializer,l)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Oa(r)}`)})(n,t)}function pd(n,t){const e={};return Yh(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):dn(n,((r,i)=>{const s=Xs(i,t.mc(r));s!=null&&(e[r]=s)})),{mapValue:{fields:e}}}function gd(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof At||n instanceof Ce||n instanceof pe||n instanceof Dt||n instanceof su||n instanceof ke)}function uu(n,t,e){if(!gd(e)||!Jh(e)){const r=Oa(e);throw r==="an object"?t.Sc(n+" a custom object"):t.Sc(n+" "+r)}}function ha(n,t,e){if((t=je(t))instanceof Qs)return t._internalPath;if(typeof t=="string")return lu(n,t);throw Rs("Field path arguments must be of type string or ",n,!1,void 0,e)}const Bw=new RegExp("[~\\*/\\[\\]]");function lu(n,t,e){if(t.search(Bw)>=0)throw Rs(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new Qs(...t.split("."))._internalPath}catch{throw Rs(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Rs(n,t,e,r,i){const s=r&&!r.isEmpty(),a=i!==void 0;let u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${r}`),a&&(c+=` in document ${i}`),c+=")"),new W(q.INVALID_ARGUMENT,u+n+c)}function md(n,t){return n.some((e=>e.isEqual(t)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _d{constructor(t,e,r,i,s){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Dt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new $w(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(yd("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class $w extends _d{data(){return super.data()}}function yd(n,t){return typeof t=="string"?lu(n,t):t instanceof Qs?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new W(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class zw{convertValue(t,e="none"){switch(un(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Pt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(an(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw et(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const r={};return dn(t,((i,s)=>{r[i]=this.convertValue(s,e)})),r}convertVectorValue(t){const e=t.fields?.[ys].arrayValue?.values?.map((r=>Pt(r.doubleValue)));return new ke(e)}convertGeoPoint(t){return new Ce(Pt(t.latitude),Pt(t.longitude))}convertArray(t,e){return(t.values||[]).map((r=>this.convertValue(r,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const r=Ms(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(ai(t));default:return null}}convertTimestamp(t){const e=on(t);return new At(e.seconds,e.nanos)}convertDocumentKey(t,e){const r=bt.fromString(t);mt(Mf(r),9688,{name:t});const i=new ui(r.get(1),r.get(3)),s=new tt(r.popFirst(5));return i.isEqual(e)||Ue(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vd(n,t,e){let r;return r=n?n.toFirestore(t):t,r}class zr{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Rn extends _d{constructor(t,e,r,i,s,a){super(t,e,r,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new es(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const r=this._document.data.field(yd("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new W(q.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Rn._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Rn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Rn._jsonSchema={type:xt("string",Rn._jsonSchemaVersion),bundleSource:xt("string","DocumentSnapshot"),bundleName:xt("string"),bundle:xt("string")};class es extends Rn{data(t={}){return super.data(t)}}class ir{constructor(t,e,r,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new zr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((r=>{t.call(e,new es(this._firestore,this._userDataWriter,r.key,r,new zr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new W(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map((u=>{const c=new es(i._firestore,i._userDataWriter,u.doc.key,u.doc,new zr(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((u=>s||u.type!==3)).map((u=>{const c=new es(i._firestore,i._userDataWriter,u.doc.key,u.doc,new zr(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let l=-1,h=-1;return u.type!==0&&(l=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),h=a.indexOf(u.doc.key)),{type:Gw(u.type),doc:c,oldIndex:l,newIndex:h}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new W(q.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=ir._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Na.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],r=[],i=[];return this.docs.forEach((s=>{s._document!==null&&(e.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function Gw(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return et(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hw(n){n=Ee(n,Dt);const t=Ee(n.firestore,Vn);return Vw(iu(t),n._key).then((e=>Ed(t,n,e)))}ir._jsonSchemaVersion="firestore/querySnapshot/1.0",ir._jsonSchema={type:xt("string",ir._jsonSchemaVersion),bundleSource:xt("string","QuerySnapshot"),bundleName:xt("string"),bundle:xt("string")};class wd extends zw{constructor(t){super(),this.firestore=t}convertBytes(t){return new pe(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Dt(this.firestore,null,e)}}function Kw(n,t,e){n=Ee(n,Dt);const r=Ee(n.firestore,Vn),i=vd(n.converter,t);return cu(r,[dd(au(r),"setDoc",n._key,i,n.converter!==null,e).toMutation(n._key,Te.none())])}function Ww(n,t,e,...r){n=Ee(n,Dt);const i=Ee(n.firestore,Vn),s=au(i);let a;return a=typeof(t=je(t))=="string"||t instanceof Qs?Uw(s,"updateDoc",n._key,t,e,r):Fw(s,"updateDoc",n._key,t),cu(i,[a.toMutation(n._key,Te.exists(!0))])}function xo(n,t){const e=Ee(n.firestore,Vn),r=cd(n),i=vd(n.converter,t);return cu(e,[dd(au(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Te.exists(!1))]).then((()=>r))}function No(n,...t){n=je(n);let e={includeMetadataChanges:!1,source:"default"},r=0;typeof t[r]!="object"||Bc(t[r])||(e=t[r++]);const i={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(Bc(t[r])){const c=t[r];t[r]=c.next?.bind(c),t[r+1]=c.error?.bind(c),t[r+2]=c.complete?.bind(c)}let s,a,u;if(n instanceof Dt)a=Ee(n.firestore,Vn),u=js(n._key.path),s={next:c=>{t[r]&&t[r](Ed(a,n,c))},error:t[r+1],complete:t[r+2]};else{const c=Ee(n,Ws);a=Ee(c.firestore,Vn),u=c._query;const l=new wd(a);s={next:h=>{t[r]&&t[r](new ir(a,l,c,h))},error:t[r+1],complete:t[r+2]},qw(n._query)}return(function(l,h,p,_){const I=new od(_),g=new Xf(h,I,p);return l.asyncQueue.enqueueAndForget((async()=>Qf(await ca(l),g))),()=>{I.Nu(),l.asyncQueue.enqueueAndForget((async()=>Jf(await ca(l),g)))}})(iu(a),u,i,s)}function cu(n,t){return(function(r,i){const s=new en;return r.asyncQueue.enqueueAndForget((async()=>ww(await Dw(r),i,s))),s.promise})(iu(n),t)}function Ed(n,t,e){const r=e.docs.get(t._key),i=new wd(n);return new Rn(n,i,t._key,r,new zr(e.hasPendingWrites,e.fromCache),t.converter)}(function(t,e=!0){(function(i){yr=i})(A_),gs(new ii("firestore",((r,{instanceIdentifier:i,options:s})=>{const a=r.getProvider("app").getImmediate(),u=new Vn(new U_(r.getProvider("auth-internal")),new q_(a,r.getProvider("app-check-internal")),(function(l,h){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new W(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ui(l.options.projectId,h)})(a,i),a);return s={useFetchStreams:e,...s},u._setSettings(s),u}),"PUBLIC").setMultipleInstances(!0)),nr(Hl,Kl,t),nr(Hl,Kl,"esm2020")})();var Qw=Ct('<div class="video-chat-container svelte-11hmpkd"><div class="video-section svelte-11hmpkd"><video autoplay playsinline="" class="video svelte-11hmpkd"></video> <video autoplay playsinline="" class="video svelte-11hmpkd"></video></div> <div class="controls svelte-11hmpkd"><button class="svelte-11hmpkd">Start Webcam</button> <button class="svelte-11hmpkd">Create Call</button> <input placeholder="Call ID" class="svelte-11hmpkd"/> <button class="svelte-11hmpkd">Answer</button></div></div>',2);function Jw(n,t){hn(t,!1);const r=jh({apiKey:"AIzaSyAFdtad6gXot4ZyOOc7S8R4d1-pHSmtXKs",authDomain:"flopper-b52da.firebaseapp.com",projectId:"flopper-b52da",storageBucket:"flopper-b52da.firebasestorage.app",messagingSenderId:"380098975873",appId:"1:380098975873:web:b7697a4c224aba2b6c1580",measurementId:"G-P2CCPYFSEY"}),i=Nw(r);let s=yt(),a=yt(),u,c,l,h=yt("");const p={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]};async function _(){u=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),c=new MediaStream,hl(s,z(s).srcObject=u),hl(a,z(a).srcObject=c)}async function I(){l=new RTCPeerConnection(p),u.getTracks().forEach(E=>l.addTrack(E,u)),l.ontrack=E=>{E.streams[0].getTracks().forEach(d=>c.addTrack(d))};const w=await xo(Fr(i,"calls"),{});Z(h,w.id);const A=Fr(w,"offerCandidates"),V=Fr(w,"answerCandidates");l.onicecandidate=E=>{E.candidate&&xo(A,E.candidate.toJSON())};const P=await l.createOffer();await l.setLocalDescription(P),await Kw(w,{offer:{type:P.type,sdp:P.sdp}}),No(w,E=>{const d=E.data();if(!l.currentRemoteDescription&&d?.answer){const N=new RTCSessionDescription(d.answer);l.setRemoteDescription(N)}}),No(V,E=>{E.docChanges().forEach(d=>{if(d.type==="added"){const N=new RTCIceCandidate(d.doc.data());l.addIceCandidate(N)}})})}async function g(){l=new RTCPeerConnection(p),u.getTracks().forEach(N=>l.addTrack(N,u)),l.ontrack=N=>{N.streams[0].getTracks().forEach(O=>c.addTrack(O))};const w=cd(i,"calls",z(h)),A=Fr(w,"offerCandidates"),V=Fr(w,"answerCandidates");l.onicecandidate=N=>{N.candidate&&xo(V,N.candidate.toJSON())};const E=(await Hw(w)).data().offer;await l.setRemoteDescription(new RTCSessionDescription(E));const d=await l.createAnswer();await l.setLocalDescription(d),await Ww(w,{answer:{type:d.type,sdp:d.sdp}}),No(A,N=>{N.docChanges().forEach(O=>{if(O.type==="added"){const U=new RTCIceCandidate(O.doc.data());l.addIceCandidate(U)}})})}Mn();var S=Qw(),b=X(S),k=X(b);k.muted=!0,hs(k,w=>Z(s,w),()=>z(s));var y=it(k,2);hs(y,w=>Z(a,w),()=>z(a));var m=it(b,2),R=X(m),C=it(R,2),x=it(C,2),T=it(x,2);Nt("click",R,_),Nt("click",C,I),ri(x,()=>z(h),w=>Z(h,w)),Nt("click",T,g),Et(n,S),fn()}var Xw=Ct('<li class="user-list-item svelte-pb8tfv"><span> </span> <button class="chat-btn svelte-pb8tfv">Chat</button></li>'),Yw=Ct('<li class="user-list-item empty svelte-pb8tfv">No users found</li>'),Zw=Ct('<div class="user-search-container svelte-pb8tfv"><input type="text" placeholder="Search users..." class="user-search-input svelte-pb8tfv"/> <ul class="user-list svelte-pb8tfv"><!> <!></ul></div>');function tE(n,t){hn(t,!1);const e=()=>ar(Cg,"$availableUsers",i),r=()=>ar(kn,"$username",i),[i,s]=mi(),a=yt(),u=yt(),c=yt();let l=yt("");function h(y){Z(l,y.target.value)}function p(y){Pg(y,z(u))}tr(()=>e(),()=>{Z(a,e())}),tr(()=>r(),()=>{Z(u,r())}),tr(()=>(z(a),z(u),z(l)),()=>{Z(c,z(a).filter(y=>y&&y!==z(u)&&y.toLowerCase().includes(z(l).toLowerCase())))}),ba(),Mn();var _=Zw(),I=X(_),g=it(I,2),S=X(g);Ah(S,1,()=>z(c),sg,(y,m)=>{var R=Xw(),C=X(R),x=X(C),T=it(C,2);ve(()=>le(x,z(m))),Nt("click",T,()=>p(z(m))),Et(y,R)});var b=it(S,2);{var k=y=>{var m=Yw();Et(y,m)};ie(b,y=>{z(c),oe(()=>z(c).length===0)&&y(k)})}ve(()=>hg(I,z(l))),Nt("input",I,h),Et(n,_),fn(),s()}var eE=Ct('<div style="display: flex; flex-direction: row; height: 100%;"><div style="padding: 1rem; text-align: right; min-width: 250px; max-width: 350px;"><button style="padding: 0.5em 1.2em; border-radius: 8px; border: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; font-weight: 600; cursor: pointer; margin-bottom: 1em;">Video Chat</button> <div style="margin-top: 1em;"><!></div></div> <div style="flex: 1; display: flex; flex-direction: column;"><!></div></div>'),nE=Ct('<div style="flex: 1; display: flex; align-items: center; justify-content: center;"><!></div>'),rE=Ct('<div class="app svelte-cu5if6"><!> <div class="main-content svelte-cu5if6"><!></div></div>');function iE(n){const t=()=>ar(kn,"$username",e),[e,r]=mi();let i=yt(!1),s=yt(!1);function a(){Z(i,!0),Z(s,!1)}function u(){Z(s,!z(s)),Z(i,!1)}var c=rE(),l=X(c);Qg(l,{$$events:{profile:a}});var h=it(l,2),p=X(h);{var _=g=>{Yg(g,{})},I=g=>{var S=Uo(),b=Zr(S);{var k=m=>{Jw(m,{})},y=m=>{var R=Uo(),C=Zr(R);{var x=w=>{var A=eE(),V=X(A),P=X(V),E=it(P,2),d=X(E);tE(d,{});var N=it(V,2),O=X(N);xl(O,{}),Nt("click",P,u),Et(w,A)},T=w=>{var A=nE(),V=X(A);xl(V,{}),Et(w,A)};ie(C,w=>{t()?w(x):w(T,!1)})}Et(m,R)};ie(b,m=>{z(s)?m(k):m(y,!1)},!0)}Et(g,S)};ie(p,g=>{z(i)?g(_):g(I,!1)})}Et(n,c),r()}ng(iE,{target:document.getElementById("app")});
